var app=function(){"use strict";function t(){}function e(t){return t()}function n(){return Object.create(null)}function r(t){t.forEach(e)}function s(t){return"function"==typeof t}function l(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}function o(e,...n){if(null==e)return t;const r=e.subscribe(...n);return r.unsubscribe?()=>r.unsubscribe():r}function c(t,e,n){t.$$.on_destroy.push(o(e,n))}function a(t,e,n,r){if(t){const s=i(t,e,n,r);return t[0](s)}}function i(t,e,n,r){return t[1]&&r?function(t,e){for(const n in e)t[n]=e[n];return t}(n.ctx.slice(),t[1](r(e))):n.ctx}function u(t,e,n,r,s,l,o){const c=function(t,e,n,r){if(t[2]&&r){const s=t[2](r(n));if(void 0===e.dirty)return s;if("object"==typeof s){const t=[],n=Math.max(e.dirty.length,s.length);for(let r=0;r<n;r+=1)t[r]=e.dirty[r]|s[r];return t}return e.dirty|s}return e.dirty}(e,r,s,l);if(c){const s=i(e,n,r,o);t.p(s,c)}}function d(t,e){t.appendChild(e)}function f(t,e,n){t.insertBefore(e,n||null)}function h(t){t.parentNode.removeChild(t)}function p(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function g(t){return document.createElement(t)}function m(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function $(t){return document.createTextNode(t)}function w(){return $(" ")}function v(){return $("")}function x(t,e,n,r){return t.addEventListener(e,n,r),()=>t.removeEventListener(e,n,r)}function b(t){return function(e){return e.preventDefault(),t.call(this,e)}}function y(t,e,n){null==n?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function M(t,e){e=""+e,t.wholeText!==e&&(t.data=e)}function k(t,e){t.value=null==e?"":e}function z(t,e,n,r){t.style.setProperty(e,n,r?"important":"")}function H(t,e,n){t.classList[n?"add":"remove"](e)}let T;function C(t){T=t}function V(){if(!T)throw new Error("Function called outside component initialization");return T}function L(){const t=V();return(e,n)=>{const r=t.$$.callbacks[e];if(r){const s=function(t,e){const n=document.createEvent("CustomEvent");return n.initCustomEvent(t,!1,!1,e),n}(e,n);r.slice().forEach((e=>{e.call(t,s)}))}}}function B(t,e){const n=t.$$.callbacks[e.type];n&&n.slice().forEach((t=>t(e)))}const j=[],S=[],E=[],N=[],_=Promise.resolve();let q=!1;function F(){q||(q=!0,_.then(U))}function O(){return F(),_}function I(t){E.push(t)}let D=!1;const P=new Set;function U(){if(!D){D=!0;do{for(let t=0;t<j.length;t+=1){const e=j[t];C(e),A(e.$$)}for(C(null),j.length=0;S.length;)S.pop()();for(let t=0;t<E.length;t+=1){const e=E[t];P.has(e)||(P.add(e),e())}E.length=0}while(j.length);for(;N.length;)N.pop()();q=!1,D=!1,P.clear()}}function A(t){if(null!==t.fragment){t.update(),r(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(I)}}const R=new Set;let W;function G(){W={r:0,c:[],p:W}}function J(){W.r||r(W.c),W=W.p}function K(t,e){t&&t.i&&(R.delete(t),t.i(e))}function Q(t,e,n,r){if(t&&t.o){if(R.has(t))return;R.add(t),W.c.push((()=>{R.delete(t),r&&(n&&t.d(1),r())})),t.o(e)}}function X(t,e){Q(t,1,1,(()=>{e.delete(t.key)}))}function Y(t,e,n,r,s,l,o,c,a,i,u,d){let f=t.length,h=l.length,p=f;const g={};for(;p--;)g[t[p].key]=p;const m=[],$=new Map,w=new Map;for(p=h;p--;){const t=d(s,l,p),c=n(t);let a=o.get(c);a?r&&a.p(t,e):(a=i(c,t),a.c()),$.set(c,m[p]=a),c in g&&w.set(c,Math.abs(p-g[c]))}const v=new Set,x=new Set;function b(t){K(t,1),t.m(c,u),o.set(t.key,t),u=t.first,h--}for(;f&&h;){const e=m[h-1],n=t[f-1],r=e.key,s=n.key;e===n?(u=e.first,f--,h--):$.has(s)?!o.has(r)||v.has(r)?b(e):x.has(s)?f--:w.get(r)>w.get(s)?(x.add(r),b(e)):(v.add(s),f--):(a(n,o),f--)}for(;f--;){const e=t[f];$.has(e.key)||a(e,o)}for(;h;)b(m[h-1]);return m}function Z(t){t&&t.c()}function tt(t,n,l,o){const{fragment:c,on_mount:a,on_destroy:i,after_update:u}=t.$$;c&&c.m(n,l),o||I((()=>{const n=a.map(e).filter(s);i?i.push(...n):r(n),t.$$.on_mount=[]})),u.forEach(I)}function et(t,e){const n=t.$$;null!==n.fragment&&(r(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function nt(e,s,l,o,c,a,i=[-1]){const u=T;C(e);const d=e.$$={fragment:null,ctx:null,props:a,update:t,not_equal:c,bound:n(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(u?u.$$.context:s.context||[]),callbacks:n(),dirty:i,skip_bound:!1};let f=!1;if(d.ctx=l?l(e,s.props||{},((t,n,...r)=>{const s=r.length?r[0]:n;return d.ctx&&c(d.ctx[t],d.ctx[t]=s)&&(!d.skip_bound&&d.bound[t]&&d.bound[t](s),f&&function(t,e){-1===t.$$.dirty[0]&&(j.push(t),F(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}(e,t)),n})):[],d.update(),f=!0,r(d.before_update),d.fragment=!!o&&o(d.ctx),s.target){if(s.hydrate){const t=function(t){return Array.from(t.childNodes)}(s.target);d.fragment&&d.fragment.l(t),t.forEach(h)}else d.fragment&&d.fragment.c();s.intro&&K(e.$$.fragment),tt(e,s.target,s.anchor,s.customElement),U()}C(u)}class rt{$destroy(){et(this,1),this.$destroy=t}$on(t,e){const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(e),()=>{const t=n.indexOf(e);-1!==t&&n.splice(t,1)}}$set(t){var e;this.$$set&&(e=t,0!==Object.keys(e).length)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}class st extends rt{constructor(t){super(),nt(this,t,null,null,l,{})}}function lt(e){let n,r,s,l,o,c;return{c(){n=g("button"),r=m("svg"),s=m("path"),l=m("path"),y(s,"d","M0 0h24v24H0z"),y(s,"fill","none"),y(l,"d","M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"),y(r,"xmlns","http://www.w3.org/2000/svg"),y(r,"viewBox","0 0 24 24"),y(r,"class","fill-current"),H(r,"animate-spin",e[0]),y(n,"class","w-6 text-white hover:text-gray-300 active:text-gray-400 focus:outline-none")},m(t,a){f(t,n,a),d(n,r),d(r,s),d(r,l),o||(c=x(r,"click",e[1]),o=!0)},p(t,[e]){1&e&&H(r,"animate-spin",t[0])},i:t,o:t,d(t){t&&h(n),o=!1,c()}}}function ot(t,e,n){let{refreshing:r}=e;return t.$$set=t=>{"refreshing"in t&&n(0,r=t.refreshing)},[r,function(e){B(t,e)}]}class ct extends rt{constructor(t){super(),nt(this,t,ot,lt,l,{refreshing:0})}}function at(t){let e,n,r;return{c(){e=g("button"),e.textContent="New message",y(e,"class","bg-red-600 hover:bg-red-700 active:bg-red-800 focus:outline-none w-full text-white h-10 rounded border-0 font-semibold")},m(s,l){f(s,e,l),n||(r=x(e,"click",t[2]),n=!0)},d(t){t&&h(e),n=!1,r()}}}function it(t){let e,n,r;return{c(){e=g("button"),e.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="fill-current h-full"><path d="M19,13h-6v6h-2v-6H5v-2h6V5h2v6h6V13z"></path>\n      &gt;</svg>',y(e,"class","bg-red-600 hover:bg-red-700 active:bg-red-800 focus:outline-none w-8 text-white h-8 p-1 rounded border-0")},m(s,l){f(s,e,l),n||(r=x(e,"click",t[1]),n=!0)},d(t){t&&h(e),n=!1,r()}}}function ut(e){let n;function r(t,e){return t[0]?it:at}let s=r(e),l=s(e);return{c(){l.c(),n=v()},m(t,e){l.m(t,e),f(t,n,e)},p(t,[e]){s!==(s=r(t))&&(l.d(1),l=s(t),l&&(l.c(),l.m(n.parentNode,n)))},i:t,o:t,d(t){l.d(t),t&&h(n)}}}function dt(t,e,n){let{collapsed:r=!1}=e;return t.$$set=t=>{"collapsed"in t&&n(0,r=t.collapsed)},[r,function(e){B(t,e)},function(e){B(t,e)}]}class ft extends rt{constructor(t){super(),nt(this,t,dt,ut,l,{collapsed:0})}}function ht(t){let e,n,r;return{c(){e=m("svg"),n=m("path"),r=m("path"),y(n,"d","M0 0h24v24H0V0z"),y(n,"fill","none"),y(r,"d","M3 18h13v-2H3v2zm0-5h10v-2H3v2zm0-7v2h13V6H3zm18 9.59L17.42 12 21 8.41 19.59 7l-5 5 5 5L21 15.59z"),y(e,"xmlns","http://www.w3.org/2000/svg"),y(e,"viewBox","0 0 24 24"),y(e,"class","fill-current h-full")},m(t,s){f(t,e,s),d(e,n),d(e,r)},d(t){t&&h(e)}}}function pt(t){let e,n,r;return{c(){e=m("svg"),n=m("path"),r=m("path"),y(n,"d","M0 0h24v24H0z"),y(n,"fill","none"),y(r,"d","M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"),y(e,"xmlns","http://www.w3.org/2000/svg"),y(e,"viewBox","0 0 24 24"),y(e,"class","fill-current h-full")},m(t,s){f(t,e,s),d(e,n),d(e,r)},d(t){t&&h(e)}}}function gt(e){let n,r,s;function l(t,e){return t[0]?pt:ht}let o=l(e),c=o(e);return{c(){n=g("button"),c.c(),y(n,"class","text-gray-300 h-8 p-1 rounded hover:bg-gray-700 focus:outline-none")},m(t,l){f(t,n,l),c.m(n,null),r||(s=x(n,"click",e[1]),r=!0)},p(t,[e]){o!==(o=l(t))&&(c.d(1),c=o(t),c&&(c.c(),c.m(n,null)))},i:t,o:t,d(t){t&&h(n),c.d(),r=!1,s()}}}function mt(t,e,n){let{collapsed:r}=e;return t.$$set=t=>{"collapsed"in t&&n(0,r=t.collapsed)},[r,function(e){B(t,e)}]}class $t extends rt{constructor(t){super(),nt(this,t,mt,gt,l,{collapsed:0})}}function wt(t){let e,n,r;return{c(){e=m("svg"),n=m("path"),r=m("path"),y(n,"d","M0 0h24v24H0z"),y(n,"fill","none"),y(r,"d","M17 3H7c-1.1 0-1.99.9-1.99 2L5 21l7-3 7 3V5c0-1.1-.9-2-2-2zm0 15l-5-2.18L7 18V5h10v13z"),y(e,"xmlns","http://www.w3.org/2000/svg"),y(e,"viewBox","0 0 24 24"),y(e,"class","fill-current w-full")},m(t,s){f(t,e,s),d(e,n),d(e,r)},d(t){t&&h(e)}}}function vt(t){let e,n,r;return{c(){e=m("svg"),n=m("path"),r=m("path"),y(n,"d","M0 0h24v24H0z"),y(n,"fill","none"),y(r,"d","M21.41 11.58l-9-9C12.05 2.22 11.55 2 11 2H4c-1.1 0-2 .9-2 2v7c0 .55.22 1.05.59 1.42l9 9c.36.36.86.58 1.41.58.55 0 1.05-.22 1.41-.59l7-7c.37-.36.59-.86.59-1.41 0-.55-.23-1.06-.59-1.42zM5.5 7C4.67 7 4 6.33 4 5.5S4.67 4 5.5 4 7 4.67 7 5.5 6.33 7 5.5 7z"),y(e,"xmlns","http://www.w3.org/2000/svg"),y(e,"viewBox","0 0 24 24"),y(e,"class","fill-current w-full")},m(t,s){f(t,e,s),d(e,n),d(e,r)},d(t){t&&h(e)}}}function xt(t){let e,n,r;return{c(){e=m("svg"),n=m("path"),r=m("path"),y(n,"d","M0 0h24v24H0z"),y(n,"fill","none"),y(r,"d","M10 9V5l-7 7 7 7v-4.1c5 0 8.5 1.6 11 5.1-1-5-4-10-11-11z"),y(e,"xmlns","http://www.w3.org/2000/svg"),y(e,"viewBox","0 0 24 24"),y(e,"class","fill-current w-full")},m(t,s){f(t,e,s),d(e,n),d(e,r)},d(t){t&&h(e)}}}function bt(t){let e,n,r;return{c(){e=m("svg"),n=m("path"),r=m("path"),y(n,"d","M0 0h24v24H0z"),y(n,"fill","none"),y(r,"d","M16.5 6v11.5c0 2.21-1.79 4-4 4s-4-1.79-4-4V5c0-1.38 1.12-2.5 2.5-2.5s2.5 1.12 2.5 2.5v10.5c0 .55-.45 1-1 1s-1-.45-1-1V6H10v9.5c0 1.38 1.12 2.5 2.5 2.5s2.5-1.12 2.5-2.5V5c0-2.21-1.79-4-4-4S7 2.79 7 5v12.5c0 3.04 2.46 5.5 5.5 5.5s5.5-2.46 5.5-5.5V6h-1.5z"),y(e,"xmlns","http://www.w3.org/2000/svg"),y(e,"viewBox","0 0 24 24"),y(e,"class","fill-current w-full")},m(t,s){f(t,e,s),d(e,n),d(e,r)},d(t){t&&h(e)}}}function yt(t){let e,n,r;return{c(){e=m("svg"),n=m("path"),r=m("path"),y(n,"d","M0 0h24v24H0z"),y(n,"fill","none"),y(r,"d","M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"),y(e,"xmlns","http://www.w3.org/2000/svg"),y(e,"viewBox","0 0 24 24"),y(e,"class","fill-current w-full")},m(t,s){f(t,e,s),d(e,n),d(e,r)},d(t){t&&h(e)}}}function Mt(t){let e,n,r;return{c(){e=m("svg"),n=m("path"),r=m("path"),y(n,"d","M0 0h24v24H0z"),y(n,"fill","none"),y(r,"d","M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.42 0-8-3.58-8-8 0-1.85.63-3.55 1.69-4.9L16.9 18.31C15.55 19.37 13.85 20 12 20zm6.31-3.1L7.1 5.69C8.45 4.63 10.15 4 12 4c4.42 0 8 3.58 8 8 0 1.85-.63 3.55-1.69 4.9z"),y(e,"xmlns","http://www.w3.org/2000/svg"),y(e,"viewBox","0 0 24 24"),y(e,"class","fill-current w-full")},m(t,s){f(t,e,s),d(e,n),d(e,r)},d(t){t&&h(e)}}}function kt(t){let e,n,r;return{c(){e=m("svg"),n=m("path"),r=m("path"),y(n,"d","M0 0h24v24H0z"),y(n,"fill","none"),y(r,"d","M21.99 8c0-.72-.37-1.35-.94-1.7L12 1 2.95 6.3C2.38 6.65 2 7.28 2 8v10c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2l-.01-10zM12 13L3.74 7.84 12 3l8.26 4.84L12 13z"),y(e,"xmlns","http://www.w3.org/2000/svg"),y(e,"viewBox","0 0 24 24"),y(e,"class","fill-current w-full")},m(t,s){f(t,e,s),d(e,n),d(e,r)},d(t){t&&h(e)}}}function zt(t){let e,n,r;return{c(){e=m("svg"),n=m("path"),r=m("path"),y(n,"d","M0 0h24v24H0V0z"),y(n,"fill","none"),y(r,"d","M19 3H4.99c-1.11 0-1.98.9-1.98 2L3 19c0 1.1.88 2 1.99 2H19c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 12h-4c0 1.66-1.35 3-3 3s-3-1.34-3-3H4.99V5H19v10zM8 11h2v3h4v-3h2l-4-4-4 4z"),y(e,"xmlns","http://www.w3.org/2000/svg"),y(e,"viewBox","0 0 24 24"),y(e,"class","fill-current w-full")},m(t,s){f(t,e,s),d(e,n),d(e,r)},d(t){t&&h(e)}}}function Ht(t){let e,n,r,s,l;return{c(){e=m("svg"),n=m("g"),r=m("rect"),s=m("g"),l=m("path"),y(r,"fill","none"),y(r,"height","24"),y(r,"width","24"),y(l,"d","M20,2H4C3,2,2,2.9,2,4v3.01C2,7.73,2.43,8.35,3,8.7V20c0,1.1,1.1,2,2,2h14c0.9,0,2-0.9,2-2V8.7c0.57-0.35,1-0.97,1-1.69V4 C22,2.9,21,2,20,2z M15,14H9v-2h6V14z M20,7H4V4h16V7z"),y(e,"xmlns","http://www.w3.org/2000/svg"),y(e,"enable-background","new 0 0 24 24"),y(e,"viewBox","0 0 24 24"),y(e,"class","fill-current w-full")},m(t,o){f(t,e,o),d(e,n),d(n,r),d(e,s),d(s,l)},d(t){t&&h(e)}}}function Tt(t){let e,n,r;return{c(){e=m("svg"),n=m("path"),r=m("path"),y(n,"d","M0 0h24v24H0V0z"),y(n,"fill","none"),y(r,"d","M19 3H4.99c-1.11 0-1.98.89-1.98 2L3 19c0 1.1.88 2 1.99 2H19c1.1 0 2-.9 2-2V5c0-1.11-.9-2-2-2zm0 12h-4c0 1.66-1.35 3-3 3s-3-1.34-3-3H4.99V5H19v10z"),y(e,"xmlns","http://www.w3.org/2000/svg"),y(e,"viewBox","0 0 24 24"),y(e,"class","fill-current w-full")},m(t,s){f(t,e,s),d(e,n),d(e,r)},d(t){t&&h(e)}}}function Ct(e){let n;function r(t,e){return"inbox"===t[0]?Tt:"archive"===t[0]?Ht:"sent"===t[0]?zt:"draft"===t[0]?kt:"spam"===t[0]?Mt:"trash"===t[0]?yt:"attachment"===t[0]?bt:"replied"===t[0]?xt:"tag"===t[1]?vt:wt}let s=r(e),l=s(e);return{c(){l.c(),n=v()},m(t,e){l.m(t,e),f(t,n,e)},p(t,[e]){s!==(s=r(t))&&(l.d(1),l=s(t),l&&(l.c(),l.m(n.parentNode,n)))},i:t,o:t,d(t){l.d(t),t&&h(n)}}}function Vt(t,e,n){let{id:r}=e,{iconType:s="inbox"}=e;return t.$$set=t=>{"id"in t&&n(0,r=t.id),"iconType"in t&&n(1,s=t.iconType)},[r,s]}class Lt extends rt{constructor(t){super(),nt(this,t,Vt,Ct,l,{id:0,iconType:1})}}const Bt=["inbox","archive","sent","draft","spam","trash"],jt={inbox:"Inbox",archive:"Archive",sent:"Sent",draft:"Drafts",spam:"Spam",trash:"Trash"},St=[];function Et(e,n=t){let r;const s=[];function o(t){if(l(e,t)&&(e=t,r)){const t=!St.length;for(let t=0;t<s.length;t+=1){const n=s[t];n[1](),St.push(n,e)}if(t){for(let t=0;t<St.length;t+=2)St[t][0](St[t+1]);St.length=0}}}return{set:o,update:function(t){o(t(e))},subscribe:function(l,c=t){const a=[l,c];return s.push(a),1===s.length&&(r=n(o)||t),l(e),()=>{const t=s.indexOf(a);-1!==t&&s.splice(t,1),0===s.length&&(r(),r=null)}}}}function Nt(e,n,l){const c=!Array.isArray(e),a=c?[e]:e,i=n.length<2;return{subscribe:Et(l,(e=>{let l=!1;const u=[];let d=0,f=t;const h=()=>{if(d)return;f();const r=n(c?u[0]:u,e);i?e(r):f=s(r)?r:t},p=a.map(((t,e)=>o(t,(t=>{u[e]=t,d&=~(1<<e),l&&h()}),(()=>{d|=1<<e}))));return l=!0,h(),function(){r(p),f()}})).subscribe}}class _t{static default=new _t("/api");constructor(t){this.baseURL=t}async request(t="GET",e,n){const r=await fetch(`${this.baseURL}${e}`,{method:t,headers:{"Content-Type":"application/json",Accept:"application/json"},body:n?JSON.stringify(n):null});if(r.ok)return r.json();throw new qt(r.status,r.statusText)}mailboxes(){return this.request("GET","/mailboxes")}threads(t,e=0,n=50){return this.request("GET",`/search/${t}?page=${e}&per=${n}`)}thread(t){return this.request("GET",`/threads/${t}`)}updateTags(t,e){return this.request("PUT","/tags",{terms:t,tags:e})}async sendMessage(t){const e=new FormData;t.to.forEach((t=>e.append("to[]",t))),t.cc.forEach((t=>e.append("cc[]",t))),e.append("subject",t.subject),e.append("body",t.body),Object.keys(t.headers).forEach((n=>e.append(`headers[${n}]`,t.headers[n]))),t.attachments.forEach((t=>e.append("attachments[]",t,t.name)));const n=await fetch(`${this.baseURL}/messages`,{method:"POST",body:e});if(n.ok)return null;throw new qt(n.status,n.statusText)}replyToMessage(t,e){return this.request("GET",`/messages/${btoa(t)}/reply?reply-to=${e}`)}}class qt extends Error{constructor(t,e){super(`Invalid response ${t}: ${e}`),this.status=t}}const Ft=Et(0),Ot=Et(0),{subscribe:It,set:Dt,update:Pt}=Et([]);var Ut={subscribe:It,fetch:async(t,e)=>{if(!t)return Dt([]),[];const{total:n,threads:r}=await _t.default.threads(t,e||0,50);return Ot.set(n),Dt(r),r},setTags:(t,e)=>{Pt((n=>n.map((n=>n.thread===t?{...n,tags:e}:n))))}};const{subscribe:At,set:Rt,update:Wt}=Et(null);var Gt={subscribe:At,selectMessage:function(t){Rt(t)}};const Jt=new URL(window.location.href),Kt=Et(Jt),[,Qt,Xt]=Jt.pathname.split("/");Jt.mailbox=Qt,"search"===Qt?Jt.searchTerms=Jt.searchParams.get("terms"):Jt.thread=Xt;const Yt=({state:t})=>{const e=new URL(window.location.href);e.mailbox=t?.mailbox,e.thread=t?.thread,e.searchTerms=t?.searchTerms,Kt.set(e)};function Zt(t,e){history.pushState(t,"",e),Yt({state:t}),console.debug(`navigating to ${e}, state: `,t)}window.addEventListener("popstate",Yt);const te=Nt(Kt,(t=>t));var ee={subscribe:te.subscribe,selectMailbox:function(t){Ft.set(0),Zt({mailbox:t},`/${t}`)},selectThread:function(t,e){const n=history.state,r={mailbox:t,thread:e,searchTerms:n.searchTerms};let s=`/${t}/${e}`;n.searchTerms&&(s+=`?terms=${escape(n.searchTerms)}`),Zt(r,s)},deselectThread:function(){const t=history.state;Gt.selectMessage(null),Zt({mailbox:t.mailbox,thread:null},`/${t.mailbox}`)},search:function(t){Zt({mailbox:"search",searchTerms:t},`/search/?terms=${escape(t)}`)}};const ne=Nt(te,(t=>t.mailbox?.length>0?t.mailbox:Bt[0])),re=Nt(te,(t=>t.thread)),se=Nt(te,(t=>t.searchTerms)),le=Et(null),oe=Et(null),{subscribe:ce,set:ae,update:ie}=Et([]);var ue={subscribe:ce,fetch:async()=>{const t=await _t.default.mailboxes();return ae(t.mailboxes),le.set(t.address),oe.set(t.name),t.mailboxes},updateUnreadCounters:async()=>{const{mailboxes:t}=await _t.default.mailboxes();ie((e=>e.map(((e,n)=>({...e,unread:t[n].unread})))))}};function de(t,e,n){const r=t.slice();return r[5]=e[n],r[7]=n,r}function fe(e){return{c:t,m:t,p:t,i:t,o:t,d:t}}function he(t){let e,n,r=t[1],s=[];for(let e=0;e<r.length;e+=1)s[e]=be(de(t,r,e));const l=t=>Q(s[t],1,1,(()=>{s[t]=null}));return{c(){for(let t=0;t<s.length;t+=1)s[t].c();e=v()},m(t,r){for(let e=0;e<s.length;e+=1)s[e].m(t,r);f(t,e,r),n=!0},p(t,n){if(7&n){let o;for(r=t[1],o=0;o<r.length;o+=1){const l=de(t,r,o);s[o]?(s[o].p(l,n),K(s[o],1)):(s[o]=be(l),s[o].c(),K(s[o],1),s[o].m(e.parentNode,e))}for(G(),o=r.length;o<s.length;o+=1)l(o);J()}},i(t){if(!n){for(let t=0;t<r.length;t+=1)K(s[t]);n=!0}},o(t){s=s.filter(Boolean);for(let t=0;t<s.length;t+=1)Q(s[t]);n=!1},d(t){p(s,t),t&&h(e)}}}function pe(t){let e,n,r,s,l,o=(jt[t[5].id]||t[5].id)+"";return n=new Lt({props:{id:t[5].id}}),{c(){e=g("span"),Z(n.$$.fragment),r=w(),s=$(o),y(e,"class","mr-2 w-5")},m(t,o){f(t,e,o),tt(n,e,null),f(t,r,o),f(t,s,o),l=!0},p(t,e){const r={};2&e&&(r.id=t[5].id),n.$set(r),(!l||2&e)&&o!==(o=(jt[t[5].id]||t[5].id)+"")&&M(s,o)},i(t){l||(K(n.$$.fragment,t),l=!0)},o(t){Q(n.$$.fragment,t),l=!1},d(t){t&&h(e),et(n),t&&h(r),t&&h(s)}}}function ge(t){let e,n,r,s;const l=[$e,me],o=[];function c(t,e){return jt[t[5].id]?0:1}return e=c(t),n=o[e]=l[e](t),{c(){n.c(),r=v()},m(t,n){o[e].m(t,n),f(t,r,n),s=!0},p(t,s){let a=e;e=c(t),e===a?o[e].p(t,s):(G(),Q(o[a],1,1,(()=>{o[a]=null})),J(),n=o[e],n?n.p(t,s):(n=o[e]=l[e](t),n.c()),K(n,1),n.m(r.parentNode,r))},i(t){s||(K(n),s=!0)},o(t){Q(n),s=!1},d(t){o[e].d(t),t&&h(r)}}}function me(t){let e,n,r,s,l,o,c=t[5].id[0]+"";return n=new Lt({props:{id:t[5].id}}),{c(){e=g("span"),Z(n.$$.fragment),r=w(),s=g("span"),l=$(c),y(e,"class","w-7"),y(s,"class","absolute text-sm left-1/2 top-1/2 transform -translate-x-1/2 -translate-y-2/3")},m(t,c){f(t,e,c),tt(n,e,null),f(t,r,c),f(t,s,c),d(s,l),o=!0},p(t,e){const r={};2&e&&(r.id=t[5].id),n.$set(r),(!o||2&e)&&c!==(c=t[5].id[0]+"")&&M(l,c)},i(t){o||(K(n.$$.fragment,t),o=!0)},o(t){Q(n.$$.fragment,t),o=!1},d(t){t&&h(e),et(n),t&&h(r),t&&h(s)}}}function $e(t){let e,n,r;return n=new Lt({props:{id:t[5].id}}),{c(){e=g("span"),Z(n.$$.fragment),y(e,"class","w-5")},m(t,s){f(t,e,s),tt(n,e,null),r=!0},p(t,e){const r={};2&e&&(r.id=t[5].id),n.$set(r)},i(t){r||(K(n.$$.fragment,t),r=!0)},o(t){Q(n.$$.fragment,t),r=!1},d(t){t&&h(e),et(n)}}}function we(t){let e;function n(t,e){return t[0]?xe:ve}let r=n(t),s=r(t);return{c(){s.c(),e=v()},m(t,n){s.m(t,n),f(t,e,n)},p(t,l){r===(r=n(t))&&s?s.p(t,l):(s.d(1),s=r(t),s&&(s.c(),s.m(e.parentNode,e)))},d(t){s.d(t),t&&h(e)}}}function ve(t){let e,n,r,s=t[5].unread+"";return{c(){e=g("span"),n=$(s),y(e,"class",r="inline-flex items-center text-sm px-2 rounded "+("inbox"===t[5].id?"bg-red-600 text-gray-100":"bg-gray-300 text-gray-600"))},m(t,r){f(t,e,r),d(e,n)},p(t,l){2&l&&s!==(s=t[5].unread+"")&&M(n,s),2&l&&r!==(r="inline-flex items-center text-sm px-2 rounded "+("inbox"===t[5].id?"bg-red-600 text-gray-100":"bg-gray-300 text-gray-600"))&&y(e,"class",r)},d(t){t&&h(e)}}}function xe(e){let n;return{c(){n=g("span"),y(n,"class","bg-red-600 absolute -top-1 -right-1 w-2 h-2 rounded-sm")},m(t,e){f(t,n,e)},p:t,d(t){t&&h(n)}}}function be(t){let e,n,r,s,l,o,c,a,i,u,p;const m=[ge,pe],$=[];function v(t,e){return t[0]?0:1}function M(){return t[3](t[5])}r=v(t),s=$[r]=m[r](t);let k=t[5].unread>0&&we(t);return{c(){e=g("li"),n=g("a"),s.c(),o=w(),k&&k.c(),c=w(),y(n,"href",l=`/${t[5].id}`),y(n,"class","flex flex-row items-center hover:text-red-500 visited:text-current"),y(e,"class",a=`relative p-1 mb-2 flex flex-row ${t[0]?"justify-center":"justify-between"} ${t[2]===t[5].id?"text-red-500 font-semibold":"text-gray-300"}`)},m(t,s){f(t,e,s),d(e,n),$[r].m(n,null),d(e,o),k&&k.m(e,null),d(e,c),i=!0,u||(p=x(n,"click",b(M)),u=!0)},p(o,u){let d=r;r=v(t=o),r===d?$[r].p(t,u):(G(),Q($[d],1,1,(()=>{$[d]=null})),J(),s=$[r],s?s.p(t,u):(s=$[r]=m[r](t),s.c()),K(s,1),s.m(n,null)),(!i||2&u&&l!==(l=`/${t[5].id}`))&&y(n,"href",l),t[5].unread>0?k?k.p(t,u):(k=we(t),k.c(),k.m(e,c)):k&&(k.d(1),k=null),(!i||7&u&&a!==(a=`relative p-1 mb-2 flex flex-row ${t[0]?"justify-center":"justify-between"} ${t[2]===t[5].id?"text-red-500 font-semibold":"text-gray-300"}`))&&y(e,"class",a)},i(t){i||(K(s),i=!0)},o(t){Q(s),i=!1},d(t){t&&h(e),$[r].d(),k&&k.d(),u=!1,p()}}}function ye(e){return{c:t,m:t,p:t,i:t,o:t,d:t}}function Me(t){let e,n,r={ctx:t,current:null,token:null,hasCatch:!1,pending:ye,then:he,catch:fe,value:4,blocks:[,,,]};return function(t,e){const n=e.token={};function r(t,r,s,l){if(e.token!==n)return;e.resolved=l;let o=e.ctx;void 0!==s&&(o=o.slice(),o[s]=l);const c=t&&(e.current=t)(o);let a=!1;e.block&&(e.blocks?e.blocks.forEach(((t,n)=>{n!==r&&t&&(G(),Q(t,1,1,(()=>{e.blocks[n]===t&&(e.blocks[n]=null)})),J())})):e.block.d(1),c.c(),K(c,1),c.m(e.mount(),e.anchor),a=!0),e.block=c,e.blocks&&(e.blocks[r]=c),a&&U()}if((s=t)&&"object"==typeof s&&"function"==typeof s.then){const n=V();if(t.then((t=>{C(n),r(e.then,1,e.value,t),C(null)}),(t=>{if(C(n),r(e.catch,2,e.error,t),C(null),!e.hasCatch)throw t})),e.current!==e.pending)return r(e.pending,0),!0}else{if(e.current!==e.then)return r(e.then,1,e.value,t),!0;e.resolved=t}var s}(ue.fetch(),r),{c(){e=g("ul"),r.block.c()},m(t,s){f(t,e,s),r.block.m(e,r.anchor=null),r.mount=()=>e,r.anchor=null,n=!0},p(e,[n]){!function(t,e,n){const r=e.slice(),{resolved:s}=t;t.current===t.then&&(r[t.value]=s),t.current===t.catch&&(r[t.error]=s),t.block.p(r,n)}(r,t=e,n)},i(t){n||(K(r.block),n=!0)},o(t){for(let t=0;t<3;t+=1){Q(r.blocks[t])}n=!1},d(t){t&&h(e),r.block.d(),r.token=null,r=null}}}function ke(t,e,n){let r,s;c(t,ue,(t=>n(1,r=t))),c(t,ne,(t=>n(2,s=t)));let{collapsed:l}=e;return t.$$set=t=>{"collapsed"in t&&n(0,l=t.collapsed)},[l,r,s,t=>ee.selectMailbox(t.id)]}class ze extends rt{constructor(t){super(),nt(this,t,ke,Me,l,{collapsed:0})}}function He(e){let n,s,l,o,c,a,i,u;return{c(){n=g("div"),s=m("svg"),l=m("path"),o=m("path"),c=w(),a=g("input"),y(l,"d","M0 0h24v24H0z"),y(l,"fill","none"),y(o,"d","M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"),y(s,"xmlns","http://www.w3.org/2000/svg"),y(s,"viewBox","0 0 24 24"),y(s,"class","fill-current w-5 absolute left-2 top-1/2 transform -translate-y-1/2"),y(a,"type","search"),y(a,"class","w-96 h-full outline-none pl-8 pr-1 py-1 bg-gray-600 text-sm border rounded border-gray-500 hover:border-gray-400 focus:border-gray-400"),y(a,"placeholder","Search threads"),y(n,"class","relative text-gray-300")},m(t,r){f(t,n,r),d(n,s),d(s,l),d(s,o),d(n,c),d(n,a),k(a,e[0]),i||(u=[x(a,"keypress",e[1]),x(a,"input",e[3])],i=!0)},p(t,[e]){1&e&&k(a,t[0])},i:t,o:t,d(t){t&&h(n),i=!1,r(u)}}}function Te(t,e,n){let r,s;return c(t,se,(t=>n(2,s=t))),t.$$.update=()=>{4&t.$$.dirty&&n(0,r=s)},[r,function({charCode:t}){13===t&&ee.search(r)},s,function(){r=this.value,n(0,r),n(2,s)}]}class Ce extends rt{constructor(t){super(),nt(this,t,Te,He,l,{})}}const{subscribe:Ve,set:Le,update:Be}=Et(null);function je(t,e){if(!t)return null;for(const[n,r]of t){if(n.id===e)return n;const t=je(r,e);if(t)return t}return null}function Se(t,e,n=[],r=[]){if(!t)return null;for(const[s,l]of t){if(s.id!=e&&n.every((t=>s.tags.includes(t)))&&r.every((t=>!s.tags.includes(t))))return s;const t=Se(l,e,n,r);if(t)return t}return null}function Ee(t,e,n=[],r=[]){const s=Ne(t,e,n,r).sort(((t,e)=>e.timestamp-t.timestamp));return s.length>0?s[0]:null}function Ne(t,e,n,r,s=[]){if(!t)return s;for(const[l,o]of t)l.id!=e&&n.every((t=>l.tags.includes(t)))&&r.every((t=>!l.tags.includes(t)))&&s.push(l),Ne(o,e,n,r,s);return s}function _e(t,e){for(const[n,r]of e)n.tags.forEach((e=>t.add(e))),_e(t,r);return t}var qe={subscribe:Ve,fetch:async t=>{if(!t)return Le(null),null;const e=await _t.default.thread(t);return Le(e),e},updateTags:function(t,e){const n=new Set;return Be((r=>{const s=je(r,t);return s&&(s.tags=e),_e(n,r),r})),[...n]}};async function Fe(t,e,n){if(!e||!t)return[];const r=await _t.default.updateTags(`id:${e}`,n),s=qe.updateTags(e,r);return Ut.setTags(t,s),ue.updateUnreadCounters(),r}async function Oe(t,e){if(!t)return[];const n=await _t.default.updateTags(`thread:${t}`,e);return Ut.setTags(t,n),await ue.updateUnreadCounters(),n}async function Ie(t,e){return e.tags.includes("unread")?await Fe(t,e.id,["-unread"]):[]}function De(t,e,n){const r=t.find((({id:t})=>t===e)).tags,s=t.find((({id:t})=>t===n)).tags,l=[];return t.forEach((({tags:t})=>t.forEach((t=>!s.includes(t)&&l.push(`-${t}`))))),s.forEach((t=>l.push(`+${t}`))),{changes:l,fromTags:r,toTags:s}}const{subscribe:Pe,update:Ue}=Et([]);var Ae={subscribe:Pe,toggle:function({thread:t}){Ue((e=>e.includes(t)?e.filter((e=>e!==t)):[...e,t]))}};function Re(t){let e,n,r,s,l,o,c,i;const p=t[8].default,m=a(p,t,t[7],null);return{c(){e=g("button"),m&&m.c(),n=w(),r=g("span"),s=$(t[0]),e.disabled=t[2],y(e,"class","w-9 p-2 rounded hover:border-gray-500 bg-white text-gray-700 active:bg-gray-300 focus:outline-none border"),y(r,"class",l=`absolute -top-full z-50 transform ${t[4]} -translate-y-2 p-2 whitespace-nowrap rounded bg-gray-800 text-white ${t[5]?"":"hidden"}`)},m(l,a){f(l,e,a),m&&m.m(e,null),f(l,n,a),f(l,r,a),d(r,s),o=!0,c||(i=x(e,"click",t[10]),c=!0)},p(t,n){m&&m.p&&(!o||128&n)&&u(m,p,t,t[7],n,null,null),(!o||4&n)&&(e.disabled=t[2]),(!o||1&n)&&M(s,t[0]),(!o||48&n&&l!==(l=`absolute -top-full z-50 transform ${t[4]} -translate-y-2 p-2 whitespace-nowrap rounded bg-gray-800 text-white ${t[5]?"":"hidden"}`))&&y(r,"class",l)},i(t){o||(K(m,t),o=!0)},o(t){Q(m,t),o=!1},d(t){t&&h(e),m&&m.d(t),t&&h(n),t&&h(r),c=!1,i()}}}function We(t){let e,n,r,s,l,o,c,i;const p=t[8].default,m=a(p,t,t[7],null);return{c(){e=g("button"),m&&m.c(),n=w(),r=g("span"),s=$(t[0]),e.disabled=t[2],y(e,"class","h-full p-2 rounded text-gray-300 focus:outline-none hover:text-gray-100 active:text-gray-100 disabled:opacity-25"),y(r,"class",l=`absolute -bottom-full z-50 transform ${t[4]} translate-y-2 p-2 whitespace-nowrap rounded bg-gray-800 text-white ${t[5]?"":"hidden"}`)},m(l,a){f(l,e,a),m&&m.m(e,null),f(l,n,a),f(l,r,a),d(r,s),o=!0,c||(i=x(e,"click",t[9]),c=!0)},p(t,n){m&&m.p&&(!o||128&n)&&u(m,p,t,t[7],n,null,null),(!o||4&n)&&(e.disabled=t[2]),(!o||1&n)&&M(s,t[0]),(!o||48&n&&l!==(l=`absolute -bottom-full z-50 transform ${t[4]} translate-y-2 p-2 whitespace-nowrap rounded bg-gray-800 text-white ${t[5]?"":"hidden"}`))&&y(r,"class",l)},i(t){o||(K(m,t),o=!0)},o(t){Q(m,t),o=!1},d(t){t&&h(e),m&&m.d(t),t&&h(n),t&&h(r),c=!1,i()}}}function Ge(t){let e,n,s,l,o,c,a;const i=[We,Re],u=[];function d(t,e){return"toolbar"===t[1]?0:1}return n=d(t),s=u[n]=i[n](t),{c(){e=g("div"),s.c(),y(e,"class",l="h-full relative "+t[3])},m(r,s){f(r,e,s),u[n].m(e,null),o=!0,c||(a=[x(e,"mouseover",t[11]),x(e,"mouseout",t[12])],c=!0)},p(t,[r]){let c=n;n=d(t),n===c?u[n].p(t,r):(G(),Q(u[c],1,1,(()=>{u[c]=null})),J(),s=u[n],s?s.p(t,r):(s=u[n]=i[n](t),s.c()),K(s,1),s.m(e,null)),(!o||8&r&&l!==(l="h-full relative "+t[3]))&&y(e,"class",l)},i(t){o||(K(s),o=!0)},o(t){Q(s),o=!1},d(t){t&&h(e),u[n].d(),c=!1,r(a)}}}function Je(t,e,n){let{$$slots:r={},$$scope:s}=e,{tooltip:l}=e,{tooltipPosition:o="center"}=e,{variant:c="message"}=e,{disabled:a=!1}=e,{class:i=""}=e,u="-translate-x-1/2",d=!1;return t.$$set=t=>{"tooltip"in t&&n(0,l=t.tooltip),"tooltipPosition"in t&&n(6,o=t.tooltipPosition),"variant"in t&&n(1,c=t.variant),"disabled"in t&&n(2,a=t.disabled),"class"in t&&n(3,i=t.class),"$$scope"in t&&n(7,s=t.$$scope)},t.$$.update=()=>{64&t.$$.dirty&&n(4,u="left"===o?"left-0":"right"===o?"right-0":"left-4 -translate-x-1/2")},[l,c,a,i,u,d,o,s,r,function(e){B(t,e)},function(e){B(t,e)},()=>n(5,d=!0),()=>n(5,d=!1)]}class Ke extends rt{constructor(t){super(),nt(this,t,Je,Ge,l,{tooltip:0,tooltipPosition:6,variant:1,disabled:2,class:3})}}function Qe(t){let e,n,r,s,l,o,c,a,i,u;return r=new Lt({props:{id:t[0],iconType:"tag"}}),{c(){e=g("div"),n=g("span"),Z(r.$$.fragment),s=w(),l=g("span"),o=$(t[0]),y(n,"class","w-4 mr-1 flex-shrink-0"),y(e,"class",c="inline-flex items-center text-gray-600 text-sm max-w-xs truncate "+t[1]+" "+t[2])},m(c,h){f(c,e,h),d(e,n),tt(r,n,null),d(e,s),d(e,l),d(l,o),a=!0,i||(u=x(e,"click",t[4]),i=!0)},p(t,[n]){const s={};1&n&&(s.id=t[0]),r.$set(s),(!a||1&n)&&M(o,t[0]),(!a||6&n&&c!==(c="inline-flex items-center text-gray-600 text-sm max-w-xs truncate "+t[1]+" "+t[2]))&&y(e,"class",c)},i(t){a||(K(r.$$.fragment,t),a=!0)},o(t){Q(r.$$.fragment,t),a=!1},d(t){t&&h(e),et(r),i=!1,u()}}}function Xe(t,e,n){let r,{tag:s}=e,{viewOnly:l=!0}=e,{class:o=""}=e;return t.$$set=t=>{"tag"in t&&n(0,s=t.tag),"viewOnly"in t&&n(3,l=t.viewOnly),"class"in t&&n(1,o=t.class)},t.$$.update=()=>{8&t.$$.dirty&&n(2,r=l?"":"cursor-pointer hover:text-red-500")},[s,o,r,l,function(e){B(t,e)}]}class Ye extends rt{constructor(t){super(),nt(this,t,Xe,Qe,l,{tag:0,viewOnly:3,class:1})}}function Ze(t,e,n){const r=t.slice();return r[8]=e[n],r}function tn(t){let e,n;return e=new Ye({props:{class:"mb-2 mr-2",viewOnly:!1,tag:t[8]}}),e.$on("click",(function(){return t[7](t[8])})),{c(){Z(e.$$.fragment)},m(t,r){tt(e,t,r),n=!0},p(n,r){t=n;const s={};1&r&&(s.tag=t[8]),e.$set(s)},i(t){n||(K(e.$$.fragment,t),n=!0)},o(t){Q(e.$$.fragment,t),n=!1},d(t){et(e,t)}}}function en(t){let e,n,s,l,o,c,a,i,u,m,$,v,b=t[0],M=[];for(let e=0;e<b.length;e+=1)M[e]=tn(Ze(t,b,e));const z=t=>Q(M[t],1,1,(()=>{M[t]=null}));return{c(){e=g("div"),n=g("button"),n.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="w-full fill-current"><path d="M0 0h24v24H0z" fill="none"></path><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg>',s=w(),l=g("h3"),l.textContent="Labels",o=w(),c=g("input"),a=w(),i=g("div");for(let t=0;t<M.length;t+=1)M[t].c();y(n,"class","absolute w-5 top-2 right-2 text-gray-500 order-0 hover:text-gray-800 active:text-gray-500 focus:outline-none"),y(l,"class","mb-1 font-semibold text-gray-700"),y(c,"type","text"),y(c,"placeholder","Type in a new tag"),y(c,"class","w-full outline-none mb-4 px-3 py-1 bg-white text-sm text-gray-700 rounded border border-gray-400 hover:border-gray-500 focus:border-red-300"),y(i,"class","flex flex-row flex-wrap"),y(e,"class",u=t[1]+" w-72 p-4 bg-white border-2 border-gray-600 rounded shadow")},m(r,u){f(r,e,u),d(e,n),d(e,s),d(e,l),d(e,o),d(e,c),k(c,t[2]),d(e,a),d(e,i);for(let t=0;t<M.length;t+=1)M[t].m(i,null);m=!0,$||(v=[x(n,"click",t[5]),x(c,"keypress",t[4]),x(c,"input",t[6])],$=!0)},p(t,[n]){if(4&n&&c.value!==t[2]&&k(c,t[2]),9&n){let e;for(b=t[0],e=0;e<b.length;e+=1){const r=Ze(t,b,e);M[e]?(M[e].p(r,n),K(M[e],1)):(M[e]=tn(r),M[e].c(),K(M[e],1),M[e].m(i,null))}for(G(),e=b.length;e<M.length;e+=1)z(e);J()}(!m||2&n&&u!==(u=t[1]+" w-72 p-4 bg-white border-2 border-gray-600 rounded shadow"))&&y(e,"class",u)},i(t){if(!m){for(let t=0;t<b.length;t+=1)K(M[t]);m=!0}},o(t){M=M.filter(Boolean);for(let t=0;t<M.length;t+=1)Q(M[t]);m=!1},d(t){t&&h(e),p(M,t),$=!1,r(v)}}}function nn(t,e,n){let{tags:r=[]}=e,{class:s=""}=e;const l=L();let o="";return t.$$set=t=>{"tags"in t&&n(0,r=t.tags),"class"in t&&n(1,s=t.class)},[r,s,o,l,function({charCode:t}){13===t&&(l("add",o),n(2,o=""))},()=>l("close"),function(){o=this.value,n(2,o)},t=>l("remove",t)]}class rn extends rt{constructor(t){super(),nt(this,t,nn,en,l,{tags:0,class:1})}}function sn(t){let e,n,r,s,l;return{c(){e=m("svg"),n=m("g"),r=m("rect"),s=m("g"),l=m("path"),y(r,"fill","none"),y(r,"height","24"),y(r,"width","24"),y(l,"d","M20,2H4C3,2,2,2.9,2,4v3.01C2,7.73,2.43,8.35,3,8.7V20c0,1.1,1.1,2,2,2h14c0.9,0,2-0.9,2-2V8.7c0.57-0.35,1-0.97,1-1.69V4 C22,2.9,21,2,20,2z M15,14H9v-2h6V14z M20,7H4V4h16V7z"),y(e,"xmlns","http://www.w3.org/2000/svg"),y(e,"enable-background","new 0 0 24 24"),y(e,"viewBox","0 0 24 24"),y(e,"class","fill-current h-full")},m(t,o){f(t,e,o),d(e,n),d(n,r),d(e,s),d(s,l)},d(t){t&&h(e)}}}function ln(t){let e,n,r;return{c(){e=m("svg"),n=m("path"),r=m("path"),y(n,"d","M0 0h24v24H0z"),y(n,"fill","none"),y(r,"d","M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.42 0-8-3.58-8-8 0-1.85.63-3.55 1.69-4.9L16.9 18.31C15.55 19.37 13.85 20 12 20zm6.31-3.1L7.1 5.69C8.45 4.63 10.15 4 12 4c4.42 0 8 3.58 8 8 0 1.85-.63 3.55-1.69 4.9z"),y(e,"xmlns","http://www.w3.org/2000/svg"),y(e,"viewBox","0 0 24 24"),y(e,"class","h-full fill-current")},m(t,s){f(t,e,s),d(e,n),d(e,r)},d(t){t&&h(e)}}}function on(t){let e,n,r;return{c(){e=m("svg"),n=m("path"),r=m("path"),y(n,"d","M0 0h24v24H0z"),y(n,"fill","none"),y(r,"d","M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"),y(e,"xmlns","http://www.w3.org/2000/svg"),y(e,"viewBox","0 0 24 24"),y(e,"class","h-full fill-current")},m(t,s){f(t,e,s),d(e,n),d(e,r)},d(t){t&&h(e)}}}function cn(t){let e,n,r;return{c(){e=m("svg"),n=m("path"),r=m("path"),y(n,"d","M0 0h24v24H0z"),y(n,"fill","none"),y(r,"d","M21.41 11.58l-9-9C12.05 2.22 11.55 2 11 2H4c-1.1 0-2 .9-2 2v7c0 .55.22 1.05.59 1.42l9 9c.36.36.86.58 1.41.58.55 0 1.05-.22 1.41-.59l7-7c.37-.36.59-.86.59-1.41 0-.55-.23-1.06-.59-1.42zM5.5 7C4.67 7 4 6.33 4 5.5S4.67 4 5.5 4 7 4.67 7 5.5 6.33 7 5.5 7z"),y(e,"xmlns","http://www.w3.org/2000/svg"),y(e,"viewBox","0 0 24 24"),y(e,"class","h-full fill-current")},m(t,s){f(t,e,s),d(e,n),d(e,r)},d(t){t&&h(e)}}}function an(t){let e,n;return e=new rn({props:{class:"absolute",tags:t[1]}}),e.$on("add",t[4]),e.$on("remove",t[5]),e.$on("close",t[12]),{c(){Z(e.$$.fragment)},m(t,r){tt(e,t,r),n=!0},p(t,n){const r={};2&n&&(r.tags=t[1]),e.$set(r)},i(t){n||(K(e.$$.fragment,t),n=!0)},o(t){Q(e.$$.fragment,t),n=!1},d(t){et(e,t)}}}function un(t){let e,n,r,s,l,o,c,a,i,u,p;n=new Ke({props:{variant:"toolbar",tooltip:"Move to archive",class:"mr-1",disabled:t[0],$$slots:{default:[sn]},$$scope:{ctx:t}}}),n.$on("click",t[8]),s=new Ke({props:{variant:"toolbar",tooltip:"Move to spam",class:"mr-1",disabled:t[0],$$slots:{default:[ln]},$$scope:{ctx:t}}}),s.$on("click",t[9]),o=new Ke({props:{variant:"toolbar",tooltip:"Move to trash",class:"mr-1",disabled:t[0],$$slots:{default:[on]},$$scope:{ctx:t}}}),o.$on("click",t[10]),i=new Ke({props:{variant:"toolbar",tooltip:"Tag",disabled:t[0],$$slots:{default:[cn]},$$scope:{ctx:t}}}),i.$on("click",t[11]);let m=t[2]&&an(t);return{c(){e=g("div"),Z(n.$$.fragment),r=w(),Z(s.$$.fragment),l=w(),Z(o.$$.fragment),c=w(),a=g("div"),Z(i.$$.fragment),u=w(),m&&m.c(),y(e,"class","h-full mx-4 flex flex-row")},m(t,h){f(t,e,h),tt(n,e,null),d(e,r),tt(s,e,null),d(e,l),tt(o,e,null),d(e,c),d(e,a),tt(i,a,null),d(a,u),m&&m.m(a,null),p=!0},p(t,[e]){const r={};1&e&&(r.disabled=t[0]),32768&e&&(r.$$scope={dirty:e,ctx:t}),n.$set(r);const l={};1&e&&(l.disabled=t[0]),32768&e&&(l.$$scope={dirty:e,ctx:t}),s.$set(l);const c={};1&e&&(c.disabled=t[0]),32768&e&&(c.$$scope={dirty:e,ctx:t}),o.$set(c);const u={};1&e&&(u.disabled=t[0]),32768&e&&(u.$$scope={dirty:e,ctx:t}),i.$set(u),t[2]?m?(m.p(t,e),4&e&&K(m,1)):(m=an(t),m.c(),K(m,1),m.m(a,null)):m&&(G(),Q(m,1,1,(()=>{m=null})),J())},i(t){p||(K(n.$$.fragment,t),K(s.$$.fragment,t),K(o.$$.fragment,t),K(i.$$.fragment,t),K(m),p=!0)},o(t){Q(n.$$.fragment,t),Q(s.$$.fragment,t),Q(o.$$.fragment,t),Q(i.$$.fragment,t),Q(m),p=!1},d(t){t&&h(e),et(n),et(s),et(o),et(i),m&&m.d()}}}function dn(t,e,n){let r,s,l,o,a;c(t,Ut,(t=>n(6,s=t))),c(t,Ae,(t=>n(7,l=t))),c(t,ue,(t=>n(13,o=t))),c(t,ne,(t=>n(14,a=t)));let{disabled:i=!1}=e,u=!1;async function d(t){for(const e of l){const{changes:n}=De(o,a,t);await Oe(e,[...n,"-unread"]),Ae.toggle({thread:e})}}return t.$$set=t=>{"disabled"in t&&n(0,i=t.disabled)},t.$$.update=()=>{192&t.$$.dirty&&n(1,r=[...s.filter((({thread:t})=>l.includes(t))).reduce(((t,{tags:e})=>(e.forEach((e=>t.add(e))),t)),new Set)].sort(((t,e)=>t.localeCompare(e))))},[i,r,u,d,async function({detail:t}){for(const e of l)await Oe(e,[`+${t}`])},async function({detail:t}){for(const e of l)await Oe(e,[`-${t}`])},s,l,()=>d("archive"),()=>d("spam"),()=>d("trash"),()=>n(2,u=!0),()=>n(2,u=!1)]}class fn extends rt{constructor(t){super(),nt(this,t,dn,un,l,{disabled:0})}}function hn(e){let n,s,l,o,c,a,i,u,p,v,b,k,z,H,T,C,V,L=e[1]+1+"";return{c(){n=g("div"),s=g("button"),l=m("svg"),o=m("path"),c=m("path"),i=w(),u=g("span"),p=$(L),v=w(),b=g("button"),k=m("svg"),z=m("path"),H=m("path"),y(o,"d","M0 0h24v24H0z"),y(o,"fill","none"),y(c,"d","M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"),y(l,"xmlns","http://www.w3.org/2000/svg"),y(l,"viewBox","0 0 24 24"),y(l,"class","fill-current w-7"),s.disabled=a=0==e[1],y(s,"class","border-0 rounded hover:bg-gray-700 active:bg-gray-800 focus:outline-none disabled:opacity-50 disabled:bg-transparent"),y(u,"class","font-semibold px-3"),y(z,"d","M0 0h24v24H0z"),y(z,"fill","none"),y(H,"d","M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"),y(k,"xmlns","http://www.w3.org/2000/svg"),y(k,"viewBox","0 0 24 24"),y(k,"class","fill-current w-7"),b.disabled=T=e[1]==e[0]-1,y(b,"class","border-0 rounded hover:bg-gray-700 active:bg-gray-800 focus:outline-none disabled:opacity-50 disabled:bg-transparent"),y(n,"class","flex flex-row items-center ml-auto text-gray-300")},m(t,r){f(t,n,r),d(n,s),d(s,l),d(l,o),d(l,c),d(n,i),d(n,u),d(u,p),d(n,v),d(n,b),d(b,k),d(k,z),d(k,H),C||(V=[x(s,"click",e[3]),x(b,"click",e[4])],C=!0)},p(t,[e]){2&e&&a!==(a=0==t[1])&&(s.disabled=a),2&e&&L!==(L=t[1]+1+"")&&M(p,L),3&e&&T!==(T=t[1]==t[0]-1)&&(b.disabled=T)},i:t,o:t,d(t){t&&h(n),C=!1,r(V)}}}function pn(t,e,n){let r,s,l;c(t,Ot,(t=>n(2,s=t))),c(t,Ft,(t=>n(1,l=t)));return t.$$.update=()=>{4&t.$$.dirty&&n(0,r=Math.ceil(s/50))},[r,l,s,()=>Ft.update((t=>t-1)),()=>Ft.update((t=>t+1))]}class gn extends rt{constructor(t){super(),nt(this,t,pn,hn,l,{})}}function mn(t){let e,n,r;return{c(){e=m("svg"),n=m("path"),r=m("path"),y(n,"d","M0 0h24v24H0z"),y(n,"fill","none"),y(r,"d","M9 16.2L4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4L9 16.2z"),y(e,"xmlns","http://www.w3.org/2000/svg"),y(e,"viewBox","0 0 24 24"),y(e,"class","fill-current w-full")},m(t,s){f(t,e,s),d(e,n),d(e,r)},d(t){t&&h(e)}}}function $n(e){let n,r,s,l,o=e[1]&&mn();return{c(){n=g("div"),o&&o.c(),y(n,"class",r="w-5 h-5 rounded border-2 text-gray-500 "+e[2]+" "+e[0])},m(t,r){var c;f(t,n,r),o&&o.m(n,null),s||(l=x(n,"click",(c=b(e[3]),function(t){return t.stopPropagation(),c.call(this,t)})),s=!0)},p(t,[e]){t[1]?o||(o=mn(),o.c(),o.m(n,null)):o&&(o.d(1),o=null),5&e&&r!==(r="w-5 h-5 rounded border-2 text-gray-500 "+t[2]+" "+t[0])&&y(n,"class",r)},i:t,o:t,d(t){t&&h(n),o&&o.d(),s=!1,l()}}}function wn(t,e,n){let r,{class:s=""}=e,{checked:l=!1}=e;return t.$$set=t=>{"class"in t&&n(0,s=t.class),"checked"in t&&n(1,l=t.checked)},t.$$.update=()=>{2&t.$$.dirty&&n(2,r=l?"border-gray-500":"border-gray-300")},[s,l,r,function(e){B(t,e)}]}class vn extends rt{constructor(t){super(),nt(this,t,wn,$n,l,{class:0,checked:1})}}function xn(t,e,n){const r=t.slice();return r[8]=e[n],r}function bn(t,e,n){const r=t.slice();return r[11]=e[n],r}function yn(t){let e,n;return e=new Ye({props:{class:"mr-2",tag:t[11]}}),{c(){Z(e.$$.fragment)},m(t,r){tt(e,t,r),n=!0},p(t,n){const r={};1&n&&(r.tag=t[11]),e.$set(r)},i(t){n||(K(e.$$.fragment,t),n=!0)},o(t){Q(e.$$.fragment,t),n=!1},d(t){et(e,t)}}}function Mn(t){let e,n,r=!Tn(t[11]),s=r&&yn(t);return{c(){s&&s.c(),e=v()},m(t,r){s&&s.m(t,r),f(t,e,r),n=!0},p(t,n){1&n&&(r=!Tn(t[11])),r?s?(s.p(t,n),1&n&&K(s,1)):(s=yn(t),s.c(),K(s,1),s.m(e.parentNode,e)):s&&(G(),Q(s,1,1,(()=>{s=null})),J())},i(t){n||(K(s),n=!0)},o(t){Q(s),n=!1},d(t){s&&s.d(t),t&&h(e)}}}function kn(t,e){let n,r,s,l,o,c,a,i,u,m,v,k,z,H,T,C,V,L,B,j,S,E=e[8].date_relative+"",N=e[8].authors+"",_=e[8].subject+"";r=new vn({props:{class:"ml-3",checked:e[3].includes(e[8].thread)}}),r.$on("click",(function(){return e[6](e[8])}));let q=e[8].tags,F=[];for(let t=0;t<q.length;t+=1)F[t]=Mn(bn(e,q,t));const O=t=>Q(F[t],1,1,(()=>{F[t]=null}));function I(){return e[7](e[8])}return{key:t,first:null,c(){n=g("a"),Z(r.$$.fragment),s=w(),l=g("span"),o=$(E),c=w(),a=g("span"),i=$(N),u=w(),m=g("span"),v=$(_),z=w(),H=g("div");for(let t=0;t<F.length;t+=1)F[t].c();T=w(),y(l,"class","px-3 w-28"),y(a,"class","pr-6 w-40 truncate"),y(m,"class",k="truncate flex-1 "+(e[8].tags.includes("unread")?"text-red-500":"text-gray-800")),y(H,"class","inline-flex px-3"),y(n,"href",C=`/${e[1]}/${e[8].thread}`),y(n,"data-thread",V=e[8].thread),y(n,"class",L=`h-10 flex flex-row items-center border-b hover:bg-gray-200 ${Hn(e[8])} ${e[2]===e[8].thread?"bg-red-100 font-semibold":""}`),this.first=n},m(t,e){f(t,n,e),tt(r,n,null),d(n,s),d(n,l),d(l,o),d(n,c),d(n,a),d(a,i),d(n,u),d(n,m),d(m,v),d(n,z),d(n,H);for(let t=0;t<F.length;t+=1)F[t].m(H,null);d(n,T),B=!0,j||(S=x(n,"click",b(I)),j=!0)},p(t,s){e=t;const l={};if(9&s&&(l.checked=e[3].includes(e[8].thread)),r.$set(l),(!B||1&s)&&E!==(E=e[8].date_relative+"")&&M(o,E),(!B||1&s)&&N!==(N=e[8].authors+"")&&M(i,N),(!B||1&s)&&_!==(_=e[8].subject+"")&&M(v,_),(!B||1&s&&k!==(k="truncate flex-1 "+(e[8].tags.includes("unread")?"text-red-500":"text-gray-800")))&&y(m,"class",k),1&s){let t;for(q=e[8].tags,t=0;t<q.length;t+=1){const n=bn(e,q,t);F[t]?(F[t].p(n,s),K(F[t],1)):(F[t]=Mn(n),F[t].c(),K(F[t],1),F[t].m(H,null))}for(G(),t=q.length;t<F.length;t+=1)O(t);J()}(!B||3&s&&C!==(C=`/${e[1]}/${e[8].thread}`))&&y(n,"href",C),(!B||1&s&&V!==(V=e[8].thread))&&y(n,"data-thread",V),(!B||5&s&&L!==(L=`h-10 flex flex-row items-center border-b hover:bg-gray-200 ${Hn(e[8])} ${e[2]===e[8].thread?"bg-red-100 font-semibold":""}`))&&y(n,"class",L)},i(t){if(!B){K(r.$$.fragment,t);for(let t=0;t<q.length;t+=1)K(F[t]);B=!0}},o(t){Q(r.$$.fragment,t),F=F.filter(Boolean);for(let t=0;t<F.length;t+=1)Q(F[t]);B=!1},d(t){t&&h(n),et(r),p(F,t),j=!1,S()}}}function zn(t){let e,n,r=[],s=new Map,l=t[0];const o=t=>t[8].thread;for(let e=0;e<l.length;e+=1){let n=xn(t,l,e),c=o(n);s.set(c,r[e]=kn(c,n))}return{c(){for(let t=0;t<r.length;t+=1)r[t].c();e=v()},m(t,s){for(let e=0;e<r.length;e+=1)r[e].m(t,s);f(t,e,s),n=!0},p(t,[n]){15&n&&(l=t[0],G(),r=Y(r,n,o,1,t,l,s,e.parentNode,X,kn,e,xn),J())},i(t){if(!n){for(let t=0;t<l.length;t+=1)K(r[t]);n=!0}},o(t){for(let t=0;t<r.length;t+=1)Q(r[t]);n=!1},d(t){for(let e=0;e<r.length;e+=1)r[e].d(t);t&&h(e)}}}function Hn({tags:t}){return t.includes("unread")?"bg-gray-50 text-red-500 visited:text-red-500":"bg-gray-100 text-gray-600 visited:text-gray-600"}function Tn(t){return["inbox","sent","trash","archive","personal","draft","unread"].includes(t)}function Cn(t,e,n){let r,s,l,o,a;c(t,Ft,(t=>n(5,r=t))),c(t,Ut,(t=>n(0,s=t))),c(t,ne,(t=>n(1,l=t))),c(t,re,(t=>n(2,o=t))),c(t,Ae,(t=>n(3,a=t)));let{mailbox:i}=e;return t.$$set=t=>{"mailbox"in t&&n(4,i=t.mailbox)},t.$$.update=()=>{48&t.$$.dirty&&i&&Ut.fetch(i.terms,r)},[s,l,o,a,i,r,t=>Ae.toggle(t),t=>ee.selectThread(l,t.thread)]}class Vn extends rt{constructor(t){super(),nt(this,t,Cn,zn,l,{mailbox:4})}}function Ln(t,e=[]){return t["content-type"].startsWith("multipart")?t.content.forEach((t=>Ln(t,e))):"text/plain"===t["content-type"]&&e.push(t.content),e}function Bn(t){return Ln(t).map((t=>t.replace(/^/gm,"> "))).join("")}function jn(t,e={text:[],attachments:[],html:[]}){if(t["content-type"].startsWith("multipart"))t.content.forEach((t=>jn(t,e)));else if("text/plain"===t["content-type"]){const n=function(t){const e=[];let n=null;return t.split("\n").forEach((t=>{const r=function(t){return t.startsWith("> >")?"deepquote":t.startsWith(">")?"quote":"text"}(t);n?.type!==r&&(n&&e.push(n),n={type:r,content:""}),n.content+="quote"===r||"deepquote"===r?`${t.replace(/^>\s?/,"")}\n`:`${t}\n`})),e.push(n),e}(t.content);e.text.push(...n)}else"text/html"===t["content-type"]?e.html.push(t):"attachment"===t["content-disposition"]&&e.attachments.push(t);return e}function Sn(t,e){const n=[];let r=0;return t.replaceAll(/http[s]?:\/\/\S*\b[=/]?/g,((e,s)=>{n.push(t.substring(r,s)),n.push(new URL(e)),r=s+e.length})),n.push(t.substring(r,t.length)),n}function En(t){let e;return{c(){e=$(t[0])},m(t,n){f(t,e,n)},p(t,n){1&n&&M(e,t[0])},d(t){t&&h(e)}}}function Nn(e){let n;return{c(){n=g("span"),n.textContent="...",y(n,"class","text-red-500 font-semibold")},m(t,e){f(t,n,e)},p:t,d(t){t&&h(n)}}}function _n(e){let n,r,s,l;function o(t,e){return t[2]?Nn:En}let c=o(e),a=c(e);return{c(){n=g("a"),a.c(),y(n,"href","#fold"),y(n,"style",r=`width: ${e[1]}ch;`),y(n,"class","block whitespace-pre-line break-words text-gray-500 border-l-8 border-gray-400 pl-3")},m(t,r){f(t,n,r),a.m(n,null),s||(l=x(n,"click",b(e[3])),s=!0)},p(t,[e]){c===(c=o(t))&&a?a.p(t,e):(a.d(1),a=c(t),a&&(a.c(),a.m(n,null))),2&e&&r!==(r=`width: ${t[1]}ch;`)&&y(n,"style",r)},i:t,o:t,d(t){t&&h(n),a.d(),s=!1,l()}}}function qn(t,e,n){let{content:r}=e,{wrap:s=80}=e,l=!0;return t.$$set=t=>{"content"in t&&n(0,r=t.content),"wrap"in t&&n(1,s=t.wrap)},[r,s,l,()=>n(2,l=!l)]}class Fn extends rt{constructor(t){super(),nt(this,t,qn,_n,l,{content:0,wrap:1})}}function On(t,e,n){const r=t.slice();return r[4]=e[n],r}function In(t,e,n){const r=t.slice();return r[7]=e[n],r}function Dn(t,e,n){const r=t.slice();return r[7]=e[n],r}function Pn(t,e,n){const r=t.slice();return r[12]=e[n],r}function Un(e){let n;return{c(){n=g("p"),n.textContent="Email has no plaintext content.",y(n,"class","text-lg")},m(t,e){f(t,n,e)},p:t,i:t,o:t,d(t){t&&h(n)}}}function An(t){let e,n,r=t[2].text,s=[];for(let e=0;e<r.length;e+=1)s[e]=Xn(Dn(t,r,e));const l=t=>Q(s[t],1,1,(()=>{s[t]=null}));return{c(){for(let t=0;t<s.length;t+=1)s[t].c();e=v()},m(t,r){for(let e=0;e<s.length;e+=1)s[e].m(t,r);f(t,e,r),n=!0},p(t,n){if(6&n){let o;for(r=t[2].text,o=0;o<r.length;o+=1){const l=Dn(t,r,o);s[o]?(s[o].p(l,n),K(s[o],1)):(s[o]=Xn(l),s[o].c(),K(s[o],1),s[o].m(e.parentNode,e))}for(G(),o=r.length;o<s.length;o+=1)l(o);J()}},i(t){if(!n){for(let t=0;t<r.length;t+=1)K(s[t]);n=!0}},o(t){s=s.filter(Boolean);for(let t=0;t<s.length;t+=1)Q(s[t]);n=!1},d(t){p(s,t),t&&h(e)}}}function Rn(e){let n,r,s,l=Sn(e[7].content),o=[];for(let t=0;t<l.length;t+=1)o[t]=Qn(Pn(e,l,t));return{c(){n=g("p");for(let t=0;t<o.length;t+=1)o[t].c();r=w(),y(n,"style",s=`width: ${e[1]}ch;`),y(n,"class","whitespace-pre-line break-words")},m(t,e){f(t,n,e);for(let t=0;t<o.length;t+=1)o[t].m(n,null);d(n,r)},p(t,e){if(4&e){let s;for(l=Sn(t[7].content),s=0;s<l.length;s+=1){const c=Pn(t,l,s);o[s]?o[s].p(c,e):(o[s]=Qn(c),o[s].c(),o[s].m(n,r))}for(;s<o.length;s+=1)o[s].d(1);o.length=l.length}2&e&&s!==(s=`width: ${t[1]}ch;`)&&y(n,"style",s)},i:t,o:t,d(t){t&&h(n),p(o,t)}}}function Wn(t){let e,n;return e=new Fn({props:{content:t[7].content}}),{c(){Z(e.$$.fragment)},m(t,r){tt(e,t,r),n=!0},p(t,n){const r={};4&n&&(r.content=t[7].content),e.$set(r)},i(t){n||(K(e.$$.fragment,t),n=!0)},o(t){Q(e.$$.fragment,t),n=!1},d(t){et(e,t)}}}function Gn(e){let n,r,s,l,o=e[7].content+"";return{c(){n=g("p"),r=$(o),s=w(),y(n,"style",l=`width: ${e[1]}ch;`),y(n,"class","whitespace-pre-line break-words text-gray-600 border-l-8 border-gray-400 pl-3")},m(t,e){f(t,n,e),d(n,r),d(n,s)},p(t,e){4&e&&o!==(o=t[7].content+"")&&M(r,o),2&e&&l!==(l=`width: ${t[1]}ch;`)&&y(n,"style",l)},i:t,o:t,d(t){t&&h(n)}}}function Jn(t){let e,n=t[12]+"";return{c(){e=$(n)},m(t,n){f(t,e,n)},p(t,r){4&r&&n!==(n=t[12]+"")&&M(e,n)},d(t){t&&h(e)}}}function Kn(t){let e,n,r,s,l,o,c,a,i=t[12].hostname+"";return{c(){e=g("a"),n=m("svg"),r=m("path"),s=m("path"),l=w(),o=g("span"),c=$(i),y(r,"d","M0 0h24v24H0z"),y(r,"fill","none"),y(s,"d","M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"),y(n,"xmlns","http://www.w3.org/2000/svg"),y(n,"viewBox","0 0 24 24"),y(n,"class","inline fill-current h-5"),y(o,"class","text-sm"),y(e,"href",a=t[12].toString()),y(e,"class","inline text-gray-600 hover:text-red-600"),y(e,"target","_blank")},m(t,a){f(t,e,a),d(e,n),d(n,r),d(n,s),d(e,l),d(e,o),d(o,c)},p(t,n){4&n&&i!==(i=t[12].hostname+"")&&M(c,i),4&n&&a!==(a=t[12].toString())&&y(e,"href",a)},d(t){t&&h(e)}}}function Qn(t){let e;function n(t,e){return t[12]instanceof URL?Kn:Jn}let r=n(t),s=r(t);return{c(){s.c(),e=v()},m(t,n){s.m(t,n),f(t,e,n)},p(t,l){r===(r=n(t))&&s?s.p(t,l):(s.d(1),s=r(t),s&&(s.c(),s.m(e.parentNode,e)))},d(t){s.d(t),t&&h(e)}}}function Xn(t){let e,n,r,s;const l=[Gn,Wn,Rn],o=[];function c(t,e){return"quote"===t[7].type?0:"deepquote"===t[7].type?1:2}return e=c(t),n=o[e]=l[e](t),{c(){n.c(),r=v()},m(t,n){o[e].m(t,n),f(t,r,n),s=!0},p(t,s){let a=e;e=c(t),e===a?o[e].p(t,s):(G(),Q(o[a],1,1,(()=>{o[a]=null})),J(),n=o[e],n?n.p(t,s):(n=o[e]=l[e](t),n.c()),K(n,1),n.m(r.parentNode,r))},i(t){s||(K(n),s=!0)},o(t){Q(n),s=!1},d(t){o[e].d(t),t&&h(r)}}}function Yn(t){let e,n=t[2].html,r=[];for(let e=0;e<n.length;e+=1)r[e]=Zn(In(t,n,e));return{c(){e=g("p");for(let t=0;t<r.length;t+=1)r[t].c();y(e,"class","mt-3")},m(t,n){f(t,e,n);for(let t=0;t<r.length;t+=1)r[t].m(e,null)},p(t,s){if(5&s){let l;for(n=t[2].html,l=0;l<n.length;l+=1){const o=In(t,n,l);r[l]?r[l].p(o,s):(r[l]=Zn(o),r[l].c(),r[l].m(e,null))}for(;l<r.length;l+=1)r[l].d(1);r.length=n.length}},d(t){t&&h(e),p(r,t)}}}function Zn(t){let e,n,r;return{c(){e=g("a"),n=$("Open HTML"),y(e,"href",r=`/api/messages/${t[0]}/parts/${t[7].id}`),y(e,"class","block text-red-400 hover:text-red-500 font-semibold underline"),y(e,"target","_blank")},m(t,r){f(t,e,r),d(e,n)},p(t,n){5&n&&r!==(r=`/api/messages/${t[0]}/parts/${t[7].id}`)&&y(e,"href",r)},d(t){t&&h(e)}}}function tr(t){let e,n=t[2].attachments,r=[];for(let e=0;e<n.length;e+=1)r[e]=er(On(t,n,e));return{c(){e=g("div");for(let t=0;t<r.length;t+=1)r[t].c();y(e,"class","flex flex-row flex-wrap mt-3")},m(t,n){f(t,e,n);for(let t=0;t<r.length;t+=1)r[t].m(e,null)},p(t,s){if(5&s){let l;for(n=t[2].attachments,l=0;l<n.length;l+=1){const o=On(t,n,l);r[l]?r[l].p(o,s):(r[l]=er(o),r[l].c(),r[l].m(e,null))}for(;l<r.length;l+=1)r[l].d(1);r.length=n.length}},d(t){t&&h(e),p(r,t)}}}function er(t){let e,n,r,s,l,o,c,a,i=t[4].filename+"";return{c(){e=g("a"),n=m("svg"),r=m("path"),s=m("path"),l=w(),o=$(i),y(r,"d","M0 0h24v24H0z"),y(r,"fill","none"),y(s,"d","M16.5 6v11.5c0 2.21-1.79 4-4 4s-4-1.79-4-4V5c0-1.38 1.12-2.5 2.5-2.5s2.5 1.12 2.5 2.5v10.5c0 .55-.45 1-1 1s-1-.45-1-1V6H10v9.5c0 1.38 1.12 2.5 2.5 2.5s2.5-1.12 2.5-2.5V5c0-2.21-1.79-4-4-4S7 2.79 7 5v12.5c0 3.04 2.46 5.5 5.5 5.5s5.5-2.46 5.5-5.5V6h-1.5z"),y(n,"xmlns","http://www.w3.org/2000/svg"),y(n,"viewBox","0 0 24 24"),y(n,"class","fill-current mr-1 w-5"),y(e,"href",c=`/api/messages/${t[0]}/parts/${t[4].id}`),y(e,"download",a=t[4].filename),y(e,"class","flex flex-row items-center mr-2 mb-2 p-3 rounded border-2 border-gray-500 text-gray-600 font-semibold hover:border-gray-700 hover:text-gray-800 visited:text-gray-600 hover:no-underline")},m(t,c){f(t,e,c),d(e,n),d(n,r),d(n,s),d(e,l),d(e,o)},p(t,n){4&n&&i!==(i=t[4].filename+"")&&M(o,i),5&n&&c!==(c=`/api/messages/${t[0]}/parts/${t[4].id}`)&&y(e,"href",c),4&n&&a!==(a=t[4].filename)&&y(e,"download",a)},d(t){t&&h(e)}}}function nr(t){let e,n,r,s,l,o;const c=[An,Un],a=[];function i(t,e){return t[2].text.length>0?0:1}e=i(t),n=a[e]=c[e](t);let u=t[2].html.length>0&&Yn(t),d=t[2].attachments.length>0&&tr(t);return{c(){n.c(),r=w(),u&&u.c(),s=w(),d&&d.c(),l=v()},m(t,n){a[e].m(t,n),f(t,r,n),u&&u.m(t,n),f(t,s,n),d&&d.m(t,n),f(t,l,n),o=!0},p(t,[o]){let f=e;e=i(t),e===f?a[e].p(t,o):(G(),Q(a[f],1,1,(()=>{a[f]=null})),J(),n=a[e],n?n.p(t,o):(n=a[e]=c[e](t),n.c()),K(n,1),n.m(r.parentNode,r)),t[2].html.length>0?u?u.p(t,o):(u=Yn(t),u.c(),u.m(s.parentNode,s)):u&&(u.d(1),u=null),t[2].attachments.length>0?d?d.p(t,o):(d=tr(t),d.c(),d.m(l.parentNode,l)):d&&(d.d(1),d=null)},i(t){o||(K(n),o=!0)},o(t){Q(n),o=!1},d(t){a[e].d(t),t&&h(r),u&&u.d(t),t&&h(s),d&&d.d(t),t&&h(l)}}}function rr(t,e,n){let r,{body:s}=e,{messageId:l}=e,{wrap:o=80}=e;return t.$$set=t=>{"body"in t&&n(3,s=t.body),"messageId"in t&&n(0,l=t.messageId),"wrap"in t&&n(1,o=t.wrap)},t.$$.update=()=>{8&t.$$.dirty&&n(2,r=jn(s)),13&t.$$.dirty&&console.debug(`selected message ${l},`,"body:",s,"parsed content:",r)},[l,o,r,s]}class sr extends rt{constructor(t){super(),nt(this,t,rr,nr,l,{body:3,messageId:0,wrap:1})}}function lr(t){let e,n,r;return{c(){e=g("span"),n=$(t[2]),y(e,"class",r="text-gray-600 pl-1 "+(t[0]?"line-through":""))},m(t,r){f(t,e,r),d(e,n)},p(t,s){4&s&&M(n,t[2]),1&s&&r!==(r="text-gray-600 pl-1 "+(t[0]?"line-through":""))&&y(e,"class",r)},d(t){t&&h(e)}}}function or(e){let n,r,s,l,o,c=e[2]&&lr(e);return{c(){n=g("span"),r=$(e[1]),l=w(),c&&c.c(),o=v(),y(n,"class",s=""+(e[0]?"line-through":""))},m(t,e){f(t,n,e),d(n,r),f(t,l,e),c&&c.m(t,e),f(t,o,e)},p(t,[e]){2&e&&M(r,t[1]),1&e&&s!==(s=""+(t[0]?"line-through":""))&&y(n,"class",s),t[2]?c?c.p(t,e):(c=lr(t),c.c(),c.m(o.parentNode,o)):c&&(c.d(1),c=null)},i:t,o:t,d(t){t&&h(n),t&&h(l),c&&c.d(t),t&&h(o)}}}function cr(t,e,n){let r,s,{address:l}=e,{removed:o=!1}=e;return t.$$set=t=>{"address"in t&&n(3,l=t.address),"removed"in t&&n(0,o=t.removed)},t.$$.update=()=>{8&t.$$.dirty&&n(1,[,r,s]=l.match(/(.*?)\s(\<.*?\>)/)||[null,l],r,(n(2,s),n(3,l)))},[o,r,s,l]}class ar extends rt{constructor(t){super(),nt(this,t,cr,or,l,{address:3,removed:0})}}function ir(t,e,n){const r=t.slice();return r[1]=e[n],r}function ur(t){let e,n,r,s,l=t[0].headers.Cc+"";return{c(){e=g("p"),n=g("span"),n.textContent="Cc:",r=w(),s=$(l),y(n,"class","inline-flex w-10"),y(e,"class","mb-2 text-gray-500")},m(t,l){f(t,e,l),d(e,n),d(e,r),d(e,s)},p(t,e){1&e&&l!==(l=t[0].headers.Cc+"")&&M(s,l)},d(t){t&&h(e)}}}function dr(t){let e,n;return e=new Ye({props:{class:"mr-2",tag:t[1]}}),{c(){Z(e.$$.fragment)},m(t,r){tt(e,t,r),n=!0},p(t,n){const r={};1&n&&(r.tag=t[1]),e.$set(r)},i(t){n||(K(e.$$.fragment,t),n=!0)},o(t){Q(e.$$.fragment,t),n=!1},d(t){et(e,t)}}}function fr(t){let e,n,r,s,l,o,c,a,i,u,v,x,b,k,z,H,T,C,V,L,B,j,S,E,N,_=t[0].headers.To+"",q=t[0].headers.Subject+"",F=t[0].headers.Date+"";l=new ar({props:{address:t[0].headers.From}});let O=t[0].headers.Cc&&ur(t),I=t[0].tags,D=[];for(let e=0;e<I.length;e+=1)D[e]=dr(ir(t,I,e));const P=t=>Q(D[t],1,1,(()=>{D[t]=null}));return{c(){e=g("div"),n=g("p"),r=g("span"),r.textContent="From:",s=w(),Z(l.$$.fragment),o=w(),c=g("p"),a=g("span"),a.textContent="To:",i=w(),u=$(_),v=w(),O&&O.c(),x=w(),b=g("h3"),k=$(q),z=w(),H=g("div"),T=g("div"),C=m("svg"),V=m("path"),L=m("path"),B=m("path"),j=w(),S=$(F),E=w();for(let t=0;t<D.length;t+=1)D[t].c();y(r,"class","inline-flex w-10 text-gray-500"),y(n,"class","mb-2"),y(a,"class","inline-flex w-10"),y(c,"class","mb-2 text-gray-500"),y(b,"class","mb-3"),y(V,"d","M0 0h24v24H0z"),y(V,"fill","none"),y(L,"d","M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"),y(B,"d","M12.5 7H11v6l5.25 3.15.75-1.23-4.5-2.67z"),y(C,"xmlns","http://www.w3.org/2000/svg"),y(C,"viewBox","0 0 24 24"),y(C,"class","w-4 fill-current mr-1"),y(T,"class","inline-flex items-center mr-4 text-gray-600 text-sm"),y(H,"class","flex"),y(e,"class","p-3")},m(t,h){f(t,e,h),d(e,n),d(n,r),d(n,s),tt(l,n,null),d(e,o),d(e,c),d(c,a),d(c,i),d(c,u),d(e,v),O&&O.m(e,null),d(e,x),d(e,b),d(b,k),d(e,z),d(e,H),d(H,T),d(T,C),d(C,V),d(C,L),d(C,B),d(T,j),d(T,S),d(H,E);for(let t=0;t<D.length;t+=1)D[t].m(H,null);N=!0},p(t,[n]){const r={};if(1&n&&(r.address=t[0].headers.From),l.$set(r),(!N||1&n)&&_!==(_=t[0].headers.To+"")&&M(u,_),t[0].headers.Cc?O?O.p(t,n):(O=ur(t),O.c(),O.m(e,x)):O&&(O.d(1),O=null),(!N||1&n)&&q!==(q=t[0].headers.Subject+"")&&M(k,q),(!N||1&n)&&F!==(F=t[0].headers.Date+"")&&M(S,F),1&n){let e;for(I=t[0].tags,e=0;e<I.length;e+=1){const r=ir(t,I,e);D[e]?(D[e].p(r,n),K(D[e],1)):(D[e]=dr(r),D[e].c(),K(D[e],1),D[e].m(H,null))}for(G(),e=I.length;e<D.length;e+=1)P(e);J()}},i(t){if(!N){K(l.$$.fragment,t);for(let t=0;t<I.length;t+=1)K(D[t]);N=!0}},o(t){Q(l.$$.fragment,t),D=D.filter(Boolean);for(let t=0;t<D.length;t+=1)Q(D[t]);N=!1},d(t){t&&h(e),et(l),O&&O.d(),p(D,t)}}}function hr(t,e,n){let{message:r}=e;return t.$$set=t=>{"message"in t&&n(0,r=t.message)},[r]}class pr extends rt{constructor(t){super(),nt(this,t,hr,fr,l,{message:0})}}const{subscribe:gr,set:mr,update:$r}=Et(null);var wr={subscribe:gr,create:function(){mr({to:[],cc:[],subject:"",body:"",headers:{},attachments:[]})},reply:function(t){const{To:e,Cc:n,Subject:r,...s}=t["reply-headers"],{headers:l,body:o}=t.original,c=o.map((t=>Bn(t))).join("\n");mr({to:e.split(", "),cc:n?.split(", ")||[],subject:r,headers:{...s},body:c,originalHeaders:l,reply:!0,attachments:[]})},forward:function({body:t,headers:e}){const n=t.map((t=>Bn(t))).join("\n");mr({to:[],cc:[],subject:`Fwd: ${e.Subject}`,headers:{},body:n,originalHeaders:e,reply:!0,attachments:[]})},setField:function(t){$r((e=>({...e,...t})))},set:function({body:t}){$r((e=>({...e,body:t})))},destroy:function(){mr(null)}};function vr(t){let e,n,r;return{c(){e=m("svg"),n=m("path"),r=m("path"),y(n,"d","M0 0h24v24H0V0z"),y(n,"fill","none"),y(r,"d","M18.83 7h-2.6L10.5 4 4 7.4V17c-1.1 0-2-.9-2-2V7.17c0-.53.32-1.09.8-1.34L10.5 2l7.54 3.83c.43.23.73.7.79 1.17zM20 8H7c-1.1 0-2 .9-2 2v9c0 1.1.9 2 2 2h13c1.1 0 2-.9 2-2v-9c0-1.1-.9-2-2-2zm0 3.67L13.5 15 7 11.67V10l6.5 3.33L20 10v1.67z"),y(e,"xmlns","http://www.w3.org/2000/svg"),y(e,"viewBox","0 0 24 24"),y(e,"class","w-full fill-current")},m(t,s){f(t,e,s),d(e,n),d(e,r)},d(t){t&&h(e)}}}function xr(t){let e,n,r,s,l,o,c,a;return e=new Ke({props:{tooltip:"Move to archive",class:"mr-1",$$slots:{default:[br]},$$scope:{ctx:t}}}),e.$on("click",t[9]),r=new Ke({props:{tooltip:"Move to inbox",class:"mr-1",$$slots:{default:[yr]},$$scope:{ctx:t}}}),r.$on("click",t[10]),l=new Ke({props:{tooltip:"Move to spam",class:"mr-1",$$slots:{default:[Mr]},$$scope:{ctx:t}}}),l.$on("click",t[11]),c=new Ke({props:{tooltip:"Move to trash",class:"mr-3",$$slots:{default:[kr]},$$scope:{ctx:t}}}),c.$on("click",t[12]),{c(){Z(e.$$.fragment),n=w(),Z(r.$$.fragment),s=w(),Z(l.$$.fragment),o=w(),Z(c.$$.fragment)},m(t,i){tt(e,t,i),f(t,n,i),tt(r,t,i),f(t,s,i),tt(l,t,i),f(t,o,i),tt(c,t,i),a=!0},p(t,n){const s={};4194304&n&&(s.$$scope={dirty:n,ctx:t}),e.$set(s);const o={};4194304&n&&(o.$$scope={dirty:n,ctx:t}),r.$set(o);const a={};4194304&n&&(a.$$scope={dirty:n,ctx:t}),l.$set(a);const i={};4194304&n&&(i.$$scope={dirty:n,ctx:t}),c.$set(i)},i(t){a||(K(e.$$.fragment,t),K(r.$$.fragment,t),K(l.$$.fragment,t),K(c.$$.fragment,t),a=!0)},o(t){Q(e.$$.fragment,t),Q(r.$$.fragment,t),Q(l.$$.fragment,t),Q(c.$$.fragment,t),a=!1},d(t){et(e,t),t&&h(n),et(r,t),t&&h(s),et(l,t),t&&h(o),et(c,t)}}}function br(t){let e,n,r,s,l;return{c(){e=m("svg"),n=m("g"),r=m("rect"),s=m("g"),l=m("path"),y(r,"fill","none"),y(r,"height","24"),y(r,"width","24"),y(l,"d","M20,2H4C3,2,2,2.9,2,4v3.01C2,7.73,2.43,8.35,3,8.7V20c0,1.1,1.1,2,2,2h14c0.9,0,2-0.9,2-2V8.7c0.57-0.35,1-0.97,1-1.69V4 C22,2.9,21,2,20,2z M15,14H9v-2h6V14z M20,7H4V4h16V7z"),y(e,"xmlns","http://www.w3.org/2000/svg"),y(e,"enable-background","new 0 0 24 24"),y(e,"viewBox","0 0 24 24"),y(e,"class","fill-current w-full")},m(t,o){f(t,e,o),d(e,n),d(n,r),d(e,s),d(s,l)},d(t){t&&h(e)}}}function yr(t){let e,n,r;return{c(){e=m("svg"),n=m("path"),r=m("path"),y(n,"d","M0 0h24v24H0V0z"),y(n,"fill","none"),y(r,"d","M19 3H4.99c-1.11 0-1.98.89-1.98 2L3 19c0 1.1.88 2 1.99 2H19c1.1 0 2-.9 2-2V5c0-1.11-.9-2-2-2zm0 12h-4c0 1.66-1.35 3-3 3s-3-1.34-3-3H4.99V5H19v10z"),y(e,"xmlns","http://www.w3.org/2000/svg"),y(e,"viewBox","0 0 24 24"),y(e,"class","fill-current w-full")},m(t,s){f(t,e,s),d(e,n),d(e,r)},d(t){t&&h(e)}}}function Mr(t){let e,n,r;return{c(){e=m("svg"),n=m("path"),r=m("path"),y(n,"d","M0 0h24v24H0z"),y(n,"fill","none"),y(r,"d","M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.42 0-8-3.58-8-8 0-1.85.63-3.55 1.69-4.9L16.9 18.31C15.55 19.37 13.85 20 12 20zm6.31-3.1L7.1 5.69C8.45 4.63 10.15 4 12 4c4.42 0 8 3.58 8 8 0 1.85-.63 3.55-1.69 4.9z"),y(e,"xmlns","http://www.w3.org/2000/svg"),y(e,"viewBox","0 0 24 24"),y(e,"class","w-full fill-current")},m(t,s){f(t,e,s),d(e,n),d(e,r)},d(t){t&&h(e)}}}function kr(t){let e,n,r;return{c(){e=m("svg"),n=m("path"),r=m("path"),y(n,"d","M0 0h24v24H0z"),y(n,"fill","none"),y(r,"d","M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"),y(e,"xmlns","http://www.w3.org/2000/svg"),y(e,"viewBox","0 0 24 24"),y(e,"class","w-full fill-current")},m(t,s){f(t,e,s),d(e,n),d(e,r)},d(t){t&&h(e)}}}function zr(t){let e,n,r;return{c(){e=m("svg"),n=m("path"),r=m("path"),y(n,"d","M0 0h24v24H0z"),y(n,"fill","none"),y(r,"d","M21.41 11.58l-9-9C12.05 2.22 11.55 2 11 2H4c-1.1 0-2 .9-2 2v7c0 .55.22 1.05.59 1.42l9 9c.36.36.86.58 1.41.58.55 0 1.05-.22 1.41-.59l7-7c.37-.36.59-.86.59-1.41 0-.55-.23-1.06-.59-1.42zM5.5 7C4.67 7 4 6.33 4 5.5S4.67 4 5.5 4 7 4.67 7 5.5 6.33 7 5.5 7z"),y(e,"xmlns","http://www.w3.org/2000/svg"),y(e,"viewBox","0 0 24 24"),y(e,"class","w-full fill-current")},m(t,s){f(t,e,s),d(e,n),d(e,r)},d(t){t&&h(e)}}}function Hr(t){let e,n;return e=new rn({props:{class:"absolute",tags:t[0].tags}}),e.$on("add",t[5]),e.$on("remove",t[6]),e.$on("close",t[14]),{c(){Z(e.$$.fragment)},m(t,r){tt(e,t,r),n=!0},p(t,n){const r={};1&n&&(r.tags=t[0].tags),e.$set(r)},i(t){n||(K(e.$$.fragment,t),n=!0)},o(t){Q(e.$$.fragment,t),n=!1},d(t){et(e,t)}}}function Tr(t){let e,n,r;return{c(){e=m("svg"),n=m("path"),r=m("path"),y(n,"d","M0 0h24v24H0z"),y(n,"fill","none"),y(r,"d","M10 9V5l-7 7 7 7v-4.1c5 0 8.5 1.6 11 5.1-1-5-4-10-11-11z"),y(e,"xmlns","http://www.w3.org/2000/svg"),y(e,"viewBox","0 0 24 24"),y(e,"class","w-full fill-current")},m(t,s){f(t,e,s),d(e,n),d(e,r)},d(t){t&&h(e)}}}function Cr(t){let e,n,r;return{c(){e=m("svg"),n=m("path"),r=m("path"),y(n,"d","M0 0h24v24H0z"),y(n,"fill","none"),y(r,"d","M7 8V5l-7 7 7 7v-3l-4-4 4-4zm6 1V5l-7 7 7 7v-4.1c5 0 8.5 1.6 11 5.1-1-5-4-10-11-11z"),y(e,"xmlns","http://www.w3.org/2000/svg"),y(e,"viewBox","0 0 24 24"),y(e,"class","w-full fill-current")},m(t,s){f(t,e,s),d(e,n),d(e,r)},d(t){t&&h(e)}}}function Vr(t){let e,n,r;return{c(){e=m("svg"),n=m("path"),r=m("path"),y(n,"d","M0 0h24v24H0z"),y(n,"fill","none"),y(r,"d","M12 8V4l8 8-8 8v-4H4V8z"),y(e,"xmlns","http://www.w3.org/2000/svg"),y(e,"viewBox","0 0 24 24"),y(e,"class","w-full fill-current")},m(t,s){f(t,e,s),d(e,n),d(e,r)},d(t){t&&h(e)}}}function Lr(t){let e,n,r,s,l,o,c,a,i,u,p,m,$,v;e=new Ke({props:{tooltip:"Mark as unread",tooltipPosition:"left",class:"mr-3",$$slots:{default:[vr]},$$scope:{ctx:t}}}),e.$on("click",t[3]);let x="search"!==t[2]&&xr(t);l=new Ke({props:{tooltip:"Tag",class:"mr-3",$$slots:{default:[zr]},$$scope:{ctx:t}}}),l.$on("click",t[13]);let b=t[1]&&Hr(t);return i=new Ke({props:{tooltip:"Reply",class:"mr-1",$$slots:{default:[Tr]},$$scope:{ctx:t}}}),i.$on("click",t[15]),p=new Ke({props:{tooltip:"Reply all",class:"mr-1",$$slots:{default:[Cr]},$$scope:{ctx:t}}}),p.$on("click",t[16]),$=new Ke({props:{tooltip:"Forward",tooltipPosition:"right",$$slots:{default:[Vr]},$$scope:{ctx:t}}}),$.$on("click",t[8]),{c(){Z(e.$$.fragment),n=w(),x&&x.c(),r=w(),s=g("div"),Z(l.$$.fragment),o=w(),b&&b.c(),c=w(),a=g("div"),Z(i.$$.fragment),u=w(),Z(p.$$.fragment),m=w(),Z($.$$.fragment),y(a,"class","flex flex-row ml-auto")},m(t,h){tt(e,t,h),f(t,n,h),x&&x.m(t,h),f(t,r,h),f(t,s,h),tt(l,s,null),d(s,o),b&&b.m(s,null),f(t,c,h),f(t,a,h),tt(i,a,null),d(a,u),tt(p,a,null),d(a,m),tt($,a,null),v=!0},p(t,[n]){const o={};4194304&n&&(o.$$scope={dirty:n,ctx:t}),e.$set(o),"search"!==t[2]?x?(x.p(t,n),4&n&&K(x,1)):(x=xr(t),x.c(),K(x,1),x.m(r.parentNode,r)):x&&(G(),Q(x,1,1,(()=>{x=null})),J());const c={};4194304&n&&(c.$$scope={dirty:n,ctx:t}),l.$set(c),t[1]?b?(b.p(t,n),2&n&&K(b,1)):(b=Hr(t),b.c(),K(b,1),b.m(s,null)):b&&(G(),Q(b,1,1,(()=>{b=null})),J());const a={};4194304&n&&(a.$$scope={dirty:n,ctx:t}),i.$set(a);const u={};4194304&n&&(u.$$scope={dirty:n,ctx:t}),p.$set(u);const d={};4194304&n&&(d.$$scope={dirty:n,ctx:t}),$.$set(d)},i(t){v||(K(e.$$.fragment,t),K(x),K(l.$$.fragment,t),K(b),K(i.$$.fragment,t),K(p.$$.fragment,t),K($.$$.fragment,t),v=!0)},o(t){Q(e.$$.fragment,t),Q(x),Q(l.$$.fragment,t),Q(b),Q(i.$$.fragment,t),Q(p.$$.fragment,t),Q($.$$.fragment,t),v=!1},d(t){et(e,t),t&&h(n),x&&x.d(t),t&&h(r),t&&h(s),et(l),b&&b.d(),t&&h(c),t&&h(a),et(i),et(p),et($)}}}function Br(t,e,n){let r,s,l,o,a;c(t,re,(t=>n(17,r=t))),c(t,Ut,(t=>n(18,s=t))),c(t,ne,(t=>n(2,l=t))),c(t,ue,(t=>n(19,o=t))),c(t,qe,(t=>n(20,a=t)));let{message:i}=e,u=!1;function d(t){const{changes:e,fromTags:n}=De(o,l,t);Fe(r,i.id,e);const c=Se(a,i.id,n);c?Gt.selectMessage(c.id):function(){const t=s.findIndex((({thread:t})=>t===r)),e=s[t+1];e?ee.selectThread(l,e.thread):ee.deselectThread()}()}async function f(t){const e=await _t.default.replyToMessage(i.id,t);wr.reply(e)}return t.$$set=t=>{"message"in t&&n(0,i=t.message)},[i,u,l,function(){Fe(r,i.id,["+unread"])},d,function({detail:t}){Fe(r,i.id,[`+${t}`])},function({detail:t}){Fe(r,i.id,[`-${t}`])},f,async function(){wr.forward(i)},()=>d("archive"),()=>d("inbox"),()=>d("spam"),()=>d("trash"),()=>n(1,u=!0),()=>n(1,u=!1),()=>f("sender"),()=>f("all")]}class jr extends rt{constructor(t){super(),nt(this,t,Br,Lr,l,{message:0})}}function Sr(t,e,n){const r=t.slice();return r[2]=e[n],r}function Er(t,e){let n,r,s;return r=new sr({props:{body:e[2],messageId:btoa(e[0].id),wrap:"100"}}),{key:t,first:null,c(){n=v(),Z(r.$$.fragment),this.first=n},m(t,e){f(t,n,e),tt(r,t,e),s=!0},p(t,n){e=t;const s={};1&n&&(s.body=e[2]),1&n&&(s.messageId=btoa(e[0].id)),r.$set(s)},i(t){s||(K(r.$$.fragment,t),s=!0)},o(t){Q(r.$$.fragment,t),s=!1},d(t){t&&h(n),et(r,t)}}}function Nr(t){let e,n,r,s,l,o,c,a,i,u,p,m,$,v=[],b=new Map;n=new pr({props:{message:t[0]}}),c=new jr({props:{message:t[0]}});let M=t[0].body;const k=t=>t[2].id;for(let e=0;e<M.length;e+=1){let n=Sr(t,M,e),r=k(n);b.set(r,v[e]=Er(r,n))}return{c(){e=g("div"),Z(n.$$.fragment),r=w(),s=g("button"),s.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="w-full fill-current"><path d="M0 0h24v24H0z" fill="none"></path><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg>',l=w(),o=g("div"),Z(c.$$.fragment),i=w(),u=g("div");for(let t=0;t<v.length;t+=1)v[t].c();y(s,"class","absolute w-5 top-3 right-3 text-gray-500 order-0 hover:text-gray-800 active:text-gray-500 focus:outline-none"),y(o,"class","flex flex-row p-3 border-b border-t"),y(e,"class","relative bg-gray-100"),y(e,"data-message",a=t[0].id),y(u,"class","p-5 border-b-2 border-gray-200")},m(a,h){f(a,e,h),tt(n,e,null),d(e,r),d(e,s),d(e,l),d(e,o),tt(c,o,null),f(a,i,h),f(a,u,h);for(let t=0;t<v.length;t+=1)v[t].m(u,null);p=!0,m||($=x(s,"click",t[1]),m=!0)},p(t,[r]){const s={};1&r&&(s.message=t[0]),n.$set(s);const l={};1&r&&(l.message=t[0]),c.$set(l),(!p||1&r&&a!==(a=t[0].id))&&y(e,"data-message",a),1&r&&(M=t[0].body,G(),v=Y(v,r,k,1,t,M,b,u,X,Er,null,Sr),J())},i(t){if(!p){K(n.$$.fragment,t),K(c.$$.fragment,t);for(let t=0;t<M.length;t+=1)K(v[t]);p=!0}},o(t){Q(n.$$.fragment,t),Q(c.$$.fragment,t);for(let t=0;t<v.length;t+=1)Q(v[t]);p=!1},d(t){t&&h(e),et(n),et(c),t&&h(i),t&&h(u);for(let t=0;t<v.length;t+=1)v[t].d();m=!1,$()}}}function _r(t,e,n){let{message:r}=e;return t.$$set=t=>{"message"in t&&n(0,r=t.message)},[r,()=>ee.deselectThread()]}class qr extends rt{constructor(t){super(),nt(this,t,_r,Nr,l,{message:0})}}function Fr(t){let e,n,r,s,l,o,c,a,i,u,p,v,b,k,z=t[0].headers.Date+"";return c=new ar({props:{address:t[0].headers.From,removed:t[0].tags.includes("trash")}}),{c(){e=g("div"),n=g("div"),r=m("svg"),s=m("path"),l=m("path"),o=w(),Z(c.$$.fragment),i=w(),u=g("span"),p=$(z),y(s,"d","M0 0h24v24H0z"),y(s,"fill","none"),y(l,"d","M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"),y(r,"xmlns","http://www.w3.org/2000/svg"),y(r,"viewBox","0 0 24 24"),y(r,"class","w-5 fill-current"),y(n,"class","flex flex-row items-center"),y(n,"style",a=`padding-left: ${10*t[1]}px;`),y(u,"class","text-gray-500 text-sm"),y(e,"class","p-3 flex flex-row justify-between items-center bg-gray-100 border-b-2 border-gray-200 cursor-pointer")},m(a,h){f(a,e,h),d(e,n),d(n,r),d(r,s),d(r,l),d(n,o),tt(c,n,null),d(e,i),d(e,u),d(u,p),v=!0,b||(k=x(e,"click",t[3]),b=!0)},p(t,[e]){const r={};1&e&&(r.address=t[0].headers.From),1&e&&(r.removed=t[0].tags.includes("trash")),c.$set(r),(!v||2&e&&a!==(a=`padding-left: ${10*t[1]}px;`))&&y(n,"style",a),(!v||1&e)&&z!==(z=t[0].headers.Date+"")&&M(p,z)},i(t){v||(K(c.$$.fragment,t),v=!0)},o(t){Q(c.$$.fragment,t),v=!1},d(t){t&&h(e),et(c),b=!1,k()}}}function Or(t,e,n){let r;c(t,re,(t=>n(4,r=t)));let{message:s}=e,{level:l}=e;function o(){Gt.selectMessage(s.id),Ie(r,s)}return t.$$set=t=>{"message"in t&&n(0,s=t.message),"level"in t&&n(1,l=t.level)},[s,l,o,()=>o()]}class Ir extends rt{constructor(t){super(),nt(this,t,Or,Fr,l,{message:0,level:1})}}function Dr(t,e,n){const r=t.slice();return r[3]=e[n][0],r[4]=e[n][1],r}function Pr(t){let e,n,r=t[0],s=[];for(let e=0;e<r.length;e+=1)s[e]=Wr(Dr(t,r,e));const l=t=>Q(s[t],1,1,(()=>{s[t]=null}));return{c(){for(let t=0;t<s.length;t+=1)s[t].c();e=v()},m(t,r){for(let e=0;e<s.length;e+=1)s[e].m(t,r);f(t,e,r),n=!0},p(t,n){if(7&n){let o;for(r=t[0],o=0;o<r.length;o+=1){const l=Dr(t,r,o);s[o]?(s[o].p(l,n),K(s[o],1)):(s[o]=Wr(l),s[o].c(),K(s[o],1),s[o].m(e.parentNode,e))}for(G(),o=r.length;o<s.length;o+=1)l(o);J()}},i(t){if(!n){for(let t=0;t<r.length;t+=1)K(s[t]);n=!0}},o(t){s=s.filter(Boolean);for(let t=0;t<s.length;t+=1)Q(s[t]);n=!1},d(t){p(s,t),t&&h(e)}}}function Ur(t){let e,n,r,s,l;const o=[Rr,Ar],c=[];function a(t,e){return t[3].id!==t[2]?0:1}return n=a(t),r=c[n]=o[n](t),{c(){e=g("div"),r.c(),y(e,"data-message",s=t[3].id)},m(t,r){f(t,e,r),c[n].m(e,null),l=!0},p(t,i){let u=n;n=a(t),n===u?c[n].p(t,i):(G(),Q(c[u],1,1,(()=>{c[u]=null})),J(),r=c[n],r?r.p(t,i):(r=c[n]=o[n](t),r.c()),K(r,1),r.m(e,null)),(!l||1&i&&s!==(s=t[3].id))&&y(e,"data-message",s)},i(t){l||(K(r),l=!0)},o(t){Q(r),l=!1},d(t){t&&h(e),c[n].d()}}}function Ar(t){let e,n;return e=new qr({props:{message:t[3]}}),{c(){Z(e.$$.fragment)},m(t,r){tt(e,t,r),n=!0},p(t,n){const r={};1&n&&(r.message=t[3]),e.$set(r)},i(t){n||(K(e.$$.fragment,t),n=!0)},o(t){Q(e.$$.fragment,t),n=!1},d(t){et(e,t)}}}function Rr(t){let e,n;return e=new Ir({props:{message:t[3],level:t[1]}}),{c(){Z(e.$$.fragment)},m(t,r){tt(e,t,r),n=!0},p(t,n){const r={};1&n&&(r.message=t[3]),2&n&&(r.level=t[1]),e.$set(r)},i(t){n||(K(e.$$.fragment,t),n=!0)},o(t){Q(e.$$.fragment,t),n=!1},d(t){et(e,t)}}}function Wr(t){let e,n,r,s=!Jr(t[3]),l=s&&Ur(t);return n=new Qr({props:{thread:t[4],level:t[1]+1}}),{c(){l&&l.c(),e=w(),Z(n.$$.fragment)},m(t,s){l&&l.m(t,s),f(t,e,s),tt(n,t,s),r=!0},p(t,r){1&r&&(s=!Jr(t[3])),s?l?(l.p(t,r),1&r&&K(l,1)):(l=Ur(t),l.c(),K(l,1),l.m(e.parentNode,e)):l&&(G(),Q(l,1,1,(()=>{l=null})),J());const o={};1&r&&(o.thread=t[4]),2&r&&(o.level=t[1]+1),n.$set(o)},i(t){r||(K(l),K(n.$$.fragment,t),r=!0)},o(t){Q(l),Q(n.$$.fragment,t),r=!1},d(t){l&&l.d(t),t&&h(e),et(n,t)}}}function Gr(t){let e,n,r=t[0]&&Pr(t);return{c(){e=g("div"),r&&r.c()},m(t,s){f(t,e,s),r&&r.m(e,null),n=!0},p(t,[n]){t[0]?r?(r.p(t,n),1&n&&K(r,1)):(r=Pr(t),r.c(),K(r,1),r.m(e,null)):r&&(G(),Q(r,1,1,(()=>{r=null})),J())},i(t){n||(K(r),n=!0)},o(t){Q(r),n=!1},d(t){t&&h(e),r&&r.d()}}}function Jr({tags:t}){return t.includes("draft")}function Kr(t,e,n){let r;c(t,Gt,(t=>n(2,r=t)));let{thread:s}=e,{level:l=0}=e;return t.$$set=t=>{"thread"in t&&n(0,s=t.thread),"level"in t&&n(1,l=t.level)},[s,l,r]}class Qr extends rt{constructor(t){super(),nt(this,t,Kr,Gr,l,{thread:0,level:1})}}function Xr(t,e,n){const r=t.slice();return r[11]=e[n],r}function Yr(t){let e,n,r=ts(t[11])+"";return{c(){e=g("span"),n=$(r),y(e,"class","mr-2 my-1 px-2 py-1 text-xs rounded bg-gray-600 text-white truncate max-w-md")},m(t,r){f(t,e,r),d(e,n)},p(t,e){2&e&&r!==(r=ts(t[11])+"")&&M(n,r)},d(t){t&&h(e)}}}function Zr(e){let n,s,l,o,c,a,i=e[1],u=[];for(let t=0;t<i.length;t+=1)u[t]=Yr(Xr(e,i,t));return{c(){n=g("div");for(let t=0;t<u.length;t+=1)u[t].c();s=w(),l=g("input"),y(l,"id",e[0]),y(l,"type","text"),y(l,"class","flex-1 outline-none"),y(n,"class",o="flex-1 flex flex-row flex-wrap px-3 p-1 bg-white text-gray-700 rounded border "+e[4])},m(t,r){f(t,n,r);for(let t=0;t<u.length;t+=1)u[t].m(n,null);d(n,s),d(n,l),e[7](l),c||(a=[x(l,"focus",e[8]),x(l,"blur",e[9]),x(l,"keydown",e[5]),x(l,"change",e[6])],c=!0)},p(t,[e]){if(2&e){let r;for(i=t[1],r=0;r<i.length;r+=1){const l=Xr(t,i,r);u[r]?u[r].p(l,e):(u[r]=Yr(l),u[r].c(),u[r].m(n,s))}for(;r<u.length;r+=1)u[r].d(1);u.length=i.length}1&e&&y(l,"id",t[0]),16&e&&o!==(o="flex-1 flex flex-row flex-wrap px-3 p-1 bg-white text-gray-700 rounded border "+t[4])&&y(n,"class",o)},i:t,o:t,d(t){t&&h(n),p(u,t),e[7](null),c=!1,r(a)}}}function ts(t){const e=/(.*)\s\<(.*)\>/.exec(t);return e?e[1]:t}function es(t,e,n){let r,{id:s}=e,{value:l}=e;const o=L();let c,a=!1;return t.$$set=t=>{"id"in t&&n(0,s=t.id),"value"in t&&n(1,l=t.value)},t.$$.update=()=>{4&t.$$.dirty&&n(4,r=a?"border-red-300":"border-gray-400 hover:border-gray-500")},[s,l,a,c,r,function({keyCode:t}){8===t&&(c.value.length>0||o("change",l.slice(0,l.length-1)))},function({target:t}){o("change",[...l,t.value]),t.value=null},function(t){S[t?"unshift":"push"]((()=>{c=t,n(3,c)}))},()=>n(2,a=!0),()=>n(2,a=!1)]}class ns extends rt{constructor(t){super(),nt(this,t,es,Zr,l,{id:0,value:1})}}function rs(t,e,n){const r=t.slice();return r[4]=e[n],r}function ss(e){let n,r,s,l=e[4].content+"";return{c(){n=g("p"),r=$(l),s=w(),y(n,"class","whitespace-pre-wrap break-words"),y(n,"data-type",e[4].type)},m(t,e){f(t,n,e),d(n,r),d(n,s)},p:t,d(t){t&&h(n)}}}function ls(e){let n,r,s,l=e[4].content.replace(/^>\s?/gm,"")+"";return{c(){n=g("p"),r=$(l),s=w(),y(n,"class","whitespace-pre-wrap break-words text-gray-600 border-l-8 border-gray-400 pl-3"),y(n,"data-type",e[4].type)},m(t,e){f(t,n,e),d(n,r),d(n,s)},p:t,d(t){t&&h(n)}}}function os(t){let e;let n=function(t,e){return"quote"===t[4].type?ls:ss}(t)(t);return{c(){n.c(),e=v()},m(t,r){n.m(t,r),f(t,e,r)},p(t,e){n.p(t,e)},d(t){n.d(t),t&&h(e)}}}function cs(e){let n,s,l,o=e[0],c=[];for(let t=0;t<o.length;t+=1)c[t]=os(rs(e,o,t));return{c(){n=g("div");for(let t=0;t<c.length;t+=1)c[t].c();y(n,"contenteditable","true"),z(n,"width","85ch"),y(n,"class","h-80 border rounded p-3 outline-none border-gray-400 hover:border-gray-500 focus:border-red-300 overflow-y-auto")},m(t,r){f(t,n,r);for(let t=0;t<c.length;t+=1)c[t].m(n,null);s||(l=[x(n,"input",e[1]),x(n,"beforeinput",as)],s=!0)},p(t,[e]){if(1&e){let r;for(o=t[0],r=0;r<o.length;r+=1){const s=rs(t,o,r);c[r]?c[r].p(s,e):(c[r]=os(s),c[r].c(),c[r].m(n,null))}for(;r<c.length;r+=1)c[r].d(1);c.length=o.length}},i:t,o:t,d(t){t&&h(n),p(c,t),s=!1,r(l)}}}function as(t){const e=t.getTargetRanges();if(0===e.length)return;const{startContainer:n,startOffset:r}=e[0],s=n.parentNode;if("quote"===s.dataset.type)if("insertParagraph"===t.inputType){t.preventDefault(),s.innerHTML=n.wholeText.slice(0,r);const e=`\n<p class="whitespace-pre-wrap break-words" data-type="text">\n</p>\n<p class="whitespace-pre-wrap break-words text-gray-600 border-l-8 border-gray-400 pl-3" data-type="quote">${n.wholeText.slice(r+1)}</p>`;s.insertAdjacentHTML("afterend",e),window.getSelection().collapse(s.nextSibling.nextSibling)}else t.inputType.startsWith("deleteContent")||t.preventDefault()}function is(t,e,n){let{blocks:r=[]}=e;const s=L();let l=r;return t.$$set=t=>{"blocks"in t&&n(2,r=t.blocks)},[l,function({target:t}){const e=[];for(const n of t.querySelectorAll("p")){const t="quote"===n.dataset.type?n.textContent.replace(/^/gm,"> "):n.textContent;e.push({type:n.dataset.type,content:t+(t.endsWith("\n")?"":"\n")})}s("input",e)},r]}class us extends rt{constructor(t){super(),nt(this,t,is,cs,l,{blocks:2})}}function ds(t,e,n){const r=t.slice();return r[22]=e[n],r[24]=n,r}function fs(t){let e,n=t[3].attachments,r=[];for(let e=0;e<n.length;e+=1)r[e]=hs(ds(t,n,e));return{c(){for(let t=0;t<r.length;t+=1)r[t].c();e=v()},m(t,n){for(let e=0;e<r.length;e+=1)r[e].m(t,n);f(t,e,n)},p(t,s){if(1032&s){let l;for(n=t[3].attachments,l=0;l<n.length;l+=1){const o=ds(t,n,l);r[l]?r[l].p(o,s):(r[l]=hs(o),r[l].c(),r[l].m(e.parentNode,e))}for(;l<r.length;l+=1)r[l].d(1);r.length=n.length}},d(t){p(r,t),t&&h(e)}}}function hs(t){let e,n,r,s,l,o,c,a,i=t[22].name+"",u=gs(t[22].size)+"";function p(){return t[18](t[24])}return{c(){e=g("button"),n=g("strong"),r=$(i),s=$(" ("),l=$(u),o=$(")"),y(n,"class","mr-1"),y(e,"class","h-10 border border-gray-600 p-2 mr-1 mb-1 rounded text-gray-600 text-sm hover:border-red-500 active:bg-red-300 focus:outline-none")},m(t,i){f(t,e,i),d(e,n),d(n,r),d(e,s),d(e,l),d(e,o),c||(a=x(e,"click",p),c=!0)},p(e,n){t=e,8&n&&i!==(i=t[22].name+"")&&M(r,i),8&n&&u!==(u=gs(t[22].size)+"")&&M(l,u)},d(t){t&&h(e),c=!1,a()}}}function ps(t){let e,n,s,l,o,c,a,i,u,p,m,v,b,k,H,T,C,V,L,B,j,S,E,N,_,q,F,O,I,D,P,U,A,R,W,G,J,X,Y,nt,rt,st,lt,ot,ct,at,it,ut,dt,ft,ht,pt,gt=(t[3]?.subject||"New message")+"";S=new ns({props:{id:"to",value:t[3]?.to}}),S.$on("change",t[12]),F=new ns({props:{id:"cc",value:t[3]?.cc}}),F.$on("change",t[13]),G=new us({props:{blocks:t[2]}}),G.$on("input",t[15]);let mt=t[3]?.attachments&&fs(t);return{c(){e=g("div"),n=g("div"),s=g("span"),l=$(gt),o=w(),c=g("button"),c.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="w-full fill-current"><path d="M0 0h24v24H0z" fill="none"></path><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg>',a=w(),i=g("div"),u=g("div"),p=g("label"),p.textContent="From:",m=w(),v=g("span"),b=g("strong"),k=$(t[4]),H=$("\n        <"),T=$(t[5]),C=$(">"),V=w(),L=g("div"),B=g("label"),B.textContent="To:",j=w(),Z(S.$$.fragment),E=w(),N=g("div"),_=g("label"),_.textContent="CC:",q=w(),Z(F.$$.fragment),O=w(),I=g("div"),D=g("label"),D.textContent="Subject:",P=w(),U=g("input"),R=w(),W=g("div"),Z(G.$$.fragment),J=w(),X=g("div"),Y=g("div"),nt=g("input"),rt=w(),st=g("button"),st.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="h-5 fill-current"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16.5 6v11.5c0 2.21-1.79 4-4 4s-4-1.79-4-4V5c0-1.38 1.12-2.5 2.5-2.5s2.5 1.12 2.5 2.5v10.5c0 .55-.45 1-1 1s-1-.45-1-1V6H10v9.5c0 1.38 1.12 2.5 2.5 2.5s2.5-1.12 2.5-2.5V5c0-2.21-1.79-4-4-4S7 2.79 7 5v12.5c0 3.04 2.46 5.5 5.5 5.5s5.5-2.46 5.5-5.5V6h-1.5z"></path></svg>',lt=w(),mt&&mt.c(),ot=w(),ct=g("div"),at=g("button"),at.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="h-5 fill-current"><path d="M0 0h24v24H0z" fill="none"></path><path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"></path></svg>',it=w(),ut=g("button"),dt=$("Send"),y(c,"class","w-5 text-white hover:text-gray-200 active:text-gray-400 focus:outline-none"),y(n,"class","px-3 py-2 flex flex-row items-center justify-between bg-gray-500 text-white"),y(p,"class","w-20"),y(p,"for","from"),y(b,"class","font-semibold "),y(v,"class","text-gray-600"),y(u,"class","flex flex-row items-center mb-2"),y(B,"class","w-20 flex-shrink-0"),y(B,"for","to"),y(L,"class","flex flex-row items-center mb-2"),y(_,"class","w-20 flex-shrink-0"),y(_,"for","cc"),y(N,"class","flex flex-row items-center mb-2"),y(D,"class","w-20"),y(D,"for","subject"),y(U,"type","text"),y(U,"id","subject"),y(U,"class","flex-1 outline-none px-3 py-1 bg-white text-gray-700 rounded border border-gray-400 hover:border-gray-500 focus:border-red-300"),U.value=A=t[3]?.subject,y(I,"class","flex flex-row items-center"),y(i,"class","p-3 bg-gray-100 text-gray-500"),y(W,"class","p-3"),nt.multiple=!0,y(nt,"type","file"),y(nt,"class","hidden"),y(st,"class","h-10 p-2 mr-3 mb-1 rounded hover:border-red-500 bg-white text-gray-700 active:bg-red-300 focus:outline-none border"),y(Y,"class","flex flex-row flex-wrap"),y(at,"class","h-10 p-2 mr-3 rounded hover:border-red-500 bg-white text-gray-700 active:bg-red-300 focus:outline-none border"),y(ut,"class","bg-red-500 hover:bg-red-600 active:bg-red-700 focus:outline-none px-3 text-white h-10 rounded border-0 font-semibold"),ut.disabled=t[0],y(ct,"class","flex flex-row"),y(X,"class","px-3 mb-3 flex flex-row justify-between items-center"),y(e,"class","absolute bottom-5 right-5 bg-white shadow rounded border-2 border-gray-500"),z(e,"max-width","calc(85ch + 2rem)")},m(r,h){f(r,e,h),d(e,n),d(n,s),d(s,l),d(n,o),d(n,c),d(e,a),d(e,i),d(i,u),d(u,p),d(u,m),d(u,v),d(v,b),d(b,k),d(v,H),d(v,T),d(v,C),d(i,V),d(i,L),d(L,B),d(L,j),tt(S,L,null),d(i,E),d(i,N),d(N,_),d(N,q),tt(F,N,null),d(i,O),d(i,I),d(I,D),d(I,P),d(I,U),d(e,R),d(e,W),tt(G,W,null),d(e,J),d(e,X),d(X,Y),d(Y,nt),t[16](nt),d(Y,rt),d(Y,st),d(Y,lt),mt&&mt.m(Y,null),d(X,ot),d(X,ct),d(ct,at),d(ct,it),d(ct,ut),d(ut,dt),ft=!0,ht||(pt=[x(c,"click",t[11]),x(U,"change",t[14]),x(nt,"change",t[9]),x(st,"click",t[17]),x(ut,"click",t[19])],ht=!0)},p(t,[e]){(!ft||8&e)&&gt!==(gt=(t[3]?.subject||"New message")+"")&&M(l,gt),(!ft||16&e)&&M(k,t[4]),(!ft||32&e)&&M(T,t[5]);const n={};8&e&&(n.value=t[3]?.to),S.$set(n);const r={};8&e&&(r.value=t[3]?.cc),F.$set(r),(!ft||8&e&&A!==(A=t[3]?.subject)&&U.value!==A)&&(U.value=A);const s={};4&e&&(s.blocks=t[2]),G.$set(s),t[3]?.attachments?mt?mt.p(t,e):(mt=fs(t),mt.c(),mt.m(Y,null)):mt&&(mt.d(1),mt=null),(!ft||1&e)&&(ut.disabled=t[0])},i(t){ft||(K(S.$$.fragment,t),K(F.$$.fragment,t),K(G.$$.fragment,t),ft=!0)},o(t){Q(S.$$.fragment,t),Q(F.$$.fragment,t),Q(G.$$.fragment,t),ft=!1},d(n){n&&h(e),et(S),et(F),et(G),t[16](null),mt&&mt.d(),ht=!1,r(pt)}}}function gs(t){return t>1e6?`${(t/1e6).toFixed(2)}MB`:t>1e3?`${(t/1e3).toFixed(2)}KB`:`${t}B`}function ms(t,e,n){let r,s,l,o;c(t,wr,(t=>n(3,r=t))),c(t,re,(t=>n(21,s=t))),c(t,oe,(t=>n(4,l=t))),c(t,le,(t=>n(5,o=t)));const a=L();let i,u=!1;async function d(){n(0,u=!0);try{await _t.default.sendMessage(r),n(0,u=!1),wr.destroy(),qe.fetch(s)}catch(t){t.message,n(0,u=!1)}}let f=[{type:"text",content:""}];if(r?.reply){const{Date:t,From:e}=r?.originalHeaders;f.push({type:"text",content:`On ${t}, ${e} wrote:`},{type:"quote",content:r?.body})}function h({detail:t}){n(2,f=t),wr.setField({body:f.map((({content:t})=>t)).join("")})}function p(t){wr.setField({attachments:r.attachments.filter(((e,n)=>n!==t))})}return[u,i,f,r,l,o,a,d,h,function(){for(const t of i.files)wr.setField({attachments:[...r.attachments,t]})},p,()=>a("close"),({detail:t})=>wr.setField({to:t}),({detail:t})=>wr.setField({cc:t}),({target:t})=>wr.setField({subject:t.value}),t=>h(t),function(t){S[t?"unshift":"push"]((()=>{i=t,n(1,i)}))},()=>i.click(),t=>p(t),()=>d()]}class $s extends rt{constructor(t){super(),nt(this,t,ms,ps,l,{})}}function ws(t){let e,n;return{c(){e=g("h2"),n=$(t[7]),y(e,"class","text-gray-100 font-semibold")},m(t,r){f(t,e,r),d(e,n)},p(t,e){128&e&&M(n,t[7])},d(t){t&&h(e)}}}function vs(t){let e,n,r;return n=new Qr({props:{thread:t[2]}}),{c(){e=g("section"),Z(n.$$.fragment),y(e,"class","flex-1 w-full overflow-y-auto")},m(s,l){f(s,e,l),tt(n,e,null),t[18](e),r=!0},p(t,e){const r={};4&e&&(r.thread=t[2]),n.$set(r)},i(t){r||(K(n.$$.fragment,t),r=!0)},o(t){Q(n.$$.fragment,t),r=!1},d(r){r&&h(e),et(n),t[18](null)}}}function xs(e){let n,r;return n=new $s({}),n.$on("close",e[19]),{c(){Z(n.$$.fragment)},m(t,e){tt(n,t,e),r=!0},p:t,i(t){r||(K(n.$$.fragment,t),r=!0)},o(t){Q(n.$$.fragment,t),r=!1},d(t){et(n,t)}}}function bs(t){let e,n,r,s,l,o,c,a,i,u,p,m,$,v,x,b,M,k,z,H,T,C,V,L,B,j,S,E,N,_,q,F,O,I;e=new st({});let D=!t[6]&&ws(t);c=new ct({props:{refreshing:t[3]}}),c.$on("click",t[10]),p=new ft({props:{collapsed:t[6]}}),p.$on("click",t[15]),v=new ze({props:{collapsed:t[6]}}),M=new $t({props:{collapsed:t[6]}}),M.$on("click",t[16]),C=new Ce({}),L=new fn({props:{disabled:0===t[8].length}}),j=new gn({}),N=new Vn({props:{mailbox:t[0]}});let P=t[1]&&vs(t),U=t[9]&&xs(t);return{c(){Z(e.$$.fragment),n=w(),r=g("div"),s=g("aside"),l=g("div"),D&&D.c(),o=w(),Z(c.$$.fragment),i=w(),u=g("div"),Z(p.$$.fragment),m=w(),$=g("div"),Z(v.$$.fragment),x=w(),b=g("div"),Z(M.$$.fragment),z=w(),H=g("main"),T=g("header"),Z(C.$$.fragment),V=w(),Z(L.$$.fragment),B=w(),Z(j.$$.fragment),S=w(),E=g("section"),Z(N.$$.fragment),q=w(),P&&P.c(),O=w(),U&&U.c(),y(l,"class",a=`h-14 flex flex-row ${t[6]?"justify-center":"justify-between"} items-center p-4`),y(u,"class","px-4"),y($,"class","p-4 flex-1"),y(b,"class","p-4"),y(s,"style",k=`width: ${t[6]?4:14}rem`),y(s,"class","flex-shrink-0 flex flex-col bg-gray-600"),y(T,"class","h-14 flex-shrink-0 flex flex-row items-center justify-center py-3 pr-3 border-b border-gray-500 bg-gray-600"),y(E,"class",_=(t[1]?"h-60 border-b-8":"flex-1")+" flex-shrink-0 border-gray-300 overflow-y-auto"),y(H,"class","flex flex-col"),y(H,"style",F=`width: calc(100% - ${t[6]?4:14}rem)`),y(r,"class","h-screen w-screen flex")},m(a,h){tt(e,a,h),f(a,n,h),f(a,r,h),d(r,s),d(s,l),D&&D.m(l,null),d(l,o),tt(c,l,null),d(s,i),d(s,u),tt(p,u,null),d(s,m),d(s,$),tt(v,$,null),d(s,x),d(s,b),tt(M,b,null),d(r,z),d(r,H),d(H,T),tt(C,T,null),d(T,V),tt(L,T,null),d(T,B),tt(j,T,null),d(H,S),d(H,E),tt(N,E,null),t[17](E),d(H,q),P&&P.m(H,null),d(r,O),U&&U.m(r,null),I=!0},p(t,[e]){t[6]?D&&(D.d(1),D=null):D?D.p(t,e):(D=ws(t),D.c(),D.m(l,o));const n={};8&e&&(n.refreshing=t[3]),c.$set(n),(!I||64&e&&a!==(a=`h-14 flex flex-row ${t[6]?"justify-center":"justify-between"} items-center p-4`))&&y(l,"class",a);const i={};64&e&&(i.collapsed=t[6]),p.$set(i);const u={};64&e&&(u.collapsed=t[6]),v.$set(u);const d={};64&e&&(d.collapsed=t[6]),M.$set(d),(!I||64&e&&k!==(k=`width: ${t[6]?4:14}rem`))&&y(s,"style",k);const f={};256&e&&(f.disabled=0===t[8].length),L.$set(f);const h={};1&e&&(h.mailbox=t[0]),N.$set(h),(!I||2&e&&_!==(_=(t[1]?"h-60 border-b-8":"flex-1")+" flex-shrink-0 border-gray-300 overflow-y-auto"))&&y(E,"class",_),t[1]?P?(P.p(t,e),2&e&&K(P,1)):(P=vs(t),P.c(),K(P,1),P.m(H,null)):P&&(G(),Q(P,1,1,(()=>{P=null})),J()),(!I||64&e&&F!==(F=`width: calc(100% - ${t[6]?4:14}rem)`))&&y(H,"style",F),t[9]?U?(U.p(t,e),512&e&&K(U,1)):(U=xs(t),U.c(),K(U,1),U.m(r,null)):U&&(G(),Q(U,1,1,(()=>{U=null})),J())},i(t){I||(K(e.$$.fragment,t),K(c.$$.fragment,t),K(p.$$.fragment,t),K(v.$$.fragment,t),K(M.$$.fragment,t),K(C.$$.fragment,t),K(L.$$.fragment,t),K(j.$$.fragment,t),K(N.$$.fragment,t),K(P),K(U),I=!0)},o(t){Q(e.$$.fragment,t),Q(c.$$.fragment,t),Q(p.$$.fragment,t),Q(v.$$.fragment,t),Q(M.$$.fragment,t),Q(C.$$.fragment,t),Q(L.$$.fragment,t),Q(j.$$.fragment,t),Q(N.$$.fragment,t),Q(P),Q(U),I=!1},d(s){et(e,s),s&&h(n),s&&h(r),D&&D.d(),et(c),et(p),et(v),et(M),et(C),et(L),et(j),et(N),t[17](null),P&&P.d(),U&&U.d()}}}function ys(t,e,n){let r,s,l,o,a,i,u,d,f,h;c(t,se,(t=>n(11,s=t))),c(t,ue,(t=>n(12,l=t))),c(t,ne,(t=>n(13,o=t))),c(t,re,(t=>n(1,a=t))),c(t,Gt,(t=>n(14,i=t))),c(t,qe,(t=>n(2,u=t))),c(t,le,(t=>n(7,d=t))),c(t,Ae,(t=>n(8,f=t))),c(t,wr,(t=>n(9,h=t)));let p,g,m=!1,$=!0;var w;function v(){n(3,m=!0);const t=Date.now();ue.updateUnreadCounters(),setTimeout((()=>n(3,m=!1)),1e3-Date.now()+t)}w=()=>{setInterval((()=>v()),6e4)},V().$$.on_mount.push(w);return t.$$.update=()=>{14336&t.$$.dirty&&n(0,r=s?.length>0?{id:"search",terms:s,tags:[]}:l.find((({id:t})=>t===o))),10241&t.$$.dirty&&(document.title=r?.unread>0?`(${r.unread}) ${jt[o]}`:jt[o]||s),1&t.$$.dirty&&(document.head.querySelector('link[rel="icon"]').href=function(t){if(!t)return"/favicon.png";const e=document.createElement("canvas");e.height=64,e.width=64;const n=e.getContext("2d");return n.font="64px serif",n.fillText("✉️",0,64),e.toDataURL()}(r?.unread>0)),2&t.$$.dirty&&a&&(async function(){const t=await qe.fetch(a);await O();const e=g.querySelectorAll("div[data-message]");if(0===e.length)return;const n=e[e.length-1].dataset.message,r=Se(u,null,["unread"])||Ee(u,null,[],["trash"])||je(t,n);Gt.selectMessage(r.id),Ie(a,r)}(),async function(){let t;await O();const e=()=>{const e=p.querySelector(`a[data-thread="${a}"]`);e&&(e.scrollIntoView({behavior:"smooth",block:"center"}),clearInterval(t))};t=setInterval(e,100),e()}()),16388&t.$$.dirty&&i&&async function(t){if(!t)return;await O(),g.querySelector(`div[data-message="${t.id}"]`).scrollIntoView({behavior:"smooth",block:"start"})}(je(u,i))},[r,a,u,m,p,g,$,d,f,h,v,s,l,o,i,()=>wr.create(),()=>n(6,$=!$),function(t){S[t?"unshift":"push"]((()=>{p=t,n(4,p)}))},function(t){S[t?"unshift":"push"]((()=>{g=t,n(5,g)}))},()=>wr.destroy()]}return new class extends rt{constructor(t){super(),nt(this,t,ys,bs,l,{})}}({target:document.body,props:{name:"world"}})}();
//# sourceMappingURL=bundle.js.map
