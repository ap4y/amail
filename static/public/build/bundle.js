var app=function(){"use strict";function t(){}function e(t){return t()}function n(){return Object.create(null)}function r(t){t.forEach(e)}function s(t){return"function"==typeof t}function l(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}function o(e,...n){if(null==e)return t;const r=e.subscribe(...n);return r.unsubscribe?()=>r.unsubscribe():r}function c(t,e,n){t.$$.on_destroy.push(o(e,n))}function a(t,e,n,r){if(t){const s=i(t,e,n,r);return t[0](s)}}function i(t,e,n,r){return t[1]&&r?function(t,e){for(const n in e)t[n]=e[n];return t}(n.ctx.slice(),t[1](r(e))):n.ctx}function u(t,e,n,r,s,l,o){const c=function(t,e,n,r){if(t[2]&&r){const s=t[2](r(n));if(void 0===e.dirty)return s;if("object"==typeof s){const t=[],n=Math.max(e.dirty.length,s.length);for(let r=0;r<n;r+=1)t[r]=e.dirty[r]|s[r];return t}return e.dirty|s}return e.dirty}(e,r,s,l);if(c){const s=i(e,n,r,o);t.p(s,c)}}function d(t,e){t.appendChild(e)}function f(t,e,n){t.insertBefore(e,n||null)}function h(t){t.parentNode.removeChild(t)}function p(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function m(t){return document.createElement(t)}function g(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function $(t){return document.createTextNode(t)}function w(){return $(" ")}function x(){return $("")}function b(t,e,n,r){return t.addEventListener(e,n,r),()=>t.removeEventListener(e,n,r)}function v(t){return function(e){return e.preventDefault(),t.call(this,e)}}function y(t,e,n){null==n?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function k(t,e){e=""+e,t.wholeText!==e&&(t.data=e)}function M(t,e){t.value=null==e?"":e}function z(t,e,n,r){t.style.setProperty(e,n,r?"important":"")}let H;function T(t){H=t}function C(){if(!H)throw new Error("Function called outside component initialization");return H}function V(t){C().$$.on_mount.push(t)}function L(){const t=C();return(e,n)=>{const r=t.$$.callbacks[e];if(r){const s=function(t,e){const n=document.createEvent("CustomEvent");return n.initCustomEvent(t,!1,!1,e),n}(e,n);r.slice().forEach((e=>{e.call(t,s)}))}}}function B(t,e){const n=t.$$.callbacks[e.type];n&&n.slice().forEach((t=>t(e)))}const S=[],E=[],j=[],N=[],q=Promise.resolve();let _=!1;function D(){_||(_=!0,q.then(P))}function F(){return D(),q}function A(t){j.push(t)}function I(t){N.push(t)}let O=!1;const R=new Set;function P(){if(!O){O=!0;do{for(let t=0;t<S.length;t+=1){const e=S[t];T(e),U(e.$$)}for(T(null),S.length=0;E.length;)E.pop()();for(let t=0;t<j.length;t+=1){const e=j[t];R.has(e)||(R.add(e),e())}j.length=0}while(S.length);for(;N.length;)N.pop()();_=!1,O=!1,R.clear()}}function U(t){if(null!==t.fragment){t.update(),r(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(A)}}const W=new Set;let G;function K(){G={r:0,c:[],p:G}}function J(){G.r||r(G.c),G=G.p}function X(t,e){t&&t.i&&(W.delete(t),t.i(e))}function Q(t,e,n,r){if(t&&t.o){if(W.has(t))return;W.add(t),G.c.push((()=>{W.delete(t),r&&(n&&t.d(1),r())})),t.o(e)}}function Y(t,e){const n=e.token={};function r(t,r,s,l){if(e.token!==n)return;e.resolved=l;let o=e.ctx;void 0!==s&&(o=o.slice(),o[s]=l);const c=t&&(e.current=t)(o);let a=!1;e.block&&(e.blocks?e.blocks.forEach(((t,n)=>{n!==r&&t&&(K(),Q(t,1,1,(()=>{e.blocks[n]===t&&(e.blocks[n]=null)})),J())})):e.block.d(1),c.c(),X(c,1),c.m(e.mount(),e.anchor),a=!0),e.block=c,e.blocks&&(e.blocks[r]=c),a&&P()}if((s=t)&&"object"==typeof s&&"function"==typeof s.then){const n=C();if(t.then((t=>{T(n),r(e.then,1,e.value,t),T(null)}),(t=>{if(T(n),r(e.catch,2,e.error,t),T(null),!e.hasCatch)throw t})),e.current!==e.pending)return r(e.pending,0),!0}else{if(e.current!==e.then)return r(e.then,1,e.value,t),!0;e.resolved=t}var s}function Z(t,e,n){const r=e.slice(),{resolved:s}=t;t.current===t.then&&(r[t.value]=s),t.current===t.catch&&(r[t.error]=s),t.block.p(r,n)}function tt(t,e){Q(t,1,1,(()=>{e.delete(t.key)}))}function et(t,e,n,r,s,l,o,c,a,i,u,d){let f=t.length,h=l.length,p=f;const m={};for(;p--;)m[t[p].key]=p;const g=[],$=new Map,w=new Map;for(p=h;p--;){const t=d(s,l,p),c=n(t);let a=o.get(c);a?r&&a.p(t,e):(a=i(c,t),a.c()),$.set(c,g[p]=a),c in m&&w.set(c,Math.abs(p-m[c]))}const x=new Set,b=new Set;function v(t){X(t,1),t.m(c,u),o.set(t.key,t),u=t.first,h--}for(;f&&h;){const e=g[h-1],n=t[f-1],r=e.key,s=n.key;e===n?(u=e.first,f--,h--):$.has(s)?!o.has(r)||x.has(r)?v(e):b.has(s)?f--:w.get(r)>w.get(s)?(b.add(r),v(e)):(x.add(s),f--):(a(n,o),f--)}for(;f--;){const e=t[f];$.has(e.key)||a(e,o)}for(;h;)v(g[h-1]);return g}function nt(t,e,n){const r=t.$$.props[e];void 0!==r&&(t.$$.bound[r]=n,n(t.$$.ctx[r]))}function rt(t){t&&t.c()}function st(t,n,l,o){const{fragment:c,on_mount:a,on_destroy:i,after_update:u}=t.$$;c&&c.m(n,l),o||A((()=>{const n=a.map(e).filter(s);i?i.push(...n):r(n),t.$$.on_mount=[]})),u.forEach(A)}function lt(t,e){const n=t.$$;null!==n.fragment&&(r(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function ot(e,s,l,o,c,a,i=[-1]){const u=H;T(e);const d=e.$$={fragment:null,ctx:null,props:a,update:t,not_equal:c,bound:n(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(u?u.$$.context:s.context||[]),callbacks:n(),dirty:i,skip_bound:!1};let f=!1;if(d.ctx=l?l(e,s.props||{},((t,n,...r)=>{const s=r.length?r[0]:n;return d.ctx&&c(d.ctx[t],d.ctx[t]=s)&&(!d.skip_bound&&d.bound[t]&&d.bound[t](s),f&&function(t,e){-1===t.$$.dirty[0]&&(S.push(t),D(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}(e,t)),n})):[],d.update(),f=!0,r(d.before_update),d.fragment=!!o&&o(d.ctx),s.target){if(s.hydrate){const t=function(t){return Array.from(t.childNodes)}(s.target);d.fragment&&d.fragment.l(t),t.forEach(h)}else d.fragment&&d.fragment.c();s.intro&&X(e.$$.fragment),st(e,s.target,s.anchor,s.customElement),P()}T(u)}class ct{$destroy(){lt(this,1),this.$destroy=t}$on(t,e){const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(e),()=>{const t=n.indexOf(e);-1!==t&&n.splice(t,1)}}$set(t){var e;this.$$set&&(e=t,0!==Object.keys(e).length)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}class at extends ct{constructor(t){super(),ot(this,t,null,null,l,{})}}function it(e){let n,r,s,l,o,c,a;return{c(){n=m("button"),r=g("svg"),s=g("path"),l=g("path"),y(s,"d","M0 0h24v24H0z"),y(s,"fill","none"),y(l,"d","M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"),y(r,"xmlns","http://www.w3.org/2000/svg"),y(r,"viewBox","0 0 24 24"),y(r,"class",o="fill-current "+(e[0]?"animate-spin":"")),y(n,"class","w-6 text-white hover:text-gray-300 active:text-gray-400 focus:outline-none")},m(t,o){f(t,n,o),d(n,r),d(r,s),d(r,l),c||(a=b(r,"click",e[1]),c=!0)},p(t,[e]){1&e&&o!==(o="fill-current "+(t[0]?"animate-spin":""))&&y(r,"class",o)},i:t,o:t,d(t){t&&h(n),c=!1,a()}}}function ut(t,e,n){let{refreshing:r}=e;return t.$$set=t=>{"refreshing"in t&&n(0,r=t.refreshing)},[r,function(e){B(t,e)}]}class dt extends ct{constructor(t){super(),ot(this,t,ut,it,l,{refreshing:0})}}function ft(t){let e,n,r;return{c(){e=m("button"),e.textContent="New message",y(e,"class","bg-red-600 hover:bg-red-700 active:bg-red-800 focus:outline-none w-full text-white h-10 rounded border-0 font-semibold")},m(s,l){f(s,e,l),n||(r=b(e,"click",t[2]),n=!0)},d(t){t&&h(e),n=!1,r()}}}function ht(t){let e,n,r;return{c(){e=m("button"),e.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="fill-current h-full"><path d="M19,13h-6v6h-2v-6H5v-2h6V5h2v6h6V13z"></path>\n      &gt;</svg>',y(e,"class","bg-red-600 hover:bg-red-700 active:bg-red-800 focus:outline-none w-8 text-white h-8 p-1 rounded border-0")},m(s,l){f(s,e,l),n||(r=b(e,"click",t[1]),n=!0)},d(t){t&&h(e),n=!1,r()}}}function pt(e){let n;function r(t,e){return t[0]?ht:ft}let s=r(e),l=s(e);return{c(){l.c(),n=x()},m(t,e){l.m(t,e),f(t,n,e)},p(t,[e]){s!==(s=r(t))&&(l.d(1),l=s(t),l&&(l.c(),l.m(n.parentNode,n)))},i:t,o:t,d(t){l.d(t),t&&h(n)}}}function mt(t,e,n){let{collapsed:r=!1}=e;return t.$$set=t=>{"collapsed"in t&&n(0,r=t.collapsed)},[r,function(e){B(t,e)},function(e){B(t,e)}]}class gt extends ct{constructor(t){super(),ot(this,t,mt,pt,l,{collapsed:0})}}function $t(t){let e,n,r;return{c(){e=g("svg"),n=g("path"),r=g("path"),y(n,"d","M0 0h24v24H0V0z"),y(n,"fill","none"),y(r,"d","M3 18h13v-2H3v2zm0-5h10v-2H3v2zm0-7v2h13V6H3zm18 9.59L17.42 12 21 8.41 19.59 7l-5 5 5 5L21 15.59z"),y(e,"xmlns","http://www.w3.org/2000/svg"),y(e,"viewBox","0 0 24 24"),y(e,"class","fill-current h-full")},m(t,s){f(t,e,s),d(e,n),d(e,r)},d(t){t&&h(e)}}}function wt(t){let e,n,r;return{c(){e=g("svg"),n=g("path"),r=g("path"),y(n,"d","M0 0h24v24H0z"),y(n,"fill","none"),y(r,"d","M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"),y(e,"xmlns","http://www.w3.org/2000/svg"),y(e,"viewBox","0 0 24 24"),y(e,"class","fill-current h-full")},m(t,s){f(t,e,s),d(e,n),d(e,r)},d(t){t&&h(e)}}}function xt(e){let n,r,s;function l(t,e){return t[0]?wt:$t}let o=l(e),c=o(e);return{c(){n=m("button"),c.c(),y(n,"class","text-gray-300 h-8 p-1 rounded hover:bg-gray-700 focus:outline-none")},m(t,l){f(t,n,l),c.m(n,null),r||(s=b(n,"click",e[1]),r=!0)},p(t,[e]){o!==(o=l(t))&&(c.d(1),c=o(t),c&&(c.c(),c.m(n,null)))},i:t,o:t,d(t){t&&h(n),c.d(),r=!1,s()}}}function bt(t,e,n){let{collapsed:r}=e;return t.$$set=t=>{"collapsed"in t&&n(0,r=t.collapsed)},[r,function(e){B(t,e)}]}class vt extends ct{constructor(t){super(),ot(this,t,bt,xt,l,{collapsed:0})}}const yt=["inbox","archive","sent","draft","spam","trash"],kt={inbox:"Inbox",archive:"Archive",sent:"Sent",draft:"Drafts",spam:"Spam",trash:"Trash"},Mt=[];function zt(e,n=t){let r;const s=[];function o(t){if(l(e,t)&&(e=t,r)){const t=!Mt.length;for(let t=0;t<s.length;t+=1){const n=s[t];n[1](),Mt.push(n,e)}if(t){for(let t=0;t<Mt.length;t+=2)Mt[t][0](Mt[t+1]);Mt.length=0}}}return{set:o,update:function(t){o(t(e))},subscribe:function(l,c=t){const a=[l,c];return s.push(a),1===s.length&&(r=n(o)||t),l(e),()=>{const t=s.indexOf(a);-1!==t&&s.splice(t,1),0===s.length&&(r(),r=null)}}}}function Ht(e,n,l){const c=!Array.isArray(e),a=c?[e]:e,i=n.length<2;return{subscribe:zt(l,(e=>{let l=!1;const u=[];let d=0,f=t;const h=()=>{if(d)return;f();const r=n(c?u[0]:u,e);i?e(r):f=s(r)?r:t},p=a.map(((t,e)=>o(t,(t=>{u[e]=t,d&=~(1<<e),l&&h()}),(()=>{d|=1<<e}))));return l=!0,h(),function(){r(p),f()}})).subscribe}}const{subscribe:Tt,set:Ct,update:Vt}=zt(null);var Lt={subscribe:Tt,selectMessage:function(t){Ct(t)}};const Bt=new URL(window.location.href),St=zt(Bt),[,Et,jt]=Bt.pathname.split("/");Bt.mailbox=Et,"search"===Et?Bt.searchTerms=Bt.searchParams.get("terms"):Bt.thread=jt;const Nt=({state:t})=>{const e=new URL(window.location.href);e.mailbox=t?.mailbox,e.thread=t?.thread,e.searchTerms=t?.searchTerms,St.set(e)};function qt(t,e){history.pushState(t,"",e),Nt({state:t}),console.debug(`navigating to ${e}, state: `,t)}window.addEventListener("popstate",Nt);const _t=Ht(St,(t=>t));var Dt={subscribe:_t.subscribe,selectMailbox:function(t){qt({mailbox:t},`/${t}`)},selectThread:function(t,e){const n=history.state,r={mailbox:t,thread:e,searchTerms:n?.searchTerms};let s=`/${t}/${e}`;n?.searchTerms&&(s+=`?terms=${escape(n.searchTerms)}`),qt(r,s)},deselectThread:function(){const t=history.state;Lt.selectMessage(null),qt({mailbox:t.mailbox,thread:null},`/${t.mailbox}`)},search:function(t){qt({mailbox:"search",searchTerms:t},`/search/?terms=${escape(t)}`)}};const Ft=Ht(_t,(t=>t.mailbox?.length>0?t.mailbox:yt[0])),At=Ht(_t,(t=>t.thread)),It=Ht(_t,(t=>t.searchTerms));class Ot{static default=new Ot("/api");constructor(t){this.baseURL=t}async request(t="GET",e,n){const r=await fetch(`${this.baseURL}${e}`,{method:t,headers:{"Content-Type":"application/json",Accept:"application/json"},body:n?JSON.stringify(n):null});if(r.ok)return r.json();throw new Rt(r.status,r.statusText)}mailboxes(){return this.request("GET","/mailboxes")}threads(t,e=0,n=50){return this.request("GET",`/search/${t}?page=${e}&per=${n}`)}addresses(t){return this.request("GET",`/address/${t}`)}thread(t){return this.request("GET",`/threads/${t}`)}updateTags(t,e){return this.request("PUT","/tags",{terms:t,tags:e})}w3mRender(t,e){return this.request("GET",`/messages/${t}/w3m/${e}`)}async sendMessage(t){const e=await fetch(`${this.baseURL}/messages`,{method:"POST",body:this.messageFormData(t)});if(e.ok)return null;throw new Rt(e.status,e.statusText)}async saveMessage(t){const e=await fetch(`${this.baseURL}/drafts`,{method:"POST",body:this.messageFormData(t)});if(e.ok)return null;throw new Rt(e.status,e.statusText)}replyToMessage(t,e){return this.request("GET",`/messages/${btoa(t)}/reply?reply-to=${e}`)}messageFormData(t){const e=new FormData;return t.to.forEach((t=>e.append("to[]",t))),t.cc.forEach((t=>e.append("cc[]",t))),e.append("subject",t.subject),e.append("body",t.body),Object.keys(t.headers).forEach((n=>e.append(`headers[${n}]`,t.headers[n]))),t.attachments.forEach((t=>{t instanceof File?e.append("attachments[]",t,t.name):e.append("attachments[]",t.id)})),e}}class Rt extends Error{constructor(t,e){super(`Invalid response ${t}: ${e}`),this.status=t}}const Pt=zt(""),Ut=zt(null),Wt=zt([]),{subscribe:Gt,set:Kt,update:Jt}=zt([]);var Xt={subscribe:Gt,fetch:async()=>{const t=await Ot.default.mailboxes();return Kt(t.mailboxes),Pt.set(t.address),Ut.set(t.name),Wt.set(t.tags),t.mailboxes},updateUnreadCounters:async()=>{const{mailboxes:t}=await Ot.default.mailboxes();Jt((e=>e.map(((e,n)=>({...e,unread:t[n].unread})))))}};const Qt=zt(0),Yt=zt(!1),{subscribe:Zt,set:te,update:ee}=zt([]);var ne={subscribe:Zt,fetch:async({id:t,terms:e},n)=>{if(!e)return te([]),[];const{has_more:r,threads:s}=await Ot.default.threads(e,n||0,50);return function(t){let e;return o(t,(t=>e=t))(),e}(Ft)===t&&(Yt.set(r),te(s)),s},setTags:(t,e)=>{ee((n=>n.map((n=>n.thread===t?{...n,tags:e}:n))))},remove:t=>{ee((e=>e.filter((e=>e!=t))))}};function re(t){let e,n,r;return{c(){e=g("svg"),n=g("path"),r=g("path"),y(n,"d","M0 0h24v24H0z"),y(n,"fill","none"),y(r,"d","M17 3H7c-1.1 0-1.99.9-1.99 2L5 21l7-3 7 3V5c0-1.1-.9-2-2-2zm0 15l-5-2.18L7 18V5h10v13z"),y(e,"xmlns","http://www.w3.org/2000/svg"),y(e,"viewBox","0 0 24 24"),y(e,"class","fill-current w-full")},m(t,s){f(t,e,s),d(e,n),d(e,r)},d(t){t&&h(e)}}}function se(t){let e,n,r;return{c(){e=g("svg"),n=g("path"),r=g("path"),y(n,"d","M0 0h24v24H0z"),y(n,"fill","none"),y(r,"d","M21.41 11.58l-9-9C12.05 2.22 11.55 2 11 2H4c-1.1 0-2 .9-2 2v7c0 .55.22 1.05.59 1.42l9 9c.36.36.86.58 1.41.58.55 0 1.05-.22 1.41-.59l7-7c.37-.36.59-.86.59-1.41 0-.55-.23-1.06-.59-1.42zM5.5 7C4.67 7 4 6.33 4 5.5S4.67 4 5.5 4 7 4.67 7 5.5 6.33 7 5.5 7z"),y(e,"xmlns","http://www.w3.org/2000/svg"),y(e,"viewBox","0 0 24 24"),y(e,"class","fill-current w-full")},m(t,s){f(t,e,s),d(e,n),d(e,r)},d(t){t&&h(e)}}}function le(t){let e,n,r;return{c(){e=g("svg"),n=g("path"),r=g("path"),y(n,"d","M0 0h24v24H0z"),y(n,"fill","none"),y(r,"d","M10 9V5l-7 7 7 7v-4.1c5 0 8.5 1.6 11 5.1-1-5-4-10-11-11z"),y(e,"xmlns","http://www.w3.org/2000/svg"),y(e,"viewBox","0 0 24 24"),y(e,"class","fill-current w-full")},m(t,s){f(t,e,s),d(e,n),d(e,r)},d(t){t&&h(e)}}}function oe(t){let e,n,r;return{c(){e=g("svg"),n=g("path"),r=g("path"),y(n,"d","M0 0h24v24H0z"),y(n,"fill","none"),y(r,"d","M16.5 6v11.5c0 2.21-1.79 4-4 4s-4-1.79-4-4V5c0-1.38 1.12-2.5 2.5-2.5s2.5 1.12 2.5 2.5v10.5c0 .55-.45 1-1 1s-1-.45-1-1V6H10v9.5c0 1.38 1.12 2.5 2.5 2.5s2.5-1.12 2.5-2.5V5c0-2.21-1.79-4-4-4S7 2.79 7 5v12.5c0 3.04 2.46 5.5 5.5 5.5s5.5-2.46 5.5-5.5V6h-1.5z"),y(e,"xmlns","http://www.w3.org/2000/svg"),y(e,"viewBox","0 0 24 24"),y(e,"class","fill-current w-full")},m(t,s){f(t,e,s),d(e,n),d(e,r)},d(t){t&&h(e)}}}function ce(t){let e,n,r;return{c(){e=g("svg"),n=g("path"),r=g("path"),y(n,"d","M0 0h24v24H0z"),y(n,"fill","none"),y(r,"d","M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"),y(e,"xmlns","http://www.w3.org/2000/svg"),y(e,"viewBox","0 0 24 24"),y(e,"class","fill-current w-full")},m(t,s){f(t,e,s),d(e,n),d(e,r)},d(t){t&&h(e)}}}function ae(t){let e,n,r;return{c(){e=g("svg"),n=g("path"),r=g("path"),y(n,"d","M0 0h24v24H0z"),y(n,"fill","none"),y(r,"d","M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.42 0-8-3.58-8-8 0-1.85.63-3.55 1.69-4.9L16.9 18.31C15.55 19.37 13.85 20 12 20zm6.31-3.1L7.1 5.69C8.45 4.63 10.15 4 12 4c4.42 0 8 3.58 8 8 0 1.85-.63 3.55-1.69 4.9z"),y(e,"xmlns","http://www.w3.org/2000/svg"),y(e,"viewBox","0 0 24 24"),y(e,"class","fill-current w-full")},m(t,s){f(t,e,s),d(e,n),d(e,r)},d(t){t&&h(e)}}}function ie(t){let e,n,r;return{c(){e=g("svg"),n=g("path"),r=g("path"),y(n,"d","M0 0h24v24H0z"),y(n,"fill","none"),y(r,"d","M21.99 8c0-.72-.37-1.35-.94-1.7L12 1 2.95 6.3C2.38 6.65 2 7.28 2 8v10c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2l-.01-10zM12 13L3.74 7.84 12 3l8.26 4.84L12 13z"),y(e,"xmlns","http://www.w3.org/2000/svg"),y(e,"viewBox","0 0 24 24"),y(e,"class","fill-current w-full")},m(t,s){f(t,e,s),d(e,n),d(e,r)},d(t){t&&h(e)}}}function ue(t){let e,n,r;return{c(){e=g("svg"),n=g("path"),r=g("path"),y(n,"d","M0 0h24v24H0V0z"),y(n,"fill","none"),y(r,"d","M19 3H4.99c-1.11 0-1.98.9-1.98 2L3 19c0 1.1.88 2 1.99 2H19c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 12h-4c0 1.66-1.35 3-3 3s-3-1.34-3-3H4.99V5H19v10zM8 11h2v3h4v-3h2l-4-4-4 4z"),y(e,"xmlns","http://www.w3.org/2000/svg"),y(e,"viewBox","0 0 24 24"),y(e,"class","fill-current w-full")},m(t,s){f(t,e,s),d(e,n),d(e,r)},d(t){t&&h(e)}}}function de(t){let e,n,r,s,l;return{c(){e=g("svg"),n=g("g"),r=g("rect"),s=g("g"),l=g("path"),y(r,"fill","none"),y(r,"height","24"),y(r,"width","24"),y(l,"d","M20,2H4C3,2,2,2.9,2,4v3.01C2,7.73,2.43,8.35,3,8.7V20c0,1.1,1.1,2,2,2h14c0.9,0,2-0.9,2-2V8.7c0.57-0.35,1-0.97,1-1.69V4 C22,2.9,21,2,20,2z M15,14H9v-2h6V14z M20,7H4V4h16V7z"),y(e,"xmlns","http://www.w3.org/2000/svg"),y(e,"enable-background","new 0 0 24 24"),y(e,"viewBox","0 0 24 24"),y(e,"class","fill-current w-full")},m(t,o){f(t,e,o),d(e,n),d(n,r),d(e,s),d(s,l)},d(t){t&&h(e)}}}function fe(t){let e,n,r;return{c(){e=g("svg"),n=g("path"),r=g("path"),y(n,"d","M0 0h24v24H0V0z"),y(n,"fill","none"),y(r,"d","M19 3H4.99c-1.11 0-1.98.89-1.98 2L3 19c0 1.1.88 2 1.99 2H19c1.1 0 2-.9 2-2V5c0-1.11-.9-2-2-2zm0 12h-4c0 1.66-1.35 3-3 3s-3-1.34-3-3H4.99V5H19v10z"),y(e,"xmlns","http://www.w3.org/2000/svg"),y(e,"viewBox","0 0 24 24"),y(e,"class","fill-current w-full")},m(t,s){f(t,e,s),d(e,n),d(e,r)},d(t){t&&h(e)}}}function he(e){let n;function r(t,e){return"inbox"===t[0]?fe:"archive"===t[0]?de:"sent"===t[0]?ue:"draft"===t[0]?ie:"spam"===t[0]?ae:"trash"===t[0]?ce:"attachment"===t[0]?oe:"replied"===t[0]?le:"tag"===t[1]?se:re}let s=r(e),l=s(e);return{c(){l.c(),n=x()},m(t,e){l.m(t,e),f(t,n,e)},p(t,[e]){s!==(s=r(t))&&(l.d(1),l=s(t),l&&(l.c(),l.m(n.parentNode,n)))},i:t,o:t,d(t){l.d(t),t&&h(n)}}}function pe(t,e,n){let{id:r}=e,{iconType:s="inbox"}=e;return t.$$set=t=>{"id"in t&&n(0,r=t.id),"iconType"in t&&n(1,s=t.iconType)},[r,s]}class me extends ct{constructor(t){super(),ot(this,t,pe,he,l,{id:0,iconType:1})}}function ge(t){let e,n,r,s,l,o=t[0][0]+"";return e=new me({props:{id:t[0]}}),{c(){rt(e.$$.fragment),n=w(),r=m("span"),s=$(o),y(r,"class","absolute text-sm left-1/2 top-1/2 transform -translate-x-1/2 -translate-y-2/3")},m(t,o){st(e,t,o),f(t,n,o),f(t,r,o),d(r,s),l=!0},p(t,n){const r={};1&n&&(r.id=t[0]),e.$set(r),(!l||1&n)&&o!==(o=t[0][0]+"")&&k(s,o)},i(t){l||(X(e.$$.fragment,t),l=!0)},o(t){Q(e.$$.fragment,t),l=!1},d(t){lt(e,t),t&&h(n),t&&h(r)}}}function $e(t){let e,n;return e=new me({props:{id:t[0]}}),{c(){rt(e.$$.fragment)},m(t,r){st(e,t,r),n=!0},p(t,n){const r={};1&n&&(r.id=t[0]),e.$set(r)},i(t){n||(X(e.$$.fragment,t),n=!0)},o(t){Q(e.$$.fragment,t),n=!1},d(t){lt(e,t)}}}function we(t){let e,n,s,l,o,c,a,i,u,p,g,x=(kt[t[0]]||t[0])+"";const v=[$e,ge],M=[];function z(t,e){return kt[t[0]]?0:1}return n=z(t),s=M[n]=v[n](t),{c(){e=m("span"),s.c(),l=w(),o=m("span"),c=$(x),y(o,"class",a="absolute left-8 z-50 transform bottom-0 translate-y-2 p-2 whitespace-nowrap rounded bg-gray-800 text-white "+(t[1]?"":"hidden")),y(e,"class",i="relative "+(kt[t[0]]?"w-5":"w-7"))},m(r,s){f(r,e,s),M[n].m(e,null),d(e,l),d(e,o),d(o,c),u=!0,p||(g=[b(e,"mouseover",t[2]),b(e,"mouseout",t[3])],p=!0)},p(t,[r]){let d=n;n=z(t),n===d?M[n].p(t,r):(K(),Q(M[d],1,1,(()=>{M[d]=null})),J(),s=M[n],s?s.p(t,r):(s=M[n]=v[n](t),s.c()),X(s,1),s.m(e,l)),(!u||1&r)&&x!==(x=(kt[t[0]]||t[0])+"")&&k(c,x),(!u||2&r&&a!==(a="absolute left-8 z-50 transform bottom-0 translate-y-2 p-2 whitespace-nowrap rounded bg-gray-800 text-white "+(t[1]?"":"hidden")))&&y(o,"class",a),(!u||1&r&&i!==(i="relative "+(kt[t[0]]?"w-5":"w-7")))&&y(e,"class",i)},i(t){u||(X(s),u=!0)},o(t){Q(s),u=!1},d(t){t&&h(e),M[n].d(),p=!1,r(g)}}}function xe(t,e,n){let{id:r}=e,s=!1;return t.$$set=t=>{"id"in t&&n(0,r=t.id)},[r,s,()=>n(1,s=!0),()=>n(1,s=!1)]}class be extends ct{constructor(t){super(),ot(this,t,xe,we,l,{id:0})}}function ve(t,e,n){const r=t.slice();return r[5]=e[n],r[7]=n,r}function ye(e){let n;function r(t,e){return t[0]?Me:ke}let s=r(e),l=s(e);return{c(){l.c(),n=x()},m(t,e){l.m(t,e),f(t,n,e)},p(t,e){s!==(s=r(t))&&(l.d(1),l=s(t),l&&(l.c(),l.m(n.parentNode,n)))},i:t,o:t,d(t){l.d(t),t&&h(n)}}}function ke(t){let e;return{c(){e=m("p"),e.textContent="Error",y(e,"class","text-red-500 text-lg text-center")},m(t,n){f(t,e,n)},d(t){t&&h(e)}}}function Me(t){let e;return{c(){e=m("p"),e.textContent="Error",y(e,"class","text-red-500 text-sm text-center")},m(t,n){f(t,e,n)},d(t){t&&h(e)}}}function ze(t){let e,n,r=t[1],s=[];for(let e=0;e<r.length;e+=1)s[e]=Be(ve(t,r,e));const l=t=>Q(s[t],1,1,(()=>{s[t]=null}));return{c(){for(let t=0;t<s.length;t+=1)s[t].c();e=x()},m(t,r){for(let e=0;e<s.length;e+=1)s[e].m(t,r);f(t,e,r),n=!0},p(t,n){if(15&n){let o;for(r=t[1],o=0;o<r.length;o+=1){const l=ve(t,r,o);s[o]?(s[o].p(l,n),X(s[o],1)):(s[o]=Be(l),s[o].c(),X(s[o],1),s[o].m(e.parentNode,e))}for(K(),o=r.length;o<s.length;o+=1)l(o);J()}},i(t){if(!n){for(let t=0;t<r.length;t+=1)X(s[t]);n=!0}},o(t){s=s.filter(Boolean);for(let t=0;t<s.length;t+=1)Q(s[t]);n=!1},d(t){p(s,t),t&&h(e)}}}function He(t){let e,n,r,s,l,o=(kt[t[5].id]||t[5].id)+"";return n=new me({props:{id:t[5].id}}),{c(){e=m("span"),rt(n.$$.fragment),r=w(),s=$(o),y(e,"class","mr-2 w-5")},m(t,o){f(t,e,o),st(n,e,null),f(t,r,o),f(t,s,o),l=!0},p(t,e){const r={};2&e&&(r.id=t[5].id),n.$set(r),(!l||2&e)&&o!==(o=(kt[t[5].id]||t[5].id)+"")&&k(s,o)},i(t){l||(X(n.$$.fragment,t),l=!0)},o(t){Q(n.$$.fragment,t),l=!1},d(t){t&&h(e),lt(n),t&&h(r),t&&h(s)}}}function Te(t){let e,n;return e=new be({props:{id:t[5].id}}),{c(){rt(e.$$.fragment)},m(t,r){st(e,t,r),n=!0},p(t,n){const r={};2&n&&(r.id=t[5].id),e.$set(r)},i(t){n||(X(e.$$.fragment,t),n=!0)},o(t){Q(e.$$.fragment,t),n=!1},d(t){lt(e,t)}}}function Ce(t){let e;function n(t,e){return t[0]?Le:Ve}let r=n(t),s=r(t);return{c(){s.c(),e=x()},m(t,n){s.m(t,n),f(t,e,n)},p(t,l){r===(r=n(t))&&s?s.p(t,l):(s.d(1),s=r(t),s&&(s.c(),s.m(e.parentNode,e)))},d(t){s.d(t),t&&h(e)}}}function Ve(t){let e,n,r,s=t[5].unread+"";return{c(){e=m("span"),n=$(s),y(e,"class",r="inline-flex items-center text-sm px-2 rounded "+("inbox"===t[5].id?"bg-red-600 text-gray-100":"bg-gray-300 text-gray-600"))},m(t,r){f(t,e,r),d(e,n)},p(t,l){2&l&&s!==(s=t[5].unread+"")&&k(n,s),2&l&&r!==(r="inline-flex items-center text-sm px-2 rounded "+("inbox"===t[5].id?"bg-red-600 text-gray-100":"bg-gray-300 text-gray-600"))&&y(e,"class",r)},d(t){t&&h(e)}}}function Le(e){let n;return{c(){n=m("span"),y(n,"class","bg-red-600 absolute -top-1 -right-1 w-2 h-2 rounded-sm")},m(t,e){f(t,n,e)},p:t,d(t){t&&h(n)}}}function Be(t){let e,n,r,s,l,o,c,a,i,u,p;const g=[Te,He],$=[];function x(t,e){return t[0]?0:1}function k(){return t[4](t[5])}r=x(t),s=$[r]=g[r](t);let M=t[5].unread>0&&Ce(t);return{c(){e=m("li"),n=m("a"),s.c(),o=w(),M&&M.c(),c=w(),y(n,"href",l=`/${t[5].id}`),y(n,"class","flex flex-row items-center hover:text-red-500 visited:text-current"),y(e,"class",a=`relative p-1 mb-2 flex flex-row ${t[0]?"justify-center":"justify-between"} ${t[2]===t[5].id?"text-red-500 font-semibold":"text-gray-300"}`)},m(t,s){f(t,e,s),d(e,n),$[r].m(n,null),d(e,o),M&&M.m(e,null),d(e,c),i=!0,u||(p=b(n,"click",v(k)),u=!0)},p(o,u){let d=r;r=x(t=o),r===d?$[r].p(t,u):(K(),Q($[d],1,1,(()=>{$[d]=null})),J(),s=$[r],s?s.p(t,u):(s=$[r]=g[r](t),s.c()),X(s,1),s.m(n,null)),(!i||2&u&&l!==(l=`/${t[5].id}`))&&y(n,"href",l),t[5].unread>0?M?M.p(t,u):(M=Ce(t),M.c(),M.m(e,c)):M&&(M.d(1),M=null),(!i||7&u&&a!==(a=`relative p-1 mb-2 flex flex-row ${t[0]?"justify-center":"justify-between"} ${t[2]===t[5].id?"text-red-500 font-semibold":"text-gray-300"}`))&&y(e,"class",a)},i(t){i||(X(s),i=!0)},o(t){Q(s),i=!1},d(t){t&&h(e),$[r].d(),M&&M.d(),u=!1,p()}}}function Se(e){let n;function r(t,e){return t[0]?je:Ee}let s=r(e),l=s(e);return{c(){l.c(),n=x()},m(t,e){l.m(t,e),f(t,n,e)},p(t,e){s!==(s=r(t))&&(l.d(1),l=s(t),l&&(l.c(),l.m(n.parentNode,n)))},i:t,o:t,d(t){l.d(t),t&&h(n)}}}function Ee(t){let e;return{c(){e=m("p"),e.textContent="...loading",y(e,"class","text-gray-300 text-lg text-center")},m(t,n){f(t,e,n)},d(t){t&&h(e)}}}function je(t){let e;return{c(){e=m("p"),e.textContent="...",y(e,"class","text-gray-300 text-xl text-center")},m(t,n){f(t,e,n)},d(t){t&&h(e)}}}function Ne(t){let e,n,r={ctx:t,current:null,token:null,hasCatch:!0,pending:Se,then:ze,catch:ye,blocks:[,,,]};return Y(Xt.fetch(),r),{c(){e=m("ul"),r.block.c()},m(t,s){f(t,e,s),r.block.m(e,r.anchor=null),r.mount=()=>e,r.anchor=null,n=!0},p(e,[n]){Z(r,t=e,n)},i(t){n||(X(r.block),n=!0)},o(t){for(let t=0;t<3;t+=1){Q(r.blocks[t])}n=!1},d(t){t&&h(e),r.block.d(),r.token=null,r=null}}}function qe(t,e,n){let r,s;c(t,Xt,(t=>n(1,r=t))),c(t,Ft,(t=>n(2,s=t)));let{collapsed:l}=e;function o(t){Qt.set(0),Dt.selectMailbox(t)}return t.$$set=t=>{"collapsed"in t&&n(0,l=t.collapsed)},[l,r,s,o,t=>o(t.id)]}class _e extends ct{constructor(t){super(),ot(this,t,qe,Ne,l,{collapsed:0})}}function De(e){let n,s,l,o,c,a,i,u;return{c(){n=m("div"),s=g("svg"),l=g("path"),o=g("path"),c=w(),a=m("input"),y(l,"d","M0 0h24v24H0z"),y(l,"fill","none"),y(o,"d","M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"),y(s,"xmlns","http://www.w3.org/2000/svg"),y(s,"viewBox","0 0 24 24"),y(s,"class","fill-current w-5 absolute left-2 top-1/2 transform -translate-y-1/2"),y(a,"type","search"),y(a,"class","flex-1 h-full outline-none pl-8 pr-1 py-1 bg-gray-600 text-sm border rounded border-gray-500 hover:border-gray-400 focus:border-gray-400"),y(a,"placeholder","Search threads"),y(n,"class","relative text-gray-300 flex flex-1 sm:flex-none sm:w-96 mb-2 sm:mb-0")},m(t,r){f(t,n,r),d(n,s),d(s,l),d(s,o),d(n,c),d(n,a),M(a,e[1]),e[8](a),i||(u=[b(a,"keypress",e[2]),b(a,"input",e[7]),b(a,"focus",e[5]),b(a,"blur",e[6])],i=!0)},p(t,[e]){2&e&&M(a,t[1])},i:t,o:t,d(t){t&&h(n),e[8](null),i=!1,r(u)}}}function Fe(t,e,n){let r,s,l;return c(t,It,(t=>n(4,s=t))),t.$$.update=()=>{16&t.$$.dirty&&n(1,r=s)},[l,r,function({charCode:t}){13===t&&Dt.search(r)},function(){l.focus()},s,function(e){B(t,e)},function(e){B(t,e)},function(){r=this.value,n(1,r),n(4,s)},function(t){E[t?"unshift":"push"]((()=>{l=t,n(0,l)}))}]}class Ae extends ct{constructor(t){super(),ot(this,t,Fe,De,l,{focus:3})}get focus(){return this.$$.ctx[3]}}const{subscribe:Ie,set:Oe,update:Re}=zt(null);function Pe(t,e){if(!t)return null;for(const[n,r]of t){if(n.id===e)return n;const t=Pe(r,e);if(t)return t}return null}function Ue(t,e,n=[],r=[]){if(!t)return null;for(const[s,l]of t){if(s.id!=e&&n.every((t=>s.tags.includes(t)))&&r.every((t=>!s.tags.includes(t))))return s;const t=Ue(l,e,n,r);if(t)return t}return null}function We(t,e,n=[],r=[]){const s=Ge(t,e,n,r).sort(((t,e)=>e.timestamp-t.timestamp));return s.length>0?s[0]:null}function Ge(t,e,n,r,s=[]){if(!t)return s;for(const[l,o]of t)l.id!=e&&n.every((t=>l.tags.includes(t)))&&r.every((t=>!l.tags.includes(t)))&&s.push(l),Ge(o,e,n,r,s);return s}function Ke(t,e){for(const[n,r]of e)n.tags.forEach((e=>t.add(e))),Ke(t,r);return t}var Je={subscribe:Ie,fetch:async t=>{if(!t)return Oe(null),null;const e=await Ot.default.thread(t);return Oe(e),e},updateTags:function(t,e){const n=new Set;return Re((r=>{const s=Pe(r,t);return s&&(s.tags=e),Ke(n,r),r})),[...n]}};async function Xe(t,e,n){if(!e||!t)return[];const r=await Ot.default.updateTags(`id:${e}`,n),s=Je.updateTags(e,r);return ne.setTags(t,s),Xt.updateUnreadCounters(),r}async function Qe(t,e){if(!t)return[];const n=await Ot.default.updateTags(`thread:${t}`,e);return ne.setTags(t,n),await Xt.updateUnreadCounters(),n}async function Ye(t,e){return e.tags.includes("unread")?await Xe(t,e.id,["-unread"]):[]}function Ze(t,e,n){const r=t.find((({id:t})=>t===e)).tags,s=t.find((({id:t})=>t===n)).tags,l=[];return t.forEach((({tags:t})=>t.forEach((t=>!s.includes(t)&&l.push(`-${t}`))))),s.forEach((t=>l.push(`+${t}`))),{changes:l,fromTags:r,toTags:s}}const{subscribe:tn,update:en}=zt([]);var nn={subscribe:tn,toggle:function({thread:t}){en((e=>e.includes(t)?e.filter((e=>e!==t)):[...e,t]))}};function rn(t){let e,n,r,s,l,o,c,i;const p=t[8].default,g=a(p,t,t[7],null);return{c(){e=m("button"),g&&g.c(),n=w(),r=m("span"),s=$(t[0]),e.disabled=t[2],y(e,"class","w-9 p-2 rounded hover:border-gray-500 bg-white text-gray-700 active:bg-gray-300 focus:outline-none border"),y(r,"class",l=`absolute -top-full z-50 transform ${t[4]} -translate-y-2 p-2 whitespace-nowrap rounded bg-gray-800 text-white ${t[5]?"":"hidden"}`)},m(l,a){f(l,e,a),g&&g.m(e,null),f(l,n,a),f(l,r,a),d(r,s),o=!0,c||(i=b(e,"click",t[10]),c=!0)},p(t,n){g&&g.p&&(!o||128&n)&&u(g,p,t,t[7],n,null,null),(!o||4&n)&&(e.disabled=t[2]),(!o||1&n)&&k(s,t[0]),(!o||48&n&&l!==(l=`absolute -top-full z-50 transform ${t[4]} -translate-y-2 p-2 whitespace-nowrap rounded bg-gray-800 text-white ${t[5]?"":"hidden"}`))&&y(r,"class",l)},i(t){o||(X(g,t),o=!0)},o(t){Q(g,t),o=!1},d(t){t&&h(e),g&&g.d(t),t&&h(n),t&&h(r),c=!1,i()}}}function sn(t){let e,n,r,s,l,o,c,i;const p=t[8].default,g=a(p,t,t[7],null);return{c(){e=m("button"),g&&g.c(),n=w(),r=m("span"),s=$(t[0]),e.disabled=t[2],y(e,"class","h-full p-2 rounded text-gray-300 focus:outline-none hover:text-gray-100 active:text-gray-100 disabled:opacity-25"),y(r,"class",l=`absolute -bottom-full z-50 transform ${t[4]} translate-y-2 p-2 whitespace-nowrap rounded bg-gray-800 text-white ${t[5]?"":"hidden"}`)},m(l,a){f(l,e,a),g&&g.m(e,null),f(l,n,a),f(l,r,a),d(r,s),o=!0,c||(i=b(e,"click",t[9]),c=!0)},p(t,n){g&&g.p&&(!o||128&n)&&u(g,p,t,t[7],n,null,null),(!o||4&n)&&(e.disabled=t[2]),(!o||1&n)&&k(s,t[0]),(!o||48&n&&l!==(l=`absolute -bottom-full z-50 transform ${t[4]} translate-y-2 p-2 whitespace-nowrap rounded bg-gray-800 text-white ${t[5]?"":"hidden"}`))&&y(r,"class",l)},i(t){o||(X(g,t),o=!0)},o(t){Q(g,t),o=!1},d(t){t&&h(e),g&&g.d(t),t&&h(n),t&&h(r),c=!1,i()}}}function ln(t){let e,n,s,l,o,c,a;const i=[sn,rn],u=[];function d(t,e){return"toolbar"===t[1]?0:1}return n=d(t),s=u[n]=i[n](t),{c(){e=m("div"),s.c(),y(e,"class",l="h-full relative "+t[3])},m(r,s){f(r,e,s),u[n].m(e,null),o=!0,c||(a=[b(e,"mouseover",t[11]),b(e,"mouseout",t[12])],c=!0)},p(t,[r]){let c=n;n=d(t),n===c?u[n].p(t,r):(K(),Q(u[c],1,1,(()=>{u[c]=null})),J(),s=u[n],s?s.p(t,r):(s=u[n]=i[n](t),s.c()),X(s,1),s.m(e,null)),(!o||8&r&&l!==(l="h-full relative "+t[3]))&&y(e,"class",l)},i(t){o||(X(s),o=!0)},o(t){Q(s),o=!1},d(t){t&&h(e),u[n].d(),c=!1,r(a)}}}function on(t,e,n){let{$$slots:r={},$$scope:s}=e,{tooltip:l}=e,{tooltipPosition:o="center"}=e,{variant:c="message"}=e,{disabled:a=!1}=e,{class:i=""}=e,u="-translate-x-1/2",d=!1;return t.$$set=t=>{"tooltip"in t&&n(0,l=t.tooltip),"tooltipPosition"in t&&n(6,o=t.tooltipPosition),"variant"in t&&n(1,c=t.variant),"disabled"in t&&n(2,a=t.disabled),"class"in t&&n(3,i=t.class),"$$scope"in t&&n(7,s=t.$$scope)},t.$$.update=()=>{64&t.$$.dirty&&n(4,u="left"===o?"left-0":"right"===o?"right-0":"left-4 -translate-x-1/2")},[l,c,a,i,u,d,o,s,r,function(e){B(t,e)},function(e){B(t,e)},()=>n(5,d=!0),()=>n(5,d=!1)]}class cn extends ct{constructor(t){super(),ot(this,t,on,ln,l,{tooltip:0,tooltipPosition:6,variant:1,disabled:2,class:3})}}function an(t){let e,n,r,s,l,o,c,a,i,u;return r=new me({props:{id:t[0],iconType:"tag"}}),{c(){e=m("div"),n=m("span"),rt(r.$$.fragment),s=w(),l=m("span"),o=$(t[0]),y(n,"class","w-4 mr-1 flex-shrink-0"),y(e,"class",c="inline-flex items-center text-gray-600 text-sm max-w-xs truncate "+t[1]+" "+t[2])},m(c,h){f(c,e,h),d(e,n),st(r,n,null),d(e,s),d(e,l),d(l,o),a=!0,i||(u=b(e,"click",t[4]),i=!0)},p(t,[n]){const s={};1&n&&(s.id=t[0]),r.$set(s),(!a||1&n)&&k(o,t[0]),(!a||6&n&&c!==(c="inline-flex items-center text-gray-600 text-sm max-w-xs truncate "+t[1]+" "+t[2]))&&y(e,"class",c)},i(t){a||(X(r.$$.fragment,t),a=!0)},o(t){Q(r.$$.fragment,t),a=!1},d(t){t&&h(e),lt(r),i=!1,u()}}}function un(t,e,n){let r,{tag:s}=e,{viewOnly:l=!0}=e,{class:o=""}=e;return t.$$set=t=>{"tag"in t&&n(0,s=t.tag),"viewOnly"in t&&n(3,l=t.viewOnly),"class"in t&&n(1,o=t.class)},t.$$.update=()=>{8&t.$$.dirty&&n(2,r=l?"":"cursor-pointer hover:text-red-500")},[s,o,r,l,function(e){B(t,e)}]}class dn extends ct{constructor(t){super(),ot(this,t,un,an,l,{tag:0,viewOnly:3,class:1})}}function fn(t,e,n){const r=t.slice();return r[12]=e[n],r}function hn(t){let e,n;return e=new dn({props:{class:"mb-2 mr-2",viewOnly:!1,tag:t[12]}}),e.$on("click",(function(){return t[11](t[12])})),{c(){rt(e.$$.fragment)},m(t,r){st(e,t,r),n=!0},p(n,r){t=n;const s={};8&r&&(s.tag=t[12]),e.$set(s)},i(t){n||(X(e.$$.fragment,t),n=!0)},o(t){Q(e.$$.fragment,t),n=!1},d(t){lt(e,t)}}}function pn(t){let e,n;return e=new dn({props:{class:"mb-2 mr-2 text-red-600",viewOnly:!1,tag:t[12]}}),e.$on("click",(function(){return t[10](t[12])})),{c(){rt(e.$$.fragment)},m(t,r){st(e,t,r),n=!0},p(n,r){t=n;const s={};8&r&&(s.tag=t[12]),e.$set(s)},i(t){n||(X(e.$$.fragment,t),n=!0)},o(t){Q(e.$$.fragment,t),n=!1},d(t){lt(e,t)}}}function mn(t){let e,n,r,s,l;const o=[pn,hn],c=[];function a(t,n){return 9&n&&(e=!!t[0].includes(t[12])),e?0:1}return n=a(t,-1),r=c[n]=o[n](t),{c(){r.c(),s=x()},m(t,e){c[n].m(t,e),f(t,s,e),l=!0},p(t,e){let l=n;n=a(t,e),n===l?c[n].p(t,e):(K(),Q(c[l],1,1,(()=>{c[l]=null})),J(),r=c[n],r?r.p(t,e):(r=c[n]=o[n](t),r.c()),X(r,1),r.m(s.parentNode,s))},i(t){l||(X(r),l=!0)},o(t){Q(r),l=!1},d(t){c[n].d(t),t&&h(s)}}}function gn(t){let e,n,s,l,o,c,a,i,u,g,$,x,v=t[3],k=[];for(let e=0;e<v.length;e+=1)k[e]=mn(fn(t,v,e));const z=t=>Q(k[t],1,1,(()=>{k[t]=null}));return{c(){e=m("div"),n=m("button"),n.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="w-full fill-current"><path d="M0 0h24v24H0z" fill="none"></path><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg>',s=w(),l=m("h3"),l.textContent="Labels",o=w(),c=m("input"),a=w(),i=m("div");for(let t=0;t<k.length;t+=1)k[t].c();y(n,"class","absolute w-5 top-2 right-2 text-gray-500 order-0 hover:text-gray-800 active:text-gray-500 focus:outline-none"),y(l,"class","mb-1 font-semibold text-gray-700"),y(c,"type","text"),y(c,"placeholder","Type in a new tag"),y(c,"class","w-full outline-none mb-4 px-3 py-1 bg-white text-sm text-gray-700 rounded border border-gray-400 hover:border-gray-500 focus:border-red-300"),y(i,"class","flex flex-row flex-wrap"),y(e,"class",u=t[1]+" w-72 p-4 bg-white border-2 border-gray-600 rounded shadow")},m(r,u){f(r,e,u),d(e,n),d(e,s),d(e,l),d(e,o),d(e,c),M(c,t[2]),d(e,a),d(e,i);for(let t=0;t<k.length;t+=1)k[t].m(i,null);g=!0,$||(x=[b(n,"click",t[8]),b(c,"keypress",t[5]),b(c,"input",t[9])],$=!0)},p(t,[n]){if(4&n&&c.value!==t[2]&&M(c,t[2]),25&n){let e;for(v=t[3],e=0;e<v.length;e+=1){const r=fn(t,v,e);k[e]?(k[e].p(r,n),X(k[e],1)):(k[e]=mn(r),k[e].c(),X(k[e],1),k[e].m(i,null))}for(K(),e=v.length;e<k.length;e+=1)z(e);J()}(!g||2&n&&u!==(u=t[1]+" w-72 p-4 bg-white border-2 border-gray-600 rounded shadow"))&&y(e,"class",u)},i(t){if(!g){for(let t=0;t<v.length;t+=1)X(k[t]);g=!0}},o(t){k=k.filter(Boolean);for(let t=0;t<k.length;t+=1)Q(k[t]);g=!1},d(t){t&&h(e),p(k,t),$=!1,r(x)}}}function $n(t,e,n){let r,s,l;c(t,Xt,(t=>n(6,s=t))),c(t,Wt,(t=>n(7,l=t)));let{tags:o=[]}=e,{class:a=""}=e;const i=L();let u="";return t.$$set=t=>{"tags"in t&&n(0,o=t.tags),"class"in t&&n(1,a=t.class)},t.$$.update=()=>{193&t.$$.dirty&&n(3,r=s.reduce(((t,{tags:e})=>t.concat(e)),[]).concat(l).concat(o).reduce(((t,e)=>-1===t.indexOf(e)?t.concat([e]):t),[]))},[o,a,u,r,i,function({charCode:t}){13===t&&(i("add",u),n(2,u=""))},s,l,()=>i("close"),function(){u=this.value,n(2,u)},t=>i("remove",t),t=>i("add",t)]}class wn extends ct{constructor(t){super(),ot(this,t,$n,gn,l,{tags:0,class:1})}}function xn(t){let e,n,r,s,l;return{c(){e=g("svg"),n=g("g"),r=g("rect"),s=g("g"),l=g("path"),y(r,"fill","none"),y(r,"height","24"),y(r,"width","24"),y(l,"d","M20,2H4C3,2,2,2.9,2,4v3.01C2,7.73,2.43,8.35,3,8.7V20c0,1.1,1.1,2,2,2h14c0.9,0,2-0.9,2-2V8.7c0.57-0.35,1-0.97,1-1.69V4 C22,2.9,21,2,20,2z M15,14H9v-2h6V14z M20,7H4V4h16V7z"),y(e,"xmlns","http://www.w3.org/2000/svg"),y(e,"enable-background","new 0 0 24 24"),y(e,"viewBox","0 0 24 24"),y(e,"class","fill-current h-full")},m(t,o){f(t,e,o),d(e,n),d(n,r),d(e,s),d(s,l)},d(t){t&&h(e)}}}function bn(t){let e,n,r;return{c(){e=g("svg"),n=g("path"),r=g("path"),y(n,"d","M0 0h24v24H0z"),y(n,"fill","none"),y(r,"d","M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.42 0-8-3.58-8-8 0-1.85.63-3.55 1.69-4.9L16.9 18.31C15.55 19.37 13.85 20 12 20zm6.31-3.1L7.1 5.69C8.45 4.63 10.15 4 12 4c4.42 0 8 3.58 8 8 0 1.85-.63 3.55-1.69 4.9z"),y(e,"xmlns","http://www.w3.org/2000/svg"),y(e,"viewBox","0 0 24 24"),y(e,"class","h-full fill-current")},m(t,s){f(t,e,s),d(e,n),d(e,r)},d(t){t&&h(e)}}}function vn(t){let e,n,r;return{c(){e=g("svg"),n=g("path"),r=g("path"),y(n,"d","M0 0h24v24H0z"),y(n,"fill","none"),y(r,"d","M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"),y(e,"xmlns","http://www.w3.org/2000/svg"),y(e,"viewBox","0 0 24 24"),y(e,"class","h-full fill-current")},m(t,s){f(t,e,s),d(e,n),d(e,r)},d(t){t&&h(e)}}}function yn(t){let e,n,r;return{c(){e=g("svg"),n=g("path"),r=g("path"),y(n,"d","M0 0h24v24H0z"),y(n,"fill","none"),y(r,"d","M21.41 11.58l-9-9C12.05 2.22 11.55 2 11 2H4c-1.1 0-2 .9-2 2v7c0 .55.22 1.05.59 1.42l9 9c.36.36.86.58 1.41.58.55 0 1.05-.22 1.41-.59l7-7c.37-.36.59-.86.59-1.41 0-.55-.23-1.06-.59-1.42zM5.5 7C4.67 7 4 6.33 4 5.5S4.67 4 5.5 4 7 4.67 7 5.5 6.33 7 5.5 7z"),y(e,"xmlns","http://www.w3.org/2000/svg"),y(e,"viewBox","0 0 24 24"),y(e,"class","h-full fill-current")},m(t,s){f(t,e,s),d(e,n),d(e,r)},d(t){t&&h(e)}}}function kn(t){let e,n;return e=new wn({props:{class:"absolute left-1 top-8 z-5",tags:t[1]}}),e.$on("add",t[4]),e.$on("remove",t[5]),e.$on("close",t[12]),{c(){rt(e.$$.fragment)},m(t,r){st(e,t,r),n=!0},p(t,n){const r={};2&n&&(r.tags=t[1]),e.$set(r)},i(t){n||(X(e.$$.fragment,t),n=!0)},o(t){Q(e.$$.fragment,t),n=!1},d(t){lt(e,t)}}}function Mn(t){let e,n,r,s,l,o,c,a,i,u;n=new cn({props:{variant:"toolbar",tooltip:"Move to archive",class:"mr-1",disabled:t[0],$$slots:{default:[xn]},$$scope:{ctx:t}}}),n.$on("click",t[8]),s=new cn({props:{variant:"toolbar",tooltip:"Move to spam",class:"mr-1",disabled:t[0],$$slots:{default:[bn]},$$scope:{ctx:t}}}),s.$on("click",t[9]),o=new cn({props:{variant:"toolbar",tooltip:"Move to trash",class:"mr-1",disabled:t[0],$$slots:{default:[vn]},$$scope:{ctx:t}}}),o.$on("click",t[10]),a=new cn({props:{variant:"toolbar",tooltip:"Tag",disabled:t[0],$$slots:{default:[yn]},$$scope:{ctx:t}}}),a.$on("click",t[11]);let p=t[2]&&kn(t);return{c(){e=m("div"),rt(n.$$.fragment),r=w(),rt(s.$$.fragment),l=w(),rt(o.$$.fragment),c=w(),rt(a.$$.fragment),i=w(),p&&p.c(),y(e,"class","h-8 ml-0 mr-4 sm:ml-4 flex flex-row relative")},m(t,h){f(t,e,h),st(n,e,null),d(e,r),st(s,e,null),d(e,l),st(o,e,null),d(e,c),st(a,e,null),d(e,i),p&&p.m(e,null),u=!0},p(t,[r]){const l={};1&r&&(l.disabled=t[0]),65536&r&&(l.$$scope={dirty:r,ctx:t}),n.$set(l);const c={};1&r&&(c.disabled=t[0]),65536&r&&(c.$$scope={dirty:r,ctx:t}),s.$set(c);const i={};1&r&&(i.disabled=t[0]),65536&r&&(i.$$scope={dirty:r,ctx:t}),o.$set(i);const u={};1&r&&(u.disabled=t[0]),65536&r&&(u.$$scope={dirty:r,ctx:t}),a.$set(u),t[2]?p?(p.p(t,r),4&r&&X(p,1)):(p=kn(t),p.c(),X(p,1),p.m(e,null)):p&&(K(),Q(p,1,1,(()=>{p=null})),J())},i(t){u||(X(n.$$.fragment,t),X(s.$$.fragment,t),X(o.$$.fragment,t),X(a.$$.fragment,t),X(p),u=!0)},o(t){Q(n.$$.fragment,t),Q(s.$$.fragment,t),Q(o.$$.fragment,t),Q(a.$$.fragment,t),Q(p),u=!1},d(t){t&&h(e),lt(n),lt(s),lt(o),lt(a),p&&p.d()}}}function zn(t,e,n){let r,s,l,o,a,i;c(t,ne,(t=>n(6,s=t))),c(t,nn,(t=>n(7,l=t))),c(t,Xt,(t=>n(13,o=t))),c(t,Ft,(t=>n(14,a=t))),c(t,At,(t=>n(15,i=t)));let{disabled:u=!1}=e,d=!1;async function f(t){for(const e of l){const{changes:n}=Ze(o,a,t);i===e&&Dt.deselectThread(),ne.remove(e),await Qe(e,[...n,"-unread"]),nn.toggle({thread:e})}}return t.$$set=t=>{"disabled"in t&&n(0,u=t.disabled)},t.$$.update=()=>{192&t.$$.dirty&&n(1,r=[...s.filter((({thread:t})=>l.includes(t))).reduce(((t,{tags:e})=>(e.forEach((e=>t.add(e))),t)),new Set)].sort(((t,e)=>t.localeCompare(e))))},[u,r,d,f,async function({detail:t}){for(const e of l)await Qe(e,[`+${t}`])},async function({detail:t}){for(const e of l)await Qe(e,[`-${t}`])},s,l,()=>f("archive"),()=>f("spam"),()=>f("trash"),()=>n(2,d=!0),()=>n(2,d=!1)]}class Hn extends ct{constructor(t){super(),ot(this,t,zn,Mn,l,{disabled:0})}}function Tn(e){let n,s,l,o,c,a,i,u,p,x,v,M,z,H,T,C,V,L=e[0]+1+"";return{c(){n=m("div"),s=m("button"),l=g("svg"),o=g("path"),c=g("path"),i=w(),u=m("span"),p=$(L),x=w(),v=m("button"),M=g("svg"),z=g("path"),H=g("path"),y(o,"d","M0 0h24v24H0z"),y(o,"fill","none"),y(c,"d","M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"),y(l,"xmlns","http://www.w3.org/2000/svg"),y(l,"viewBox","0 0 24 24"),y(l,"class","fill-current w-7"),s.disabled=a=0==e[0],y(s,"class","border-0 rounded hover:bg-gray-700 active:bg-gray-800 focus:outline-none disabled:opacity-50 disabled:bg-transparent"),y(u,"class","font-semibold px-3"),y(z,"d","M0 0h24v24H0z"),y(z,"fill","none"),y(H,"d","M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"),y(M,"xmlns","http://www.w3.org/2000/svg"),y(M,"viewBox","0 0 24 24"),y(M,"class","fill-current w-7"),v.disabled=T=!e[1],y(v,"class","border-0 rounded hover:bg-gray-700 active:bg-gray-800 focus:outline-none disabled:opacity-50 disabled:bg-transparent"),y(n,"class","flex flex-row items-center ml-auto text-gray-300")},m(t,r){f(t,n,r),d(n,s),d(s,l),d(l,o),d(l,c),d(n,i),d(n,u),d(u,p),d(n,x),d(n,v),d(v,M),d(M,z),d(M,H),C||(V=[b(s,"click",e[2]),b(v,"click",e[3])],C=!0)},p(t,[e]){1&e&&a!==(a=0==t[0])&&(s.disabled=a),1&e&&L!==(L=t[0]+1+"")&&k(p,L),2&e&&T!==(T=!t[1])&&(v.disabled=T)},i:t,o:t,d(t){t&&h(n),C=!1,r(V)}}}function Cn(t,e,n){let r,s;c(t,Qt,(t=>n(0,r=t))),c(t,Yt,(t=>n(1,s=t)));return[r,s,()=>Qt.update((t=>t-1)),()=>Qt.update((t=>t+1))]}class Vn extends ct{constructor(t){super(),ot(this,t,Cn,Tn,l,{})}}function Ln(t){let e,n,r;return{c(){e=g("svg"),n=g("path"),r=g("path"),y(n,"d","M0 0h24v24H0z"),y(n,"fill","none"),y(r,"d","M9 16.2L4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4L9 16.2z"),y(e,"xmlns","http://www.w3.org/2000/svg"),y(e,"viewBox","0 0 24 24"),y(e,"class","fill-current w-full")},m(t,s){f(t,e,s),d(e,n),d(e,r)},d(t){t&&h(e)}}}function Bn(e){let n,r,s,l,o=e[1]&&Ln();return{c(){n=m("div"),o&&o.c(),y(n,"class",r="flex-shrink-0 w-5 h-5 rounded border-2 text-gray-500 "+e[2]+" "+e[0])},m(t,r){var c;f(t,n,r),o&&o.m(n,null),s||(l=b(n,"click",(c=v(e[3]),function(t){return t.stopPropagation(),c.call(this,t)})),s=!0)},p(t,[e]){t[1]?o||(o=Ln(),o.c(),o.m(n,null)):o&&(o.d(1),o=null),5&e&&r!==(r="flex-shrink-0 w-5 h-5 rounded border-2 text-gray-500 "+t[2]+" "+t[0])&&y(n,"class",r)},i:t,o:t,d(t){t&&h(n),o&&o.d(),s=!1,l()}}}function Sn(t,e,n){let r,{class:s=""}=e,{checked:l=!1}=e;return t.$$set=t=>{"class"in t&&n(0,s=t.class),"checked"in t&&n(1,l=t.checked)},t.$$.update=()=>{2&t.$$.dirty&&n(2,r=l?"border-gray-500":"border-gray-300")},[s,l,r,function(e){B(t,e)}]}class En extends ct{constructor(t){super(),ot(this,t,Sn,Bn,l,{class:0,checked:1})}}function jn(t,e,n){const r=t.slice();return r[8]=e[n],r}function Nn(t,e,n){const r=t.slice();return r[11]=e[n],r}function qn(t){let e,n;return e=new dn({props:{class:"mr-2",tag:t[11]}}),{c(){rt(e.$$.fragment)},m(t,r){st(e,t,r),n=!0},p(t,n){const r={};1&n&&(r.tag=t[11]),e.$set(r)},i(t){n||(X(e.$$.fragment,t),n=!0)},o(t){Q(e.$$.fragment,t),n=!1},d(t){lt(e,t)}}}function _n(t){let e,n,r=!In(t[11]),s=r&&qn(t);return{c(){s&&s.c(),e=x()},m(t,r){s&&s.m(t,r),f(t,e,r),n=!0},p(t,n){1&n&&(r=!In(t[11])),r?s?(s.p(t,n),1&n&&X(s,1)):(s=qn(t),s.c(),X(s,1),s.m(e.parentNode,e)):s&&(K(),Q(s,1,1,(()=>{s=null})),J())},i(t){n||(X(s),n=!0)},o(t){Q(s),n=!1},d(t){s&&s.d(t),t&&h(e)}}}function Dn(t,e){let n,r,s,l,o,c,a,i,u,g,x,M,z,H,T,C,V,L,B,S,E,j=e[8].date_relative+"",N=e[8].authors+"",q=e[8].subject+"";r=new En({props:{class:"ml-3",checked:e[3].includes(e[8].thread)}}),r.$on("click",(function(){return e[6](e[8])}));let _=e[8].tags,D=[];for(let t=0;t<_.length;t+=1)D[t]=_n(Nn(e,_,t));const F=t=>Q(D[t],1,1,(()=>{D[t]=null}));function A(){return e[7](e[8])}return{key:t,first:null,c(){n=m("a"),rt(r.$$.fragment),s=w(),l=m("span"),o=$(j),c=w(),a=m("span"),i=$(N),u=w(),g=m("span"),x=$(q),z=w(),H=m("div");for(let t=0;t<D.length;t+=1)D[t].c();T=w(),y(l,"class","px-3 w-22 sm:w-28 truncate text-xs sm:text-base"),y(a,"class","pr-3 flex-1 sm:flex-none sm:w-40 truncate text-xs sm:text-base"),y(g,"class",M="sm:truncate w-full sm:flex-1 px-3 pt-2 sm:pt-0 "+(e[8].tags.includes("unread")?"text-red-500":"text-gray-800")),y(H,"class","hidden sm:inline-flex px-3"),y(n,"href",C=`/${e[1]}/${e[8].thread}`),y(n,"data-thread",V=e[8].thread),y(n,"class",L=`py-2 flex flex-wrap sm:flex-nowrap sm:flex-row items-center border-b hover:bg-gray-200 ${An(e[8])} ${e[2]===e[8].thread?"bg-red-100 font-semibold":""}`),this.first=n},m(t,e){f(t,n,e),st(r,n,null),d(n,s),d(n,l),d(l,o),d(n,c),d(n,a),d(a,i),d(n,u),d(n,g),d(g,x),d(n,z),d(n,H);for(let t=0;t<D.length;t+=1)D[t].m(H,null);d(n,T),B=!0,S||(E=b(n,"click",v(A)),S=!0)},p(t,s){e=t;const l={};if(9&s&&(l.checked=e[3].includes(e[8].thread)),r.$set(l),(!B||1&s)&&j!==(j=e[8].date_relative+"")&&k(o,j),(!B||1&s)&&N!==(N=e[8].authors+"")&&k(i,N),(!B||1&s)&&q!==(q=e[8].subject+"")&&k(x,q),(!B||1&s&&M!==(M="sm:truncate w-full sm:flex-1 px-3 pt-2 sm:pt-0 "+(e[8].tags.includes("unread")?"text-red-500":"text-gray-800")))&&y(g,"class",M),1&s){let t;for(_=e[8].tags,t=0;t<_.length;t+=1){const n=Nn(e,_,t);D[t]?(D[t].p(n,s),X(D[t],1)):(D[t]=_n(n),D[t].c(),X(D[t],1),D[t].m(H,null))}for(K(),t=_.length;t<D.length;t+=1)F(t);J()}(!B||3&s&&C!==(C=`/${e[1]}/${e[8].thread}`))&&y(n,"href",C),(!B||1&s&&V!==(V=e[8].thread))&&y(n,"data-thread",V),(!B||5&s&&L!==(L=`py-2 flex flex-wrap sm:flex-nowrap sm:flex-row items-center border-b hover:bg-gray-200 ${An(e[8])} ${e[2]===e[8].thread?"bg-red-100 font-semibold":""}`))&&y(n,"class",L)},i(t){if(!B){X(r.$$.fragment,t);for(let t=0;t<_.length;t+=1)X(D[t]);B=!0}},o(t){Q(r.$$.fragment,t),D=D.filter(Boolean);for(let t=0;t<D.length;t+=1)Q(D[t]);B=!1},d(t){t&&h(n),lt(r),p(D,t),S=!1,E()}}}function Fn(t){let e,n,r=[],s=new Map,l=t[0];const o=t=>t[8].thread;for(let e=0;e<l.length;e+=1){let n=jn(t,l,e),c=o(n);s.set(c,r[e]=Dn(c,n))}return{c(){for(let t=0;t<r.length;t+=1)r[t].c();e=x()},m(t,s){for(let e=0;e<r.length;e+=1)r[e].m(t,s);f(t,e,s),n=!0},p(t,[n]){15&n&&(l=t[0],K(),r=et(r,n,o,1,t,l,s,e.parentNode,tt,Dn,e,jn),J())},i(t){if(!n){for(let t=0;t<l.length;t+=1)X(r[t]);n=!0}},o(t){for(let t=0;t<r.length;t+=1)Q(r[t]);n=!1},d(t){for(let e=0;e<r.length;e+=1)r[e].d(t);t&&h(e)}}}function An({tags:t}){return t.includes("unread")?"bg-gray-50 text-red-500 visited:text-red-500":"bg-gray-100 text-gray-600 visited:text-gray-600"}function In(t){return["inbox","sent","trash","archive","personal","draft","unread"].includes(t)}function On(t,e,n){let r,s,l,o,a;c(t,Qt,(t=>n(5,r=t))),c(t,ne,(t=>n(0,s=t))),c(t,Ft,(t=>n(1,l=t))),c(t,At,(t=>n(2,o=t))),c(t,nn,(t=>n(3,a=t)));let{mailbox:i}=e;return t.$$set=t=>{"mailbox"in t&&n(4,i=t.mailbox)},t.$$.update=()=>{48&t.$$.dirty&&ne.fetch(i,r)},[s,l,o,a,i,r,t=>nn.toggle(t),t=>Dt.selectThread(l,t.thread)]}class Rn extends ct{constructor(t){super(),ot(this,t,On,Fn,l,{mailbox:4})}}function Pn(t,e=[]){return t["content-type"].startsWith("multipart")?t.content.forEach((t=>Pn(t,e))):"text/plain"===t["content-type"]&&e.push(t.content),e}function Un(t,e=[]){return t["content-type"].startsWith("multipart")?t.content.forEach((t=>Un(t,e))):"attachment"===t["content-disposition"]&&e.push(t),e}function Wn(t){return Pn(t).map((t=>t.replace(/^/gm,"> "))).join("")}function Gn(t,e={text:[],attachments:[],html:[]}){if(t["content-type"].startsWith("multipart"))t.content.forEach((t=>Gn(t,e)));else if("text/plain"===t["content-type"]){const n=Kn(t.content);e.text.push(...n)}else"text/html"===t["content-type"]?e.html.push(t):"attachment"===t["content-disposition"]&&e.attachments.push(t);return e}function Kn(t){const e=[];let n=null;return t.split("\n").forEach((t=>{const r=function(t){return t.startsWith("> >")?"deepquote":t.startsWith(">")?"quote":"text"}(t);n?.type!==r&&(n&&e.push(n),n={type:r,content:""}),n.content+="quote"===r||"deepquote"===r?`${t.replace(/^>\s?/,"")}\n`:`${t}\n`})),e.push(n),e}function Jn(t,e){const n=[];let r=0;return t.replaceAll(/http[s]?:\/\/\S*\b[=/]?/g,((e,s)=>{n.push(t.substring(r,s));try{n.push(new URL(e))}catch(t){n.push(e),console.error(`failed to linkify: ${t.message}`)}r=s+e.length})),n.push(t.substring(r,t.length)),n}function Xn(t){let e;return{c(){e=$(t[0])},m(t,n){f(t,e,n)},p(t,n){1&n&&k(e,t[0])},d(t){t&&h(e)}}}function Qn(e){let n;return{c(){n=m("span"),n.textContent="...",y(n,"class","text-red-500 font-semibold")},m(t,e){f(t,n,e)},p:t,d(t){t&&h(n)}}}function Yn(e){let n,r,s,l;function o(t,e){return t[2]?Qn:Xn}let c=o(e),a=c(e);return{c(){n=m("a"),a.c(),y(n,"href","#fold"),y(n,"style",r=`width: ${e[1]}ch;`),y(n,"class","block whitespace-pre-line break-words text-gray-500 border-l-8 border-gray-400 pl-3")},m(t,r){f(t,n,r),a.m(n,null),s||(l=b(n,"click",v(e[3])),s=!0)},p(t,[e]){c===(c=o(t))&&a?a.p(t,e):(a.d(1),a=c(t),a&&(a.c(),a.m(n,null))),2&e&&r!==(r=`width: ${t[1]}ch;`)&&y(n,"style",r)},i:t,o:t,d(t){t&&h(n),a.d(),s=!1,l()}}}function Zn(t,e,n){let{content:r}=e,{wrap:s=80}=e,l=!0;return t.$$set=t=>{"content"in t&&n(0,r=t.content),"wrap"in t&&n(1,s=t.wrap)},[r,s,l,()=>n(2,l=!l)]}class tr extends ct{constructor(t){super(),ot(this,t,Zn,Yn,l,{content:0,wrap:1})}}function er(t,e,n){const r=t.slice();return r[4]=e[n],r}function nr(t,e,n){const r=t.slice();return r[7]=e[n],r}function rr(t,e,n){const r=t.slice();return r[7]=e[n],r}function sr(t,e,n){const r=t.slice();return r[7]=e[n],r}function lr(t,e,n){const r=t.slice();return r[12]=e[n],r}function or(e){let n,r,s,l=e[2].html.length>0&&ar(e);return{c(){n=m("p"),n.textContent="Email has no plaintext content. Presenting converted html content.",r=w(),s=m("div"),l&&l.c(),y(n,"class","text-lg mb-4")},m(t,e){f(t,n,e),f(t,r,e),f(t,s,e),l&&l.m(s,null)},p(t,e){t[2].html.length>0?l?l.p(t,e):(l=ar(t),l.c(),l.m(s,null)):l&&(l.d(1),l=null)},i:t,o:t,d(t){t&&h(n),t&&h(r),t&&h(s),l&&l.d()}}}function cr(t){let e,n,r=t[2].text,s=[];for(let e=0;e<r.length;e+=1)s[e]=xr(sr(t,r,e));const l=t=>Q(s[t],1,1,(()=>{s[t]=null}));return{c(){for(let t=0;t<s.length;t+=1)s[t].c();e=x()},m(t,r){for(let e=0;e<s.length;e+=1)s[e].m(t,r);f(t,e,r),n=!0},p(t,n){if(6&n){let o;for(r=t[2].text,o=0;o<r.length;o+=1){const l=sr(t,r,o);s[o]?(s[o].p(l,n),X(s[o],1)):(s[o]=xr(l),s[o].c(),X(s[o],1),s[o].m(e.parentNode,e))}for(K(),o=r.length;o<s.length;o+=1)l(o);J()}},i(t){if(!n){for(let t=0;t<r.length;t+=1)X(s[t]);n=!0}},o(t){s=s.filter(Boolean);for(let t=0;t<s.length;t+=1)Q(s[t]);n=!1},d(t){p(s,t),t&&h(e)}}}function ar(t){let e,n=t[2].html,r=[];for(let e=0;e<n.length;e+=1)r[e]=fr(rr(t,n,e));return{c(){for(let t=0;t<r.length;t+=1)r[t].c();e=x()},m(t,n){for(let e=0;e<r.length;e+=1)r[e].m(t,n);f(t,e,n)},p(t,s){if(7&s){let l;for(n=t[2].html,l=0;l<n.length;l+=1){const o=rr(t,n,l);r[l]?r[l].p(o,s):(r[l]=fr(o),r[l].c(),r[l].m(e.parentNode,e))}for(;l<r.length;l+=1)r[l].d(1);r.length=n.length}},d(t){p(r,t),t&&h(e)}}}function ir(e){return{c:t,m:t,p:t,d:t}}function ur(t){let e,n,r,s,l=t[17].text+"";return{c(){e=m("p"),n=$(l),s=w(),y(e,"style",r=`max-width: ${t[1]}ch;`),y(e,"class","whitespace-pre-line break-words w-full")},m(t,r){f(t,e,r),d(e,n),f(t,s,r)},p(t,s){5&s&&l!==(l=t[17].text+"")&&k(n,l),2&s&&r!==(r=`max-width: ${t[1]}ch;`)&&y(e,"style",r)},d(t){t&&h(e),t&&h(s)}}}function dr(e){return{c:t,m:t,p:t,d:t}}function fr(t){let e,n,r={ctx:t,current:null,token:null,hasCatch:!1,pending:dr,then:ur,catch:ir,value:17};return Y(n=Ot.default.w3mRender(t[0],t[7].id),r),{c(){e=x(),r.block.c()},m(t,n){f(t,e,n),r.block.m(t,r.anchor=n),r.mount=()=>e.parentNode,r.anchor=e},p(e,s){t=e,r.ctx=t,5&s&&n!==(n=Ot.default.w3mRender(t[0],t[7].id))&&Y(n,r)||Z(r,t,s)},d(t){t&&h(e),r.block.d(t),r.token=null,r=null}}}function hr(e){let n,r,s,l=Jn(e[7].content),o=[];for(let t=0;t<l.length;t+=1)o[t]=wr(lr(e,l,t));return{c(){n=m("p");for(let t=0;t<o.length;t+=1)o[t].c();r=w(),y(n,"style",s=`max-width: ${e[1]}ch;`),y(n,"class","whitespace-pre-line break-words w-full")},m(t,e){f(t,n,e);for(let t=0;t<o.length;t+=1)o[t].m(n,null);d(n,r)},p(t,e){if(4&e){let s;for(l=Jn(t[7].content),s=0;s<l.length;s+=1){const c=lr(t,l,s);o[s]?o[s].p(c,e):(o[s]=wr(c),o[s].c(),o[s].m(n,r))}for(;s<o.length;s+=1)o[s].d(1);o.length=l.length}2&e&&s!==(s=`max-width: ${t[1]}ch;`)&&y(n,"style",s)},i:t,o:t,d(t){t&&h(n),p(o,t)}}}function pr(t){let e,n;return e=new tr({props:{content:t[7].content}}),{c(){rt(e.$$.fragment)},m(t,r){st(e,t,r),n=!0},p(t,n){const r={};4&n&&(r.content=t[7].content),e.$set(r)},i(t){n||(X(e.$$.fragment,t),n=!0)},o(t){Q(e.$$.fragment,t),n=!1},d(t){lt(e,t)}}}function mr(e){let n,r,s,l,o=e[7].content+"";return{c(){n=m("p"),r=$(o),s=w(),y(n,"style",l=`max-width: ${e[1]}ch;`),y(n,"class","whitespace-pre-line break-words text-gray-600 border-l-8 border-gray-400 pl-3 w-full")},m(t,e){f(t,n,e),d(n,r),d(n,s)},p(t,e){4&e&&o!==(o=t[7].content+"")&&k(r,o),2&e&&l!==(l=`max-width: ${t[1]}ch;`)&&y(n,"style",l)},i:t,o:t,d(t){t&&h(n)}}}function gr(t){let e,n=t[12]+"";return{c(){e=$(n)},m(t,n){f(t,e,n)},p(t,r){4&r&&n!==(n=t[12]+"")&&k(e,n)},d(t){t&&h(e)}}}function $r(t){let e,n,r,s,l,o,c,a,i=t[12].hostname+"";return{c(){e=m("a"),n=g("svg"),r=g("path"),s=g("path"),l=w(),o=m("span"),c=$(i),y(r,"d","M0 0h24v24H0z"),y(r,"fill","none"),y(s,"d","M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"),y(n,"xmlns","http://www.w3.org/2000/svg"),y(n,"viewBox","0 0 24 24"),y(n,"class","inline fill-current h-5"),y(o,"class","text-sm"),y(e,"href",a=t[12].toString()),y(e,"class","inline text-gray-600 hover:text-red-600"),y(e,"target","_blank")},m(t,a){f(t,e,a),d(e,n),d(n,r),d(n,s),d(e,l),d(e,o),d(o,c)},p(t,n){4&n&&i!==(i=t[12].hostname+"")&&k(c,i),4&n&&a!==(a=t[12].toString())&&y(e,"href",a)},d(t){t&&h(e)}}}function wr(t){let e;function n(t,e){return t[12]instanceof URL?$r:gr}let r=n(t),s=r(t);return{c(){s.c(),e=x()},m(t,n){s.m(t,n),f(t,e,n)},p(t,l){r===(r=n(t))&&s?s.p(t,l):(s.d(1),s=r(t),s&&(s.c(),s.m(e.parentNode,e)))},d(t){s.d(t),t&&h(e)}}}function xr(t){let e,n,r,s;const l=[mr,pr,hr],o=[];function c(t,e){return"quote"===t[7].type?0:"deepquote"===t[7].type?1:2}return e=c(t),n=o[e]=l[e](t),{c(){n.c(),r=x()},m(t,n){o[e].m(t,n),f(t,r,n),s=!0},p(t,s){let a=e;e=c(t),e===a?o[e].p(t,s):(K(),Q(o[a],1,1,(()=>{o[a]=null})),J(),n=o[e],n?n.p(t,s):(n=o[e]=l[e](t),n.c()),X(n,1),n.m(r.parentNode,r))},i(t){s||(X(n),s=!0)},o(t){Q(n),s=!1},d(t){o[e].d(t),t&&h(r)}}}function br(t){let e,n=t[2].html,r=[];for(let e=0;e<n.length;e+=1)r[e]=vr(nr(t,n,e));return{c(){for(let t=0;t<r.length;t+=1)r[t].c();e=x()},m(t,n){for(let e=0;e<r.length;e+=1)r[e].m(t,n);f(t,e,n)},p(t,s){if(5&s){let l;for(n=t[2].html,l=0;l<n.length;l+=1){const o=nr(t,n,l);r[l]?r[l].p(o,s):(r[l]=vr(o),r[l].c(),r[l].m(e.parentNode,e))}for(;l<r.length;l+=1)r[l].d(1);r.length=n.length}},d(t){p(r,t),t&&h(e)}}}function vr(t){let e,n,r;return{c(){e=m("a"),n=$("Open HTML"),y(e,"href",r=`/api/messages/${t[0]}/parts/${t[7].id}`),y(e,"class","block mr-3 text-red-400 hover:text-red-500 font-semibold underline"),y(e,"target","_blank"),y(e,"data-html-body","true")},m(t,r){f(t,e,r),d(e,n)},p(t,n){5&n&&r!==(r=`/api/messages/${t[0]}/parts/${t[7].id}`)&&y(e,"href",r)},d(t){t&&h(e)}}}function yr(t){let e,n=t[2].attachments,r=[];for(let e=0;e<n.length;e+=1)r[e]=kr(er(t,n,e));return{c(){e=m("div");for(let t=0;t<r.length;t+=1)r[t].c();y(e,"class","flex flex-row flex-wrap mt-3")},m(t,n){f(t,e,n);for(let t=0;t<r.length;t+=1)r[t].m(e,null)},p(t,s){if(5&s){let l;for(n=t[2].attachments,l=0;l<n.length;l+=1){const o=er(t,n,l);r[l]?r[l].p(o,s):(r[l]=kr(o),r[l].c(),r[l].m(e,null))}for(;l<r.length;l+=1)r[l].d(1);r.length=n.length}},d(t){t&&h(e),p(r,t)}}}function kr(t){let e,n,r,s,l,o,c,a,i,u=t[4].filename+"";return{c(){e=m("a"),n=g("svg"),r=g("path"),s=g("path"),l=w(),o=m("span"),c=$(u),y(r,"d","M0 0h24v24H0z"),y(r,"fill","none"),y(s,"d","M16.5 6v11.5c0 2.21-1.79 4-4 4s-4-1.79-4-4V5c0-1.38 1.12-2.5 2.5-2.5s2.5 1.12 2.5 2.5v10.5c0 .55-.45 1-1 1s-1-.45-1-1V6H10v9.5c0 1.38 1.12 2.5 2.5 2.5s2.5-1.12 2.5-2.5V5c0-2.21-1.79-4-4-4S7 2.79 7 5v12.5c0 3.04 2.46 5.5 5.5 5.5s5.5-2.46 5.5-5.5V6h-1.5z"),y(n,"xmlns","http://www.w3.org/2000/svg"),y(n,"viewBox","0 0 24 24"),y(n,"class","fill-current mr-1 w-5"),y(o,"class","truncate"),y(e,"href",a=`/api/messages/${t[0]}/parts/${t[4].id}`),y(e,"download",i=t[4].filename),y(e,"class","flex flex-row items-center mr-2 mb-2 p-3 rounded border-2 border-gray-500 text-gray-600 font-semibold hover:border-gray-700 hover:text-gray-800 visited:text-gray-600 hover:no-underline max-w-xs")},m(t,a){f(t,e,a),d(e,n),d(n,r),d(n,s),d(e,l),d(e,o),d(o,c)},p(t,n){4&n&&u!==(u=t[4].filename+"")&&k(c,u),5&n&&a!==(a=`/api/messages/${t[0]}/parts/${t[4].id}`)&&y(e,"href",a),4&n&&i!==(i=t[4].filename)&&y(e,"download",i)},d(t){t&&h(e)}}}function Mr(t){let e,n,r,s,l,o,c,a,i,u,p;const g=[cr,or],b=[];function v(t,e){return t[2].text.length>0?0:1}e=v(t),n=b[e]=g[e](t);let k=t[2].html.length>0&&br(t),M=t[2].attachments.length>0&&yr(t);return{c(){n.c(),r=w(),s=m("p"),k&&k.c(),l=w(),o=m("a"),c=$("Show RAW"),i=w(),M&&M.c(),u=x(),y(o,"href",a=`/api/messages/${t[0]}/parts/0`),y(o,"class","block text-red-400 hover:text-red-500 font-semibold underline"),y(o,"target","_blank"),y(o,"data-html-body","true"),y(s,"class","mt-3 flex flex-row")},m(t,n){b[e].m(t,n),f(t,r,n),f(t,s,n),k&&k.m(s,null),d(s,l),d(s,o),d(o,c),f(t,i,n),M&&M.m(t,n),f(t,u,n),p=!0},p(t,[c]){let i=e;e=v(t),e===i?b[e].p(t,c):(K(),Q(b[i],1,1,(()=>{b[i]=null})),J(),n=b[e],n?n.p(t,c):(n=b[e]=g[e](t),n.c()),X(n,1),n.m(r.parentNode,r)),t[2].html.length>0?k?k.p(t,c):(k=br(t),k.c(),k.m(s,l)):k&&(k.d(1),k=null),(!p||1&c&&a!==(a=`/api/messages/${t[0]}/parts/0`))&&y(o,"href",a),t[2].attachments.length>0?M?M.p(t,c):(M=yr(t),M.c(),M.m(u.parentNode,u)):M&&(M.d(1),M=null)},i(t){p||(X(n),p=!0)},o(t){Q(n),p=!1},d(t){b[e].d(t),t&&h(r),t&&h(s),k&&k.d(),t&&h(i),M&&M.d(t),t&&h(u)}}}function zr(t,e,n){let r,{body:s}=e,{messageId:l}=e,{wrap:o=80}=e;return t.$$set=t=>{"body"in t&&n(3,s=t.body),"messageId"in t&&n(0,l=t.messageId),"wrap"in t&&n(1,o=t.wrap)},t.$$.update=()=>{8&t.$$.dirty&&n(2,r=Gn(s)),13&t.$$.dirty&&console.debug(`selected message ${window.atob(l)},`,"body:",s,"parsed content:",r)},[l,o,r,s]}class Hr extends ct{constructor(t){super(),ot(this,t,zr,Mr,l,{body:3,messageId:0,wrap:1})}}function Tr(t){let e,n;return{c(){e=m("span"),n=$(t[3]),y(e,"class","hidden sm:inline text-gray-600 pl-1")},m(t,r){f(t,e,r),d(e,n)},p(t,e){8&e&&k(n,t[3])},d(t){t&&h(e)}}}function Cr(e){let n,r,s,l,o=e[3]&&Tr(e);return{c(){n=m("span"),r=$(e[2]),s=w(),o&&o.c(),y(n,"class",l=`${e[0]} ${e[1]?"line-through":""}`)},m(t,e){f(t,n,e),d(n,r),d(n,s),o&&o.m(n,null)},p(t,[e]){4&e&&k(r,t[2]),t[3]?o?o.p(t,e):(o=Tr(t),o.c(),o.m(n,null)):o&&(o.d(1),o=null),3&e&&l!==(l=`${t[0]} ${t[1]?"line-through":""}`)&&y(n,"class",l)},i:t,o:t,d(t){t&&h(n),o&&o.d()}}}function Vr(t,e,n){let r,s,{class:l=""}=e,{address:o}=e,{removed:c=!1}=e;return t.$$set=t=>{"class"in t&&n(0,l=t.class),"address"in t&&n(4,o=t.address),"removed"in t&&n(1,c=t.removed)},t.$$.update=()=>{16&t.$$.dirty&&n(2,[,r,s]=o.match(/(.*?)\s(\<.*?\>)/)||[null,o],r,(n(3,s),n(4,o)))},[l,c,r,s,o]}class Lr extends ct{constructor(t){super(),ot(this,t,Vr,Cr,l,{class:0,address:4,removed:1})}}function Br(t,e,n){const r=t.slice();return r[1]=e[n],r}function Sr(t,e,n){const r=t.slice();return r[4]=e[n],r}function Er(t,e,n){const r=t.slice();return r[4]=e[n],r}function jr(t){let e,n,r,s,l=t[0].headers.To.split(", "),o=[];for(let e=0;e<l.length;e+=1)o[e]=Nr(Er(t,l,e));const c=t=>Q(o[t],1,1,(()=>{o[t]=null}));return{c(){e=m("p"),n=m("span"),n.textContent="To:",r=w();for(let t=0;t<o.length;t+=1)o[t].c();y(n,"class","inline-flex w-10"),y(e,"class","mb-2 text-gray-500")},m(t,l){f(t,e,l),d(e,n),d(e,r);for(let t=0;t<o.length;t+=1)o[t].m(e,null);s=!0},p(t,n){if(1&n){let r;for(l=t[0].headers.To.split(", "),r=0;r<l.length;r+=1){const s=Er(t,l,r);o[r]?(o[r].p(s,n),X(o[r],1)):(o[r]=Nr(s),o[r].c(),X(o[r],1),o[r].m(e,null))}for(K(),r=l.length;r<o.length;r+=1)c(r);J()}},i(t){if(!s){for(let t=0;t<l.length;t+=1)X(o[t]);s=!0}},o(t){o=o.filter(Boolean);for(let t=0;t<o.length;t+=1)Q(o[t]);s=!1},d(t){t&&h(e),p(o,t)}}}function Nr(t){let e,n;return e=new Lr({props:{class:"mr-3",address:t[4]}}),{c(){rt(e.$$.fragment)},m(t,r){st(e,t,r),n=!0},p(t,n){const r={};1&n&&(r.address=t[4]),e.$set(r)},i(t){n||(X(e.$$.fragment,t),n=!0)},o(t){Q(e.$$.fragment,t),n=!1},d(t){lt(e,t)}}}function qr(t){let e,n,r,s,l=t[0].headers.Cc.split(", "),o=[];for(let e=0;e<l.length;e+=1)o[e]=_r(Sr(t,l,e));const c=t=>Q(o[t],1,1,(()=>{o[t]=null}));return{c(){e=m("p"),n=m("span"),n.textContent="Cc:",r=w();for(let t=0;t<o.length;t+=1)o[t].c();y(n,"class","inline-flex w-10"),y(e,"class","mb-2 text-gray-500")},m(t,l){f(t,e,l),d(e,n),d(e,r);for(let t=0;t<o.length;t+=1)o[t].m(e,null);s=!0},p(t,n){if(1&n){let r;for(l=t[0].headers.Cc.split(", "),r=0;r<l.length;r+=1){const s=Sr(t,l,r);o[r]?(o[r].p(s,n),X(o[r],1)):(o[r]=_r(s),o[r].c(),X(o[r],1),o[r].m(e,null))}for(K(),r=l.length;r<o.length;r+=1)c(r);J()}},i(t){if(!s){for(let t=0;t<l.length;t+=1)X(o[t]);s=!0}},o(t){o=o.filter(Boolean);for(let t=0;t<o.length;t+=1)Q(o[t]);s=!1},d(t){t&&h(e),p(o,t)}}}function _r(t){let e,n;return e=new Lr({props:{class:"mr-3",address:t[4]}}),{c(){rt(e.$$.fragment)},m(t,r){st(e,t,r),n=!0},p(t,n){const r={};1&n&&(r.address=t[4]),e.$set(r)},i(t){n||(X(e.$$.fragment,t),n=!0)},o(t){Q(e.$$.fragment,t),n=!1},d(t){lt(e,t)}}}function Dr(t){let e,n;return e=new dn({props:{class:"m-1",tag:t[1]}}),{c(){rt(e.$$.fragment)},m(t,r){st(e,t,r),n=!0},p(t,n){const r={};1&n&&(r.tag=t[1]),e.$set(r)},i(t){n||(X(e.$$.fragment,t),n=!0)},o(t){Q(e.$$.fragment,t),n=!1},d(t){lt(e,t)}}}function Fr(t){let e,n,r,s,l,o,c,a,i,u,x,b,v,M,z,H,T,C,V,L,B,S,E,j,N,q,_=t[0].headers.Subject+"",D=new Date(t[0].headers.Date)+"",F=t[0].date_relative+"";l=new Lr({props:{address:t[0].headers.From}});let A=t[0].headers.To&&jr(t),I=t[0].headers.Cc&&qr(t),O=t[0].tags,R=[];for(let e=0;e<O.length;e+=1)R[e]=Dr(Br(t,O,e));const P=t=>Q(R[t],1,1,(()=>{R[t]=null}));return{c(){e=m("div"),n=m("p"),r=m("span"),r.textContent="From:",s=w(),rt(l.$$.fragment),o=w(),A&&A.c(),c=w(),I&&I.c(),a=w(),i=m("h3"),u=$(_),x=w(),b=m("div"),v=m("div"),M=g("svg"),z=g("path"),H=g("path"),T=g("path"),C=w(),V=m("span"),L=$(D),B=w(),S=m("span"),E=$(F),j=w(),N=m("div");for(let t=0;t<R.length;t+=1)R[t].c();y(r,"class","inline-flex w-10 text-gray-500"),y(n,"class","mb-2"),y(i,"class","mb-3"),y(z,"d","M0 0h24v24H0z"),y(z,"fill","none"),y(H,"d","M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"),y(T,"d","M12.5 7H11v6l5.25 3.15.75-1.23-4.5-2.67z"),y(M,"xmlns","http://www.w3.org/2000/svg"),y(M,"viewBox","0 0 24 24"),y(M,"class","w-4 fill-current mr-1"),y(V,"class","hidden sm:inline"),y(S,"class","sm:hidden"),y(v,"class","inline-flex flex-shrink-0 items-center mr-4 text-gray-600 text-sm"),y(N,"class","flex flex-row flex-wrap"),y(b,"class","flex"),y(e,"class","p-3")},m(t,h){f(t,e,h),d(e,n),d(n,r),d(n,s),st(l,n,null),d(e,o),A&&A.m(e,null),d(e,c),I&&I.m(e,null),d(e,a),d(e,i),d(i,u),d(e,x),d(e,b),d(b,v),d(v,M),d(M,z),d(M,H),d(M,T),d(v,C),d(v,V),d(V,L),d(v,B),d(v,S),d(S,E),d(b,j),d(b,N);for(let t=0;t<R.length;t+=1)R[t].m(N,null);q=!0},p(t,[n]){const r={};if(1&n&&(r.address=t[0].headers.From),l.$set(r),t[0].headers.To?A?(A.p(t,n),1&n&&X(A,1)):(A=jr(t),A.c(),X(A,1),A.m(e,c)):A&&(K(),Q(A,1,1,(()=>{A=null})),J()),t[0].headers.Cc?I?(I.p(t,n),1&n&&X(I,1)):(I=qr(t),I.c(),X(I,1),I.m(e,a)):I&&(K(),Q(I,1,1,(()=>{I=null})),J()),(!q||1&n)&&_!==(_=t[0].headers.Subject+"")&&k(u,_),(!q||1&n)&&D!==(D=new Date(t[0].headers.Date)+"")&&k(L,D),(!q||1&n)&&F!==(F=t[0].date_relative+"")&&k(E,F),1&n){let e;for(O=t[0].tags,e=0;e<O.length;e+=1){const r=Br(t,O,e);R[e]?(R[e].p(r,n),X(R[e],1)):(R[e]=Dr(r),R[e].c(),X(R[e],1),R[e].m(N,null))}for(K(),e=O.length;e<R.length;e+=1)P(e);J()}},i(t){if(!q){X(l.$$.fragment,t),X(A),X(I);for(let t=0;t<O.length;t+=1)X(R[t]);q=!0}},o(t){Q(l.$$.fragment,t),Q(A),Q(I),R=R.filter(Boolean);for(let t=0;t<R.length;t+=1)Q(R[t]);q=!1},d(t){t&&h(e),lt(l),A&&A.d(),I&&I.d(),p(R,t)}}}function Ar(t,e,n){let{message:r}=e;return t.$$set=t=>{"message"in t&&n(0,r=t.message)},[r]}class Ir extends ct{constructor(t){super(),ot(this,t,Ar,Fr,l,{message:0})}}const{subscribe:Or,set:Rr,update:Pr}=zt(null);var Ur={subscribe:Or,create:function(){Rr({to:[],cc:[],subject:"",body:"",headers:{},attachments:[]})},reply:async function(t,e){const n=await Ot.default.replyToMessage(t,e),{To:r,Cc:s,Subject:l,...o}=n["reply-headers"],{headers:c,body:a}=n.original,i=a.map((t=>Wn(t))).join("\n");Rr({to:r.split(", "),cc:s?.split(", ")||[],subject:l,headers:{...o},body:i,originalHeaders:c,reply:!0,attachments:[]})},forward:function({id:t,body:e,headers:n}){const r=e.map((t=>Wn(t))).join("\n"),s=[];e.forEach((e=>{Un(e).forEach((e=>s.push({id:`${t}:${e.id}`,name:e.filename,size:e["content-length"],type:e["content-type"]})))})),Rr({to:[],cc:[],subject:`Fwd: ${n.Subject}`,headers:{},body:r,originalHeaders:n,reply:!0,attachments:s})},edit:function({id:t,body:e,headers:n}){const{To:r,Cc:s,Subject:l,...o}=n,c=e.map((t=>Pn(t))).join("\n"),a=[];e.forEach((e=>{Un(e).forEach((e=>a.push({id:`${t}:${e.id}`,name:e.filename,size:e["content-length"],type:e["content-type"]})))})),Rr({to:r.split(", "),cc:s?.split(", ")||[],subject:l,headers:{...o},body:c,originalHeaders:n,reply:!1,attachments:a})},setField:function(t){Pr((e=>({...e,...t})))},set:function({body:t}){Pr((e=>({...e,body:t})))},destroy:function(){Rr(null)}};function Wr(t){let e,n,r;return{c(){e=g("svg"),n=g("path"),r=g("path"),y(n,"d","M0 0h24v24H0V0z"),y(n,"fill","none"),y(r,"d","M18.83 7h-2.6L10.5 4 4 7.4V17c-1.1 0-2-.9-2-2V7.17c0-.53.32-1.09.8-1.34L10.5 2l7.54 3.83c.43.23.73.7.79 1.17zM20 8H7c-1.1 0-2 .9-2 2v9c0 1.1.9 2 2 2h13c1.1 0 2-.9 2-2v-9c0-1.1-.9-2-2-2zm0 3.67L13.5 15 7 11.67V10l6.5 3.33L20 10v1.67z"),y(e,"xmlns","http://www.w3.org/2000/svg"),y(e,"viewBox","0 0 24 24"),y(e,"class","w-full fill-current")},m(t,s){f(t,e,s),d(e,n),d(e,r)},d(t){t&&h(e)}}}function Gr(t){let e,n,r,s,l,o,c,a;return e=new cn({props:{tooltip:"Move to archive",class:"mr-1 py-1",$$slots:{default:[Kr]},$$scope:{ctx:t}}}),e.$on("click",t[10]),r=new cn({props:{tooltip:"Move to inbox",class:"mr-1 py-1",$$slots:{default:[Jr]},$$scope:{ctx:t}}}),r.$on("click",t[11]),l=new cn({props:{tooltip:"Move to spam",class:"mr-1 py-1",$$slots:{default:[Xr]},$$scope:{ctx:t}}}),l.$on("click",t[12]),c=new cn({props:{tooltip:"Move to trash",class:"mr-3 py-1",$$slots:{default:[Qr]},$$scope:{ctx:t}}}),c.$on("click",t[13]),{c(){rt(e.$$.fragment),n=w(),rt(r.$$.fragment),s=w(),rt(l.$$.fragment),o=w(),rt(c.$$.fragment)},m(t,i){st(e,t,i),f(t,n,i),st(r,t,i),f(t,s,i),st(l,t,i),f(t,o,i),st(c,t,i),a=!0},p(t,n){const s={};1048576&n&&(s.$$scope={dirty:n,ctx:t}),e.$set(s);const o={};1048576&n&&(o.$$scope={dirty:n,ctx:t}),r.$set(o);const a={};1048576&n&&(a.$$scope={dirty:n,ctx:t}),l.$set(a);const i={};1048576&n&&(i.$$scope={dirty:n,ctx:t}),c.$set(i)},i(t){a||(X(e.$$.fragment,t),X(r.$$.fragment,t),X(l.$$.fragment,t),X(c.$$.fragment,t),a=!0)},o(t){Q(e.$$.fragment,t),Q(r.$$.fragment,t),Q(l.$$.fragment,t),Q(c.$$.fragment,t),a=!1},d(t){lt(e,t),t&&h(n),lt(r,t),t&&h(s),lt(l,t),t&&h(o),lt(c,t)}}}function Kr(t){let e,n,r,s,l;return{c(){e=g("svg"),n=g("g"),r=g("rect"),s=g("g"),l=g("path"),y(r,"fill","none"),y(r,"height","24"),y(r,"width","24"),y(l,"d","M20,2H4C3,2,2,2.9,2,4v3.01C2,7.73,2.43,8.35,3,8.7V20c0,1.1,1.1,2,2,2h14c0.9,0,2-0.9,2-2V8.7c0.57-0.35,1-0.97,1-1.69V4 C22,2.9,21,2,20,2z M15,14H9v-2h6V14z M20,7H4V4h16V7z"),y(e,"xmlns","http://www.w3.org/2000/svg"),y(e,"enable-background","new 0 0 24 24"),y(e,"viewBox","0 0 24 24"),y(e,"class","fill-current w-full")},m(t,o){f(t,e,o),d(e,n),d(n,r),d(e,s),d(s,l)},d(t){t&&h(e)}}}function Jr(t){let e,n,r;return{c(){e=g("svg"),n=g("path"),r=g("path"),y(n,"d","M0 0h24v24H0V0z"),y(n,"fill","none"),y(r,"d","M19 3H4.99c-1.11 0-1.98.89-1.98 2L3 19c0 1.1.88 2 1.99 2H19c1.1 0 2-.9 2-2V5c0-1.11-.9-2-2-2zm0 12h-4c0 1.66-1.35 3-3 3s-3-1.34-3-3H4.99V5H19v10z"),y(e,"xmlns","http://www.w3.org/2000/svg"),y(e,"viewBox","0 0 24 24"),y(e,"class","fill-current w-full")},m(t,s){f(t,e,s),d(e,n),d(e,r)},d(t){t&&h(e)}}}function Xr(t){let e,n,r;return{c(){e=g("svg"),n=g("path"),r=g("path"),y(n,"d","M0 0h24v24H0z"),y(n,"fill","none"),y(r,"d","M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.42 0-8-3.58-8-8 0-1.85.63-3.55 1.69-4.9L16.9 18.31C15.55 19.37 13.85 20 12 20zm6.31-3.1L7.1 5.69C8.45 4.63 10.15 4 12 4c4.42 0 8 3.58 8 8 0 1.85-.63 3.55-1.69 4.9z"),y(e,"xmlns","http://www.w3.org/2000/svg"),y(e,"viewBox","0 0 24 24"),y(e,"class","w-full fill-current")},m(t,s){f(t,e,s),d(e,n),d(e,r)},d(t){t&&h(e)}}}function Qr(t){let e,n,r;return{c(){e=g("svg"),n=g("path"),r=g("path"),y(n,"d","M0 0h24v24H0z"),y(n,"fill","none"),y(r,"d","M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"),y(e,"xmlns","http://www.w3.org/2000/svg"),y(e,"viewBox","0 0 24 24"),y(e,"class","w-full fill-current")},m(t,s){f(t,e,s),d(e,n),d(e,r)},d(t){t&&h(e)}}}function Yr(t){let e,n,r;return{c(){e=g("svg"),n=g("path"),r=g("path"),y(n,"d","M0 0h24v24H0z"),y(n,"fill","none"),y(r,"d","M21.41 11.58l-9-9C12.05 2.22 11.55 2 11 2H4c-1.1 0-2 .9-2 2v7c0 .55.22 1.05.59 1.42l9 9c.36.36.86.58 1.41.58.55 0 1.05-.22 1.41-.59l7-7c.37-.36.59-.86.59-1.41 0-.55-.23-1.06-.59-1.42zM5.5 7C4.67 7 4 6.33 4 5.5S4.67 4 5.5 4 7 4.67 7 5.5 6.33 7 5.5 7z"),y(e,"xmlns","http://www.w3.org/2000/svg"),y(e,"viewBox","0 0 24 24"),y(e,"class","w-full fill-current")},m(t,s){f(t,e,s),d(e,n),d(e,r)},d(t){t&&h(e)}}}function Zr(t){let e,n;return e=new wn({props:{class:"absolute left-1/2 transform sm:transform-none -translate-x-1/2 sm:left-10 top-14 z-10",tags:t[0].tags}}),e.$on("add",t[5]),e.$on("remove",t[6]),e.$on("close",t[15]),{c(){rt(e.$$.fragment)},m(t,r){st(e,t,r),n=!0},p(t,n){const r={};1&n&&(r.tags=t[0].tags),e.$set(r)},i(t){n||(X(e.$$.fragment,t),n=!0)},o(t){Q(e.$$.fragment,t),n=!1},d(t){lt(e,t)}}}function ts(t){let e,n;return e=new cn({props:{tooltip:"Edit",class:"mr-1",$$slots:{default:[es]},$$scope:{ctx:t}}}),e.$on("click",t[9]),{c(){rt(e.$$.fragment)},m(t,r){st(e,t,r),n=!0},p(t,n){const r={};1048576&n&&(r.$$scope={dirty:n,ctx:t}),e.$set(r)},i(t){n||(X(e.$$.fragment,t),n=!0)},o(t){Q(e.$$.fragment,t),n=!1},d(t){lt(e,t)}}}function es(t){let e,n,r;return{c(){e=g("svg"),n=g("path"),r=g("path"),y(n,"d","M0 0h24v24H0z"),y(n,"fill","none"),y(r,"d","M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"),y(e,"xmlns","http://www.w3.org/2000/svg"),y(e,"viewBox","0 0 24 24"),y(e,"class","w-full fill-current")},m(t,s){f(t,e,s),d(e,n),d(e,r)},d(t){t&&h(e)}}}function ns(t){let e,n,r;return{c(){e=g("svg"),n=g("path"),r=g("path"),y(n,"d","M0 0h24v24H0z"),y(n,"fill","none"),y(r,"d","M10 9V5l-7 7 7 7v-4.1c5 0 8.5 1.6 11 5.1-1-5-4-10-11-11z"),y(e,"xmlns","http://www.w3.org/2000/svg"),y(e,"viewBox","0 0 24 24"),y(e,"class","w-full fill-current")},m(t,s){f(t,e,s),d(e,n),d(e,r)},d(t){t&&h(e)}}}function rs(t){let e,n,r;return{c(){e=g("svg"),n=g("path"),r=g("path"),y(n,"d","M0 0h24v24H0z"),y(n,"fill","none"),y(r,"d","M7 8V5l-7 7 7 7v-3l-4-4 4-4zm6 1V5l-7 7 7 7v-4.1c5 0 8.5 1.6 11 5.1-1-5-4-10-11-11z"),y(e,"xmlns","http://www.w3.org/2000/svg"),y(e,"viewBox","0 0 24 24"),y(e,"class","w-full fill-current")},m(t,s){f(t,e,s),d(e,n),d(e,r)},d(t){t&&h(e)}}}function ss(t){let e,n,r;return{c(){e=g("svg"),n=g("path"),r=g("path"),y(n,"d","M0 0h24v24H0z"),y(n,"fill","none"),y(r,"d","M12 8V4l8 8-8 8v-4H4V8z"),y(e,"xmlns","http://www.w3.org/2000/svg"),y(e,"viewBox","0 0 24 24"),y(e,"class","w-full fill-current")},m(t,s){f(t,e,s),d(e,n),d(e,r)},d(t){t&&h(e)}}}function ls(t){let e,n,r,s,l,o,c,a,i,u,p,g,$,x,b,v,k=t[0].tags.includes("draft");n=new cn({props:{tooltip:"Mark as unread",tooltipPosition:"left",class:"mr-3 py-1",$$slots:{default:[Wr]},$$scope:{ctx:t}}}),n.$on("click",t[3]);let M="search"!==t[2]&&Gr(t);o=new cn({props:{tooltip:"Tag",class:"mr-3",$$slots:{default:[Yr]},$$scope:{ctx:t}}}),o.$on("click",t[14]);let z=t[1]&&Zr(t),H=k&&ts(t);return p=new cn({props:{tooltip:"Reply",class:"mr-1",$$slots:{default:[ns]},$$scope:{ctx:t}}}),p.$on("click",t[16]),$=new cn({props:{tooltip:"Reply all",class:"mr-1",$$slots:{default:[rs]},$$scope:{ctx:t}}}),$.$on("click",t[17]),b=new cn({props:{tooltip:"Forward",tooltipPosition:"right",$$slots:{default:[ss]},$$scope:{ctx:t}}}),b.$on("click",t[8]),{c(){e=m("div"),rt(n.$$.fragment),r=w(),M&&M.c(),s=w(),l=m("div"),rt(o.$$.fragment),c=w(),z&&z.c(),a=w(),i=m("div"),H&&H.c(),u=w(),rt(p.$$.fragment),g=w(),rt($.$$.fragment),x=w(),rt(b.$$.fragment),y(l,"class","py-1"),y(i,"class","flex flex-row py-1 sm:pt-0 sm:ml-auto"),y(e,"class","relative flex flex-wrap sm:flex-row px-3 py-2 border-b border-t")},m(t,h){f(t,e,h),st(n,e,null),d(e,r),M&&M.m(e,null),d(e,s),d(e,l),st(o,l,null),d(l,c),z&&z.m(l,null),d(e,a),d(e,i),H&&H.m(i,null),d(i,u),st(p,i,null),d(i,g),st($,i,null),d(i,x),st(b,i,null),v=!0},p(t,[r]){const c={};1048576&r&&(c.$$scope={dirty:r,ctx:t}),n.$set(c),"search"!==t[2]?M?(M.p(t,r),4&r&&X(M,1)):(M=Gr(t),M.c(),X(M,1),M.m(e,s)):M&&(K(),Q(M,1,1,(()=>{M=null})),J());const a={};1048576&r&&(a.$$scope={dirty:r,ctx:t}),o.$set(a),t[1]?z?(z.p(t,r),2&r&&X(z,1)):(z=Zr(t),z.c(),X(z,1),z.m(l,null)):z&&(K(),Q(z,1,1,(()=>{z=null})),J()),1&r&&(k=t[0].tags.includes("draft")),k?H?(H.p(t,r),1&r&&X(H,1)):(H=ts(t),H.c(),X(H,1),H.m(i,u)):H&&(K(),Q(H,1,1,(()=>{H=null})),J());const d={};1048576&r&&(d.$$scope={dirty:r,ctx:t}),p.$set(d);const f={};1048576&r&&(f.$$scope={dirty:r,ctx:t}),$.$set(f);const h={};1048576&r&&(h.$$scope={dirty:r,ctx:t}),b.$set(h)},i(t){v||(X(n.$$.fragment,t),X(M),X(o.$$.fragment,t),X(z),X(H),X(p.$$.fragment,t),X($.$$.fragment,t),X(b.$$.fragment,t),v=!0)},o(t){Q(n.$$.fragment,t),Q(M),Q(o.$$.fragment,t),Q(z),Q(H),Q(p.$$.fragment,t),Q($.$$.fragment,t),Q(b.$$.fragment,t),v=!1},d(t){t&&h(e),lt(n),M&&M.d(),lt(o),z&&z.d(),H&&H.d(),lt(p),lt($),lt(b)}}}function os(t,e,n){let r,s;c(t,At,(t=>n(18,r=t))),c(t,Ft,(t=>n(2,s=t)));let{message:l}=e;const o=L();let a=!1;function i(t){o("move",t)}async function u(t){Ur.reply(l.id,t)}return t.$$set=t=>{"message"in t&&n(0,l=t.message)},[l,a,s,function(){Xe(r,l.id,["+unread"])},i,function({detail:t}){Xe(r,l.id,[`+${t}`])},function({detail:t}){Xe(r,l.id,[`-${t}`])},u,async function(){Ur.forward(l)},async function(){Ur.edit(l)},()=>i("archive"),()=>i("inbox"),()=>i("spam"),()=>i("trash"),()=>n(1,a=!0),()=>n(1,a=!1),()=>u("sender"),()=>u("all")]}class cs extends ct{constructor(t){super(),ot(this,t,os,ls,l,{message:0})}}function as(t,e,n){const r=t.slice();return r[9]=e[n],r}function is(t,e){let n,r,s;return r=new Hr({props:{body:e[9],messageId:window.btoa(e[0].id),wrap:"100"}}),{key:t,first:null,c(){n=x(),rt(r.$$.fragment),this.first=n},m(t,e){f(t,n,e),st(r,t,e),s=!0},p(t,n){e=t;const s={};1&n&&(s.body=e[9]),1&n&&(s.messageId=window.btoa(e[0].id)),r.$set(s)},i(t){s||(X(r.$$.fragment,t),s=!0)},o(t){Q(r.$$.fragment,t),s=!1},d(t){t&&h(n),lt(r,t)}}}function us(t){let e,n,r,s,l,o,c,a=[],i=new Map;n=new Ir({props:{message:t[0]}}),s=new cs({props:{message:t[0]}}),s.$on("move",t[2]);let u=t[0].body;const p=t=>t[9].id;for(let e=0;e<u.length;e+=1){let n=as(t,u,e),r=p(n);i.set(r,a[e]=is(r,n))}return{c(){e=m("div"),rt(n.$$.fragment),r=w(),rt(s.$$.fragment),l=w(),o=m("div");for(let t=0;t<a.length;t+=1)a[t].c();y(e,"class","relative bg-gray-100"),y(o,"class","p-5 border-b-2 border-gray-200")},m(t,i){f(t,e,i),st(n,e,null),d(e,r),st(s,e,null),f(t,l,i),f(t,o,i);for(let t=0;t<a.length;t+=1)a[t].m(o,null);c=!0},p(t,[e]){const r={};1&e&&(r.message=t[0]),n.$set(r);const l={};1&e&&(l.message=t[0]),s.$set(l),1&e&&(u=t[0].body,K(),a=et(a,e,p,1,t,u,i,o,tt,is,null,as),J())},i(t){if(!c){X(n.$$.fragment,t),X(s.$$.fragment,t);for(let t=0;t<u.length;t+=1)X(a[t]);c=!0}},o(t){Q(n.$$.fragment,t),Q(s.$$.fragment,t);for(let t=0;t<a.length;t+=1)Q(a[t]);c=!1},d(t){t&&h(e),lt(n),lt(s),t&&h(l),t&&h(o);for(let t=0;t<a.length;t+=1)a[t].d()}}}function ds(t,e,n){let r,s,l,o,a;c(t,ne,(t=>n(3,r=t))),c(t,At,(t=>n(4,s=t))),c(t,Ft,(t=>n(5,l=t))),c(t,Xt,(t=>n(6,o=t))),c(t,Je,(t=>n(7,a=t)));let{message:i}=e;function u(t){const{changes:e,fromTags:n}=Ze(o,l,t);Xe(s,i.id,e);const c=Ue(a,i.id,n);c?Lt.selectMessage(c.id):function(){const t=r.findIndex((({thread:t})=>t===s)),e=r[t+1];e?Dt.selectThread(l,e.thread):Dt.deselectThread()}()}return t.$$set=t=>{"message"in t&&n(0,i=t.message)},[i,u,({detail:t})=>u(t)]}class fs extends ct{constructor(t){super(),ot(this,t,ds,us,l,{message:0,move:1})}get move(){return this.$$.ctx[1]}}function hs(t){let e,n,r,s,l,o,c,a,i,u,p,x,v,M,z,H,T,C=t[0].headers.Date+"",V=t[0].date_relative+"";return c=new Lr({props:{address:t[0].headers.From,removed:t[0].tags.includes("trash")}}),{c(){e=m("div"),n=m("div"),r=g("svg"),s=g("path"),l=g("path"),o=w(),rt(c.$$.fragment),i=w(),u=m("span"),p=$(C),x=w(),v=m("span"),M=$(V),y(s,"d","M0 0h24v24H0z"),y(s,"fill","none"),y(l,"d","M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"),y(r,"xmlns","http://www.w3.org/2000/svg"),y(r,"viewBox","0 0 24 24"),y(r,"class","w-5 fill-current"),y(n,"class","flex flex-row items-center"),y(n,"style",a=`padding-left: ${10*t[1]}px;`),y(u,"class","text-gray-500 text-sm hidden sm:inline"),y(v,"class","text-gray-500 text-sm sm:hidden"),y(e,"class","p-3 flex flex-row justify-between items-center bg-gray-100 border-b-2 border-gray-200 cursor-pointer")},m(a,h){f(a,e,h),d(e,n),d(n,r),d(r,s),d(r,l),d(n,o),st(c,n,null),d(e,i),d(e,u),d(u,p),d(e,x),d(e,v),d(v,M),z=!0,H||(T=b(e,"click",t[3]),H=!0)},p(t,[e]){const r={};1&e&&(r.address=t[0].headers.From),1&e&&(r.removed=t[0].tags.includes("trash")),c.$set(r),(!z||2&e&&a!==(a=`padding-left: ${10*t[1]}px;`))&&y(n,"style",a),(!z||1&e)&&C!==(C=t[0].headers.Date+"")&&k(p,C),(!z||1&e)&&V!==(V=t[0].date_relative+"")&&k(M,V)},i(t){z||(X(c.$$.fragment,t),z=!0)},o(t){Q(c.$$.fragment,t),z=!1},d(t){t&&h(e),lt(c),H=!1,T()}}}function ps(t,e,n){let r;c(t,At,(t=>n(4,r=t)));let{message:s}=e,{level:l}=e;function o(){Lt.selectMessage(s.id),Ye(r,s)}return t.$$set=t=>{"message"in t&&n(0,s=t.message),"level"in t&&n(1,l=t.level)},[s,l,o,()=>o()]}class ms extends ct{constructor(t){super(),ot(this,t,ps,hs,l,{message:0,level:1})}}function gs(t,e,n){const r=t.slice();return r[6]=e[n][0],r[7]=e[n][1],r}function $s(t){let e,n,r=t[1],s=[];for(let e=0;e<r.length;e+=1)s[e]=bs(gs(t,r,e));const l=t=>Q(s[t],1,1,(()=>{s[t]=null}));return{c(){for(let t=0;t<s.length;t+=1)s[t].c();e=x()},m(t,r){for(let e=0;e<s.length;e+=1)s[e].m(t,r);f(t,e,r),n=!0},p(t,n){if(15&n){let o;for(r=t[1],o=0;o<r.length;o+=1){const l=gs(t,r,o);s[o]?(s[o].p(l,n),X(s[o],1)):(s[o]=bs(l),s[o].c(),X(s[o],1),s[o].m(e.parentNode,e))}for(K(),o=r.length;o<s.length;o+=1)l(o);J()}},i(t){if(!n){for(let t=0;t<r.length;t+=1)X(s[t]);n=!0}},o(t){s=s.filter(Boolean);for(let t=0;t<s.length;t+=1)Q(s[t]);n=!1},d(t){p(s,t),t&&h(e)}}}function ws(t){let e,n,r={message:t[6]};return e=new fs({props:r}),t[4](e),{c(){rt(e.$$.fragment)},m(t,r){st(e,t,r),n=!0},p(t,n){const r={};2&n&&(r.message=t[6]),e.$set(r)},i(t){n||(X(e.$$.fragment,t),n=!0)},o(t){Q(e.$$.fragment,t),n=!1},d(n){t[4](null),lt(e,n)}}}function xs(t){let e,n;return e=new ms({props:{message:t[6],level:t[2]}}),{c(){rt(e.$$.fragment)},m(t,r){st(e,t,r),n=!0},p(t,n){const r={};2&n&&(r.message=t[6]),4&n&&(r.level=t[2]),e.$set(r)},i(t){n||(X(e.$$.fragment,t),n=!0)},o(t){Q(e.$$.fragment,t),n=!1},d(t){lt(e,t)}}}function bs(t){let e,n,r,s,l,o,c,a;const i=[xs,ws],u=[];function d(t,e){return t[6].id!==t[3]?0:1}function p(e){t[5](e)}n=d(t),r=u[n]=i[n](t);let g={thread:t[7],level:t[2]+1};return void 0!==t[0]&&(g.activeMessage=t[0]),o=new ks({props:g}),E.push((()=>nt(o,"activeMessage",p))),{c(){e=m("div"),r.c(),l=w(),rt(o.$$.fragment),y(e,"data-message",s=t[6].id)},m(t,r){f(t,e,r),u[n].m(e,null),f(t,l,r),st(o,t,r),a=!0},p(t,l){let f=n;n=d(t),n===f?u[n].p(t,l):(K(),Q(u[f],1,1,(()=>{u[f]=null})),J(),r=u[n],r?r.p(t,l):(r=u[n]=i[n](t),r.c()),X(r,1),r.m(e,null)),(!a||2&l&&s!==(s=t[6].id))&&y(e,"data-message",s);const h={};2&l&&(h.thread=t[7]),4&l&&(h.level=t[2]+1),!c&&1&l&&(c=!0,h.activeMessage=t[0],I((()=>c=!1))),o.$set(h)},i(t){a||(X(r),X(o.$$.fragment,t),a=!0)},o(t){Q(r),Q(o.$$.fragment,t),a=!1},d(t){t&&h(e),u[n].d(),t&&h(l),lt(o,t)}}}function vs(t){let e,n,r=t[1]&&$s(t);return{c(){e=m("div"),r&&r.c()},m(t,s){f(t,e,s),r&&r.m(e,null),n=!0},p(t,[n]){t[1]?r?(r.p(t,n),2&n&&X(r,1)):(r=$s(t),r.c(),X(r,1),r.m(e,null)):r&&(K(),Q(r,1,1,(()=>{r=null})),J())},i(t){n||(X(r),n=!0)},o(t){Q(r),n=!1},d(t){t&&h(e),r&&r.d()}}}function ys(t,e,n){let r;c(t,Lt,(t=>n(3,r=t)));let{thread:s}=e,{activeMessage:l}=e,{level:o=0}=e;return t.$$set=t=>{"thread"in t&&n(1,s=t.thread),"activeMessage"in t&&n(0,l=t.activeMessage),"level"in t&&n(2,o=t.level)},[l,s,o,r,function(t){E[t?"unshift":"push"]((()=>{l=t,n(0,l)}))},function(t){l=t,n(0,l)}]}class ks extends ct{constructor(t){super(),ot(this,t,ys,vs,l,{thread:1,activeMessage:0,level:2})}}function Ms(t,e,n){const r=t.slice();return r[23]=e[n],r[25]=n,r}function zs(t,e,n){const r=t.slice();return r[26]=e[n],r}function Hs(t){let e,n,r=Ls(t[26])+"";return{c(){e=m("span"),n=$(r),y(e,"class","mr-2 my-1 px-2 py-1 text-xs rounded bg-gray-600 text-white truncate max-w-md")},m(t,r){f(t,e,r),d(e,n)},p(t,e){2&e&&r!==(r=Ls(t[26])+"")&&k(n,r)},d(t){t&&h(e)}}}function Ts(t){let e,n,r,s=t[6],l=[];for(let e=0;e<s.length;e+=1)l[e]=Cs(Ms(t,s,e));return{c(){e=m("ul");for(let t=0;t<l.length;t+=1)l[t].c();y(e,"tabindex","-1"),y(e,"class","absolute left-0 right-0 bottom-0 max-h-40 overflow-y-auto block flex-col bg-white border-2 border-gray-600 z-10 transform translate-y-full overflow-x-hidden rounded"),y(e,"size","5")},m(s,o){f(s,e,o);for(let t=0;t<l.length;t+=1)l[t].m(e,null);t[18](e),n||(r=b(e,"mouseout",t[19]),n=!0)},p(t,n){if(352&n){let r;for(s=t[6],r=0;r<s.length;r+=1){const o=Ms(t,s,r);l[r]?l[r].p(o,n):(l[r]=Cs(o),l[r].c(),l[r].m(e,null))}for(;r<l.length;r+=1)l[r].d(1);l.length=s.length}},d(s){s&&h(e),p(l,s),t[18](null),n=!1,r()}}}function Cs(t){let e,n,s,l,o,c,a=t[23]+"";function i(){return t[16](t[25])}function u(){return t[17](t[25])}return{c(){e=m("li"),n=$(a),s=w(),y(e,"class",l="block truncate px-4 py-2 cursor-pointer "+(t[25]===t[5]?"bg-red-500 text-white":""))},m(t,r){f(t,e,r),d(e,n),d(e,s),o||(c=[b(e,"click",i),b(e,"mouseover",u)],o=!0)},p(r,s){t=r,64&s&&a!==(a=t[23]+"")&&k(n,a),32&s&&l!==(l="block truncate px-4 py-2 cursor-pointer "+(t[25]===t[5]?"bg-red-500 text-white":""))&&y(e,"class",l)},d(t){t&&h(e),o=!1,r(c)}}}function Vs(e){let n,s,l,o,c,a,i,u=e[1],g=[];for(let t=0;t<u.length;t+=1)g[t]=Hs(zs(e,u,t));let $=e[6].length>0&&Ts(e);return{c(){n=m("div");for(let t=0;t<g.length;t+=1)g[t].c();s=w(),l=m("input"),o=w(),$&&$.c(),y(l,"id",e[0]),y(l,"type","text"),y(l,"class","flex-1 outline-none"),y(n,"class",c="relative flex-1 flex flex-row flex-wrap px-3 p-1 bg-white text-gray-700 rounded border "+e[7])},m(t,r){f(t,n,r);for(let t=0;t<g.length;t+=1)g[t].m(n,null);d(n,s),d(n,l),e[13](l),d(n,o),$&&$.m(n,null),a||(i=[b(l,"focus",e[14]),b(l,"blur",e[15]),b(l,"keyup",e[9]),b(l,"keydown",e[10]),b(l,"input",e[11])],a=!0)},p(t,[e]){if(2&e){let r;for(u=t[1],r=0;r<u.length;r+=1){const l=zs(t,u,r);g[r]?g[r].p(l,e):(g[r]=Hs(l),g[r].c(),g[r].m(n,s))}for(;r<g.length;r+=1)g[r].d(1);g.length=u.length}1&e&&y(l,"id",t[0]),t[6].length>0?$?$.p(t,e):($=Ts(t),$.c(),$.m(n,null)):$&&($.d(1),$=null),128&e&&c!==(c="relative flex-1 flex flex-row flex-wrap px-3 p-1 bg-white text-gray-700 rounded border "+t[7])&&y(n,"class",c)},i:t,o:t,d(t){t&&h(n),p(g,t),e[13](null),$&&$.d(),a=!1,r(i)}}}function Ls(t){const e=/(.*)\s\<(.*)\>/.exec(t);return e?e[1]:t}function Bs(t,e,n){let r,{id:s}=e,{value:l}=e;const o=L();let c,a,i,u=!1,d=-1,f=[];function h(t){-1!==t&&o("change",[...l,f[t]]),n(3,c.value=null,c),n(5,d=-1),n(6,f=[])}function p(){-1===d?(c.value.length>0&&o("change",[...l,c.value]),n(3,c.value=null,c),n(5,d=-1),n(6,f=[])):h(d)}return t.$$set=t=>{"id"in t&&n(0,s=t.id),"value"in t&&n(1,l=t.value)},t.$$.update=()=>{4&t.$$.dirty&&n(7,r=u?"border-red-300":"border-gray-400 hover:border-gray-500")},[s,l,u,c,a,d,f,r,h,function(t){const{key:e,target:r}=t;if("ArrowDown"===e)n(5,d+=1),d>=f.length&&n(5,d=0),a.children[d].scrollIntoView({block:"nearest"});else if("ArrowUp"===e)n(5,d-=1),d<0&&n(5,d=f.length-1),a.children[d].scrollIntoView({block:"nearest"});else if("Enter"===e)p();else if("Backspace"===e){if(c.value.length>0)return;o("change",l.slice(0,l.length-1))}},function({key:t}){"Tab"===t&&p()},({target:t})=>{clearTimeout(i),i=setTimeout((async()=>{if(t.value.length<=2)return;const e=await Ot.default.addresses(t.value);n(6,f=e.map((t=>t["name-addr"])))}),500)},function(){c.focus()},function(t){E[t?"unshift":"push"]((()=>{c=t,n(3,c)}))},()=>n(2,u=!0),()=>n(2,u=!1),t=>h(t),t=>n(5,d=t),function(t){E[t?"unshift":"push"]((()=>{a=t,n(4,a)}))},()=>n(5,d=-1)]}class Ss extends ct{constructor(t){super(),ot(this,t,Bs,Vs,l,{id:0,value:1,focus:12})}get focus(){return this.$$.ctx[12]}}function Es(t,e,n){const r=t.slice();return r[5]=e[n],r}function js(e){let n,r,s,l=e[5].content+"";return{c(){n=m("p"),r=$(l),s=w(),y(n,"class","whitespace-pre-wrap break-words"),y(n,"data-type",e[5].type)},m(t,e){f(t,n,e),d(n,r),d(n,s)},p:t,d(t){t&&h(n)}}}function Ns(e){let n,r,s,l=e[5].content.replace(/^>\s?/gm,"")+"";return{c(){n=m("p"),r=$(l),s=w(),y(n,"class","whitespace-pre-wrap break-words text-gray-600 border-l-8 border-gray-400 pl-3"),y(n,"data-type",e[5].type)},m(t,e){f(t,n,e),d(n,r),d(n,s)},p:t,d(t){t&&h(n)}}}function qs(t){let e;let n=function(t,e){return"quote"===t[5].type?Ns:js}(t)(t);return{c(){n.c(),e=x()},m(t,r){n.m(t,r),f(t,e,r)},p(t,e){n.p(t,e)},d(t){n.d(t),t&&h(e)}}}function _s(e){let n,s,l,o=e[0],c=[];for(let t=0;t<o.length;t+=1)c[t]=qs(Es(e,o,t));return{c(){n=m("div");for(let t=0;t<c.length;t+=1)c[t].c();y(n,"contenteditable","true"),z(n,"width","85ch"),y(n,"class","max-w-full h-full sm:h-80 border rounded p-3 outline-none border-gray-400 hover:border-gray-500 focus:border-red-300 overflow-y-auto")},m(t,r){f(t,n,r);for(let t=0;t<c.length;t+=1)c[t].m(n,null);s||(l=[b(n,"input",e[2]),b(n,"beforeinput",e[1])],s=!0)},p(t,[e]){if(1&e){let r;for(o=t[0],r=0;r<o.length;r+=1){const s=Es(t,o,r);c[r]?c[r].p(s,e):(c[r]=qs(s),c[r].c(),c[r].m(n,null))}for(;r<c.length;r+=1)c[r].d(1);c.length=o.length}},i:t,o:t,d(t){t&&h(n),p(c,t),s=!1,r(l)}}}function Ds(t,e,n){let{blocks:r=[]}=e;const s=L();let l=r;function o({target:t}){const e=[];for(const n of t.querySelectorAll("p")){const t="quote"===n.dataset.type?n.textContent.replace(/^/gm,"> "):n.textContent;e.push({type:n.dataset.type,content:t+(t.endsWith("\n")?"":"\n")})}s("input",e)}return t.$$set=t=>{"blocks"in t&&n(3,r=t.blocks)},[l,function(t){const e=t.getTargetRanges();if(0===e.length)return;const{startContainer:n,startOffset:r,endOffset:s}=e[0],l=n.parentNode;if("text"!==l.dataset.type||"insertFromPaste"!==t.inputType){if("quote"===l.dataset.type)if("insertParagraph"===t.inputType){t.preventDefault(),l.innerHTML=n.wholeText.slice(0,r);const e=`\n<p class="whitespace-pre-wrap break-words" data-type="text">\n</p>\n<p class="whitespace-pre-wrap break-words text-gray-600 border-l-8 border-gray-400 pl-3" data-type="quote">${n.wholeText.slice(r+1)}</p>`;l.insertAdjacentHTML("afterend",e),window.getSelection().collapse(l.nextSibling.nextSibling)}else t.inputType.startsWith("deleteContent")||t.preventDefault()}else{const e=t.dataTransfer.getData("text");e.includes("\n")&&(t.preventDefault(),l.innerHTML=n.wholeText.slice(0,r)+e+n.wholeText.slice(s),o(t))}},o,r]}class Fs extends ct{constructor(t){super(),ot(this,t,Ds,_s,l,{blocks:3})}}function As(t,e,n){const r=t.slice();return r[27]=e[n],r[29]=n,r}function Is(t){let e,n=t[5].attachments,r=[];for(let e=0;e<n.length;e+=1)r[e]=Os(As(t,n,e));return{c(){for(let t=0;t<r.length;t+=1)r[t].c();e=x()},m(t,n){for(let e=0;e<r.length;e+=1)r[e].m(t,n);f(t,e,n)},p(t,s){if(8224&s){let l;for(n=t[5].attachments,l=0;l<n.length;l+=1){const o=As(t,n,l);r[l]?r[l].p(o,s):(r[l]=Os(o),r[l].c(),r[l].m(e.parentNode,e))}for(;l<r.length;l+=1)r[l].d(1);r.length=n.length}},d(t){p(r,t),t&&h(e)}}}function Os(t){let e,n,r,s,l,o,c,a,i=t[27].name+"",u=Us(t[27].size)+"";function p(){return t[24](t[29])}return{c(){e=m("button"),n=m("strong"),r=$(i),s=$(" ("),l=$(u),o=$(")"),y(n,"class","mr-1 truncate"),z(e,"max-width","10rem"),y(e,"class","flex h-10 border border-gray-600 p-2 mr-1 mb-1 rounded text-gray-600 text-sm hover:border-red-500 active:bg-red-300 focus:outline-none")},m(t,i){f(t,e,i),d(e,n),d(n,r),d(e,s),d(e,l),d(e,o),c||(a=b(e,"click",p),c=!0)},p(e,n){t=e,32&n&&i!==(i=t[27].name+"")&&k(r,i),32&n&&u!==(u=Us(t[27].size)+"")&&k(l,u)},d(t){t&&h(e),c=!1,a()}}}function Rs(t){let e;return{c(){e=m("p"),e.textContent="Failed to send email",y(e,"class","mr-3 text-red-500 font-semibold")},m(t,n){f(t,e,n)},d(t){t&&h(e)}}}function Ps(t){let e,n,s,l,o,c,a,i,u,p,x,v,M,H,T,C,V,L,B,S,E,j,N,q,_,D,F,A,I,O,R,P,U,W,G,K,J,Y,Z,tt,et,nt,ot,ct,at,it,ut,dt,ft,ht,pt,mt,gt,$t,wt,xt,bt,vt=(t[5]?.subject||"New message")+"",yt=t[0]?"Sending":"Send",kt={id:"to",value:t[5]?.to};j=new Ss({props:kt}),t[17](j),j.$on("change",t[18]),F=new Ss({props:{id:"cc",value:t[5]?.cc}}),F.$on("change",t[19]),K=new Fs({props:{blocks:t[4]}}),K.$on("input",t[21]);let Mt=t[5]?.attachments&&Is(t),zt=t[1]&&Rs();return{c(){e=m("div"),n=m("div"),s=m("span"),l=$(vt),o=w(),c=m("button"),c.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="w-full fill-current"><path d="M0 0h24v24H0z" fill="none"></path><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg>',a=w(),i=m("div"),u=m("div"),p=m("label"),p.textContent="From:",x=w(),v=m("span"),M=m("strong"),H=$(t[6]),T=$("\n        <"),C=$(t[7]),V=$(">"),L=w(),B=m("div"),S=m("label"),S.textContent="To:",E=w(),rt(j.$$.fragment),N=w(),q=m("div"),_=m("label"),_.textContent="CC:",D=w(),rt(F.$$.fragment),A=w(),I=m("div"),O=m("label"),O.textContent="Subject:",R=w(),P=m("input"),W=w(),G=m("div"),rt(K.$$.fragment),J=w(),Y=m("div"),Z=m("div"),tt=m("input"),et=w(),nt=m("button"),nt.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="h-5 fill-current"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16.5 6v11.5c0 2.21-1.79 4-4 4s-4-1.79-4-4V5c0-1.38 1.12-2.5 2.5-2.5s2.5 1.12 2.5 2.5v10.5c0 .55-.45 1-1 1s-1-.45-1-1V6H10v9.5c0 1.38 1.12 2.5 2.5 2.5s2.5-1.12 2.5-2.5V5c0-2.21-1.79-4-4-4S7 2.79 7 5v12.5c0 3.04 2.46 5.5 5.5 5.5s5.5-2.46 5.5-5.5V6h-1.5z"></path></svg>',ot=w(),Mt&&Mt.c(),ct=w(),at=m("div"),zt&&zt.c(),it=w(),ut=m("button"),dt=g("svg"),ft=g("path"),ht=g("path"),pt=w(),mt=m("button"),gt=$(yt),y(c,"class","w-5 text-white hover:text-gray-200 active:text-gray-400 focus:outline-none"),y(n,"class","px-3 py-2 flex flex-row items-center justify-between bg-gray-500 text-white"),y(p,"class","w-20"),y(p,"for","from"),y(M,"class","font-semibold "),y(v,"class","text-gray-600"),y(u,"class","flex flex-row items-center mb-2"),y(S,"class","w-20 flex-shrink-0"),y(S,"for","to"),y(B,"class","flex flex-row items-center mb-2"),y(_,"class","w-20 flex-shrink-0"),y(_,"for","cc"),y(q,"class","flex flex-row items-center mb-2"),y(O,"class","w-20"),y(O,"for","subject"),y(P,"type","text"),y(P,"id","subject"),y(P,"class","flex-1 outline-none px-3 py-1 bg-white text-gray-700 rounded border border-gray-400 hover:border-gray-500 focus:border-red-300"),P.value=U=t[5]?.subject,y(I,"class","flex flex-row items-center"),y(i,"class","p-3 bg-gray-100 text-gray-500"),y(G,"class","p-3 flex-1 overflow-x-scroll"),tt.multiple=!0,y(tt,"type","file"),y(tt,"class","hidden"),y(nt,"class","h-10 p-2 mr-3 mb-1 rounded hover:border-red-500 bg-white text-gray-700 active:bg-red-300 focus:outline-none border"),y(Z,"class","flex flex-row flex-wrap"),y(ft,"d","M0 0h24v24H0z"),y(ft,"fill","none"),y(ht,"d","M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7l-4-4zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3zm3-10H5V5h10v4z"),y(dt,"xmlns","http://www.w3.org/2000/svg"),y(dt,"viewBox","0 0 24 24"),y(dt,"class","h-5 fill-current"),y(ut,"class","h-10 p-2 mr-3 rounded hover:border-red-500 bg-white text-gray-700 active:bg-red-300 focus:outline-none border"),ut.disabled=t[0],y(mt,"class",$t=(t[0]?"bg-red-300":"bg-red-500 hover:bg-red-600 active:bg-red-700")+" focus:outline-none px-3 text-white h-10 rounded border-0 font-semibold"),mt.disabled=t[0],y(at,"class","flex flex-row items-center"),y(Y,"class","px-3 mb-3 flex flex-row justify-between items-center"),y(e,"class","absolute top-0 sm:top-auto left-0 sm:left-auto bottom-0 sm:bottom-5 right-0 sm:right-5 flex flex-col bg-white shadow rounded border-2 border-gray-500 z-50"),z(e,"max-width","calc(85ch + 2rem)")},m(r,h){f(r,e,h),d(e,n),d(n,s),d(s,l),d(n,o),d(n,c),d(e,a),d(e,i),d(i,u),d(u,p),d(u,x),d(u,v),d(v,M),d(M,H),d(v,T),d(v,C),d(v,V),d(i,L),d(i,B),d(B,S),d(B,E),st(j,B,null),d(i,N),d(i,q),d(q,_),d(q,D),st(F,q,null),d(i,A),d(i,I),d(I,O),d(I,R),d(I,P),d(e,W),d(e,G),st(K,G,null),d(e,J),d(e,Y),d(Y,Z),d(Z,tt),t[22](tt),d(Z,et),d(Z,nt),d(Z,ot),Mt&&Mt.m(Z,null),d(Y,ct),d(Y,at),zt&&zt.m(at,null),d(at,it),d(at,ut),d(ut,dt),d(dt,ft),d(dt,ht),d(at,pt),d(at,mt),d(mt,gt),wt=!0,xt||(bt=[b(c,"click",t[16]),b(P,"change",t[20]),b(tt,"change",t[12]),b(nt,"click",t[23]),b(ut,"click",t[9]),b(mt,"click",t[10]),b(e,"keydown",t[14])],xt=!0)},p(t,[e]){(!wt||32&e)&&vt!==(vt=(t[5]?.subject||"New message")+"")&&k(l,vt),(!wt||64&e)&&k(H,t[6]),(!wt||128&e)&&k(C,t[7]);const n={};32&e&&(n.value=t[5]?.to),j.$set(n);const r={};32&e&&(r.value=t[5]?.cc),F.$set(r),(!wt||32&e&&U!==(U=t[5]?.subject)&&P.value!==U)&&(P.value=U);const s={};16&e&&(s.blocks=t[4]),K.$set(s),t[5]?.attachments?Mt?Mt.p(t,e):(Mt=Is(t),Mt.c(),Mt.m(Z,null)):Mt&&(Mt.d(1),Mt=null),t[1]?zt||(zt=Rs(),zt.c(),zt.m(at,it)):zt&&(zt.d(1),zt=null),(!wt||1&e)&&(ut.disabled=t[0]),(!wt||1&e)&&yt!==(yt=t[0]?"Sending":"Send")&&k(gt,yt),(!wt||1&e&&$t!==($t=(t[0]?"bg-red-300":"bg-red-500 hover:bg-red-600 active:bg-red-700")+" focus:outline-none px-3 text-white h-10 rounded border-0 font-semibold"))&&y(mt,"class",$t),(!wt||1&e)&&(mt.disabled=t[0])},i(t){wt||(X(j.$$.fragment,t),X(F.$$.fragment,t),X(K.$$.fragment,t),wt=!0)},o(t){Q(j.$$.fragment,t),Q(F.$$.fragment,t),Q(K.$$.fragment,t),wt=!1},d(n){n&&h(e),t[17](null),lt(j),lt(F),lt(K),t[22](null),Mt&&Mt.d(),zt&&zt.d(),xt=!1,r(bt)}}}function Us(t){return t>1e6?`${(t/1e6).toFixed(2)}MB`:t>1e3?`${(t/1e3).toFixed(2)}KB`:`${t}B`}function Ws(t,e,n){let r,s,l,o;c(t,Ur,(t=>n(5,r=t))),c(t,At,(t=>n(25,s=t))),c(t,Ut,(t=>n(6,l=t))),c(t,Pt,(t=>n(7,o=t)));let{wrap:a=80}=e;const i=L();let u,d,f=!1,h=null;async function p(){n(1,h=null),n(0,f=!0);try{await Ot.default.sendMessage(r),n(0,f=!1),Ur.destroy(),Je.fetch(s)}catch(t){n(1,h=t.message),n(0,f=!1)}}V((()=>{u.focus()}));let m=[];if(r?.reply){const{Date:t,From:e}=r?.originalHeaders;m.push({type:"text",content:""},{type:"text",content:`On ${t}, ${e} wrote:`},{type:"quote",content:r?.body})}else{const t=Kn(r?.body||"");m.push(...t)}function g({detail:t}){n(4,m=t),console.debug("text content","blocks:",m,"content:\n",m.map((({content:t})=>t)).join("")),Ur.setField({body:m.map((({content:t})=>t)).join("")})}function $(t){Ur.setField({attachments:r.attachments.filter(((e,n)=>n!==t))})}return t.$$set=t=>{"wrap"in t&&n(15,a=t.wrap)},[f,h,u,d,m,r,l,o,i,async function(){n(1,h=null),n(0,f=!0);try{await Ot.default.saveMessage(r),n(0,f=!1),Ur.destroy()}catch(t){n(1,h=t.message),n(0,f=!1)}},p,g,function(){for(const t of d.files)Ur.setField({attachments:[...r.attachments,t]})},$,function(t){"k"===t.key&&t.altKey?(t.preventDefault(),i("close")):"c"===t.key&&t.altKey?(t.preventDefault(),p()):"q"===t.key&&t.altKey&&function(){const t=document.getSelection();if(0===t.rangeCount)return;const{startContainer:e,startOffset:n}=t.getRangeAt(0),r=e.parentNode;if("text"!==r.dataset.type)return;const s=r.innerText.replaceAll("\n","").split(/\s/).reduce(((t,e)=>(t[t.length-1].length+e.length>a?t.push(`${e} `):t[t.length-1]+=`${e} `,t)),[""]);r.innerHTML=s.join("\n").trim(),t.collapse(r.firstChild,Math.min(r.firstChild.nodeValue.length,n))}()},a,()=>i("close"),function(t){E[t?"unshift":"push"]((()=>{u=t,n(2,u)}))},({detail:t})=>Ur.setField({to:t}),({detail:t})=>Ur.setField({cc:t}),({target:t})=>Ur.setField({subject:t.value}),t=>g(t),function(t){E[t?"unshift":"push"]((()=>{d=t,n(3,d)}))},()=>d.click(),t=>$(t)]}class Gs extends ct{constructor(t){super(),ot(this,t,Ws,Ps,l,{wrap:15})}}function Ks(e){let n,r,s;return{c(){n=m("div"),y(n,"class","absolute top-0 bottom-0 left-0 right-0 sm:hidden")},m(t,l){f(t,n,l),r||(s=b(n,"click",e[19]),r=!0)},p:t,d(t){t&&h(n),r=!1,s()}}}function Js(t){let e,n;return{c(){e=m("h2"),n=$(t[10]),y(e,"class","text-gray-100 font-semibold")},m(t,r){f(t,e,r),d(e,n)},p(t,e){1024&e[0]&&k(n,t[10])},d(t){t&&h(e)}}}function Xs(t){let e,n;return e=new Rn({props:{mailbox:t[0]}}),{c(){rt(e.$$.fragment)},m(t,r){st(e,t,r),n=!0},p(t,n){const r={};1&n[0]&&(r.mailbox=t[0]),e.$set(r)},i(t){n||(X(e.$$.fragment,t),n=!0)},o(t){Q(e.$$.fragment,t),n=!1},d(t){lt(e,t)}}}function Qs(t){let e,n,r,s,l,o,c,a,i;function u(e){t[28](e)}let p={thread:t[2]};return void 0!==t[7]&&(p.activeMessage=t[7]),l=new ks({props:p}),E.push((()=>nt(l,"activeMessage",u))),{c(){e=m("section"),n=m("div"),r=m("button"),r.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="w-5 fill-current"><path d="M0 0h24v24H0z" fill="none"></path><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg>',s=w(),rt(l.$$.fragment),y(r,"class","absolute right-3 bg-gray-200 p-1 rounded text-gray-500 order-0 hover:text-gray-800 active:text-gray-500 focus:outline-none"),y(n,"class","sticky top-3 w-full right-3 z-10"),y(e,"class","relative flex-1 w-full overflow-y-auto")},m(o,u){f(o,e,u),d(e,n),d(n,r),d(e,s),st(l,e,null),t[29](e),c=!0,a||(i=b(r,"click",t[27]),a=!0)},p(t,e){const n={};4&e[0]&&(n.thread=t[2]),!o&&128&e[0]&&(o=!0,n.activeMessage=t[7],I((()=>o=!1))),l.$set(n)},i(t){c||(X(l.$$.fragment,t),c=!0)},o(t){Q(l.$$.fragment,t),c=!1},d(n){n&&h(e),lt(l),t[29](null),a=!1,i()}}}function Ys(e){let n,r;return n=new Gs({}),n.$on("close",e[30]),{c(){rt(n.$$.fragment)},m(t,e){st(n,t,e),r=!0},p:t,i(t){r||(X(n.$$.fragment,t),r=!0)},o(t){Q(n.$$.fragment,t),r=!1},d(t){lt(n,t)}}}function Zs(t){let e,n,r,s,l,o,c,a,i,u,p,g,$,x,v,k,M,z,H,T,C,V,L,B,S,E,j,N,q,_,D,F,A,I,O,R,P,U,W;e=new at({});let G=!t[8]&&Ks(t),Y=!t[8]&&Js(t);a=new dt({props:{refreshing:t[3]}}),a.$on("click",t[13]),g=new gt({props:{collapsed:t[8]}}),g.$on("click",t[20]),v=new _e({props:{collapsed:t[8]}}),z=new vt({props:{collapsed:t[8]}}),z.$on("click",t[21]),B=new vt({props:{collapsed:t[8]}}),B.$on("click",t[22]);E=new Ae({props:{}}),t[23](E),E.$on("focus",t[24]),E.$on("blur",t[25]),N=new Hn({props:{disabled:0===t[11].length}}),_=new Vn({});let Z=t[0]&&Xs(t),tt=t[1]&&Qs(t),et=t[12]&&Ys(t);return{c(){rt(e.$$.fragment),n=w(),r=m("div"),G&&G.c(),s=w(),l=m("aside"),o=m("div"),Y&&Y.c(),c=w(),rt(a.$$.fragment),u=w(),p=m("div"),rt(g.$$.fragment),$=w(),x=m("div"),rt(v.$$.fragment),k=w(),M=m("div"),rt(z.$$.fragment),T=w(),C=m("main"),V=m("header"),L=m("div"),rt(B.$$.fragment),S=w(),rt(E.$$.fragment),j=w(),rt(N.$$.fragment),q=w(),rt(_.$$.fragment),D=w(),F=m("section"),Z&&Z.c(),I=w(),tt&&tt.c(),R=w(),et&&et.c(),y(o,"class",i=`h-14 flex flex-row ${t[8]?"justify-center":"justify-between"} items-center p-4`),y(p,"class","px-4"),y(x,"class","p-4 flex-1"),y(M,"class","p-4"),y(l,"class",H="absolute sm:fixed h-screen flex-shrink-0 flex flex-col bg-gray-600 z-10 "+(t[8]?"hidden sm:flex w-16":"w-56")),y(L,"class","sm:hidden mr-3 pb-1"),y(V,"class","flex sm:flex-row flex-wrap items-center sm:justify-center py-3 pr-3 pl-3 sm:pl-0 border-b border-gray-500 bg-gray-600"),y(F,"class",A=(t[1]?"h-0 sm:h-60 border-b-8":"flex-1")+" flex-shrink-0 border-gray-300 overflow-y-auto"),y(C,"class",O="flex flex-col w-full "+(t[8]?"sm:pl-16":"sm:pl-56")),y(r,"class","h-screen w-screen flex")},m(i,h){st(e,i,h),f(i,n,h),f(i,r,h),G&&G.m(r,null),d(r,s),d(r,l),d(l,o),Y&&Y.m(o,null),d(o,c),st(a,o,null),d(l,u),d(l,p),st(g,p,null),d(l,$),d(l,x),st(v,x,null),d(l,k),d(l,M),st(z,M,null),d(r,T),d(r,C),d(C,V),d(V,L),st(B,L,null),d(V,S),st(E,V,null),d(V,j),st(N,V,null),d(V,q),st(_,V,null),d(C,D),d(C,F),Z&&Z.m(F,null),t[26](F),d(C,I),tt&&tt.m(C,null),d(r,R),et&&et.m(r,null),P=!0,U||(W=b(window,"keydown",t[14]),U=!0)},p(t,e){t[8]?G&&(G.d(1),G=null):G?G.p(t,e):(G=Ks(t),G.c(),G.m(r,s)),t[8]?Y&&(Y.d(1),Y=null):Y?Y.p(t,e):(Y=Js(t),Y.c(),Y.m(o,c));const n={};8&e[0]&&(n.refreshing=t[3]),a.$set(n),(!P||256&e[0]&&i!==(i=`h-14 flex flex-row ${t[8]?"justify-center":"justify-between"} items-center p-4`))&&y(o,"class",i);const u={};256&e[0]&&(u.collapsed=t[8]),g.$set(u);const d={};256&e[0]&&(d.collapsed=t[8]),v.$set(d);const f={};256&e[0]&&(f.collapsed=t[8]),z.$set(f),(!P||256&e[0]&&H!==(H="absolute sm:fixed h-screen flex-shrink-0 flex flex-col bg-gray-600 z-10 "+(t[8]?"hidden sm:flex w-16":"w-56")))&&y(l,"class",H);const h={};256&e[0]&&(h.collapsed=t[8]),B.$set(h);E.$set({});const p={};2048&e[0]&&(p.disabled=0===t[11].length),N.$set(p),t[0]?Z?(Z.p(t,e),1&e[0]&&X(Z,1)):(Z=Xs(t),Z.c(),X(Z,1),Z.m(F,null)):Z&&(K(),Q(Z,1,1,(()=>{Z=null})),J()),(!P||2&e[0]&&A!==(A=(t[1]?"h-0 sm:h-60 border-b-8":"flex-1")+" flex-shrink-0 border-gray-300 overflow-y-auto"))&&y(F,"class",A),t[1]?tt?(tt.p(t,e),2&e[0]&&X(tt,1)):(tt=Qs(t),tt.c(),X(tt,1),tt.m(C,null)):tt&&(K(),Q(tt,1,1,(()=>{tt=null})),J()),(!P||256&e[0]&&O!==(O="flex flex-col w-full "+(t[8]?"sm:pl-16":"sm:pl-56")))&&y(C,"class",O),t[12]?et?(et.p(t,e),4096&e[0]&&X(et,1)):(et=Ys(t),et.c(),X(et,1),et.m(r,null)):et&&(K(),Q(et,1,1,(()=>{et=null})),J())},i(t){P||(X(e.$$.fragment,t),X(a.$$.fragment,t),X(g.$$.fragment,t),X(v.$$.fragment,t),X(z.$$.fragment,t),X(B.$$.fragment,t),X(E.$$.fragment,t),X(N.$$.fragment,t),X(_.$$.fragment,t),X(Z),X(tt),X(et),P=!0)},o(t){Q(e.$$.fragment,t),Q(a.$$.fragment,t),Q(g.$$.fragment,t),Q(v.$$.fragment,t),Q(z.$$.fragment,t),Q(B.$$.fragment,t),Q(E.$$.fragment,t),Q(N.$$.fragment,t),Q(_.$$.fragment,t),Q(Z),Q(tt),Q(et),P=!1},d(s){lt(e,s),s&&h(n),s&&h(r),G&&G.d(),Y&&Y.d(),lt(a),lt(g),lt(v),lt(z),lt(B),t[23](null),lt(E),lt(N),lt(_),Z&&Z.d(),t[26](null),tt&&tt.d(),et&&et.d(),U=!1,W()}}}function tl(t,e,n){let r,s,l,o,a,i,u,d,f,h;c(t,It,(t=>n(15,s=t))),c(t,Xt,(t=>n(16,l=t))),c(t,Ft,(t=>n(17,o=t))),c(t,At,(t=>n(1,a=t))),c(t,Lt,(t=>n(18,i=t))),c(t,Je,(t=>n(2,u=t))),c(t,Pt,(t=>n(10,d=t))),c(t,nn,(t=>n(11,f=t))),c(t,Ur,(t=>n(12,h=t)));let p,m,g,$,w=!1,x=!0,b=!1;function v(){n(3,w=!0);const t=Date.now();Xt.updateUnreadCounters(),setTimeout((()=>n(3,w=!1)),1e3-Date.now()+t)}V((()=>{setInterval((()=>v()),6e4)}));const y={n:function(){let t;if(a){t=p.querySelector(`a[data-thread="${a}"]`)?.nextSibling}else p.children.length>0&&(t=p.children[0]);t?.dataset?.thread&&Dt.selectThread(o,t.dataset.thread)},p:function(){if(!a)return;const t=p.querySelector(`a[data-thread="${a}"]`)?.previousSibling;t?.dataset?.thread&&Dt.selectThread(o,t.dataset.thread)},Escape:()=>Dt.deselectThread(),N:()=>m?.scrollBy(0,200),P:()=>m?.scrollBy(0,-200),e:function(){if(!a)return;const t=[...m.querySelectorAll("div[data-message]")],e=t.findIndex((t=>t.dataset.message===i));if(e<0||e>=t.length)return;const n=t[e+1];n?.dataset?.message&&Lt.selectMessage(n.dataset.message)},a:function(){if(!a)return;const t=[...m.querySelectorAll("div[data-message]")],e=t.findIndex((t=>t.dataset.message===i));if(e<=0||e>t.length)return;const n=t[e-1];n?.dataset?.message&&Lt.selectMessage(n.dataset.message)},C:()=>Ur.create(),r:()=>Ur.reply(i,"sender"),R:()=>Ur.reply(i,"all"),f:()=>Ur.forward(Pe(u,i)),s:()=>g.focus(),V:function(){const t=m?.querySelectorAll("a[data-html-body]");t&&0!==t.length&&t[0].click()},A:()=>$?.move("archive"),D:()=>$?.move("trash"),J:()=>$?.move("spam"),"alt+i":()=>Dt.selectMailbox("inbox"),"alt+a":()=>Dt.selectMailbox("archive")};return t.$$.update=()=>{229376&t.$$.dirty[0]&&n(0,r=s?.length>0?{id:"search",terms:s,tags:[]}:l.find((({id:t})=>t===o))),163841&t.$$.dirty[0]&&(document.title=r?.unread>0?`(${r.unread}) ${kt[o]}`:kt[o]||s),1&t.$$.dirty[0]&&(document.head.querySelector('link[rel="icon"]').href=function(t){if(!t)return"/favicon.png";const e=document.createElement("canvas");e.height=64,e.width=64;const n=e.getContext("2d");return n.font="64px serif",n.fillText("✉️",0,64),e.toDataURL()}(r?.unread>0)),2&t.$$.dirty[0]&&a&&(async function(){const t=await Je.fetch(a);await F();const e=m.querySelectorAll("div[data-message]");if(0===e.length)return;const n=e[e.length-1].dataset.message,r=Ue(u,null,["unread"])||We(u,null,[],["trash"])||Pe(t,n);Lt.selectMessage(r.id),Ye(a,r)}(),async function(){let t;await F();const e=()=>{const e=p.querySelector(`a[data-thread="${a}"]`);e&&(e.scrollIntoView({behavior:"smooth",block:"center"}),clearInterval(t))};t=setInterval(e,100),e()}()),262148&t.$$.dirty[0]&&i&&async function(t){if(!t)return;await F(),m.querySelector(`div[data-message="${t.id}"]`).scrollIntoView({behavior:"smooth",block:"start"})}(Pe(u,i))},[r,a,u,w,p,m,g,$,x,b,d,f,h,v,function(t){const{key:e,altKey:n,target:r}=t;if("INPUT"===r.tagName||"TEXTAREA"===r.tagName)return;if("DIV"===r.tagName&&Boolean(r.contentEditable))return;const s=`${n?"alt+":""}${e}`;y[s]&&(console.debug(`found hotkey for ${s}`),y[s](),t.preventDefault())},s,l,o,i,()=>n(8,x=!x),()=>Ur.create(),()=>n(8,x=!x),()=>n(8,x=!x),function(t){E[t?"unshift":"push"]((()=>{g=t,n(6,g)}))},()=>n(9,b=!0),()=>n(9,b=!1),function(t){E[t?"unshift":"push"]((()=>{p=t,n(4,p)}))},()=>Dt.deselectThread(),function(t){$=t,n(7,$)},function(t){E[t?"unshift":"push"]((()=>{m=t,n(5,m)}))},()=>Ur.destroy()]}return new class extends ct{constructor(t){super(),ot(this,t,tl,Zs,l,{},[-1,-1])}}({target:document.body})}();
//# sourceMappingURL=bundle.js.map
